

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pawnlib.resource.server &mdash; Pawnlib v2.1.36</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />

  
      <script src="../../../_static/jquery.js"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
      <script src="../../../_static/doctools.js"></script>
      <script src="../../../_static/sphinx_highlight.js"></script>
      <script src="../../../_static/clipboard.min.js"></script>
      <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            pawnlib
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Welcome to pawnlibâ€™s documentation!</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Packages</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.asyncio.html">pawnlib.asyncio package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.builder.html">pawnlib.builder package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.cli.html">pawnlib.cli package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.config.html">pawnlib.config package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.docker.html">pawnlib.docker package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.exceptions.html">pawnlib.exceptions package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.input.html">pawnlib.input package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.metrics.html">pawnlib.metrics package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.output.html">pawnlib.output package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.resource.html">pawnlib.resource package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.typing.html">pawnlib.typing package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.utils.html">pawnlib.utils package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">pawnlib</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pawnlib.resource.server</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pawnlib.resource.server</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">resource</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">__resource</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">platform</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">defaultdict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pawnlib.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">http</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pawnlib.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">is_valid_ipv4</span><span class="p">,</span> <span class="n">split_every_n</span><span class="p">,</span> <span class="n">format_size</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pawnlib.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">pawn</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pawnlib.typing.converter</span><span class="w"> </span><span class="kn">import</span> <span class="n">PrettyOrderedDict</span><span class="p">,</span> <span class="n">dict_to_line</span><span class="p">,</span> <span class="n">format_network_traffic</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pawnlib.resource.net</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProcNetMonitor</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">string</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">fcntl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">struct</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">statistics</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">concurrent.futures</span><span class="w"> </span><span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rich.progress</span><span class="w"> </span><span class="kn">import</span> <span class="n">Progress</span><span class="p">,</span> <span class="n">TaskID</span><span class="p">,</span> <span class="n">TextColumn</span><span class="p">,</span> <span class="n">BarColumn</span><span class="p">,</span> <span class="n">TimeRemainingColumn</span><span class="p">,</span> <span class="n">TimeElapsedColumn</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">psutil</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red]</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">signal</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">rich.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rich.panel</span><span class="w"> </span><span class="kn">import</span> <span class="n">Panel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rich.layout</span><span class="w"> </span><span class="kn">import</span> <span class="n">Layout</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rich.live</span><span class="w"> </span><span class="kn">import</span> <span class="n">Live</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rich.console</span><span class="w"> </span><span class="kn">import</span> <span class="n">Console</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">aiohttp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="hex_mask_to_cidr"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.hex_mask_to_cidr">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">hex_mask_to_cidr</span><span class="p">(</span><span class="n">hex_mask</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a hexadecimal mask to a CIDR value.</span>

<span class="sd">    :param hex_mask: The hexadecimal mask to convert.</span>
<span class="sd">    :return: The CIDR value of the mask.</span>

<span class="sd">    Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pawnlib.resource import server</span>

<span class="sd">            server.hex_mask_to_cidr(&quot;FFFF&quot;)</span>
<span class="sd">            # &gt;&gt; 16</span>

<span class="sd">            server.hex_mask_to_cidr(&quot;FF00&quot;)</span>
<span class="sd">            # &gt;&gt; 8</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Convert hexadecimal mask to integer</span>
        <span class="n">mask_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hex_mask</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>

        <span class="c1"># Convert integer mask to binary string</span>
        <span class="n">bin_mask</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">mask_int</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>  <span class="c1"># Remove the &#39;0b&#39; prefix</span>

        <span class="c1"># Count the number of &#39;1&#39;s to get the CIDR value</span>
        <span class="n">cidr</span> <span class="o">=</span> <span class="n">bin_mask</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cidr</span>

    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="get_interface_names"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_interface_names">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_interface_names</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a list of interface names on the system.</span>

<span class="sd">    :return: a list of interface names</span>

<span class="sd">    Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pawnlib.resource import server</span>
<span class="sd">            server.get_interface_names()</span>
<span class="sd">            # &gt;&gt; [&#39;lo&#39;, &#39;enp0s31f6&#39;, &#39;wlp0s20f3&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Linux&#39;</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/proc/net/dev&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">interfaces</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Darwin&#39;</span><span class="p">:</span>
        <span class="n">interfaces</span> <span class="o">=</span> <span class="p">[</span><span class="n">if_name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">if_name</span> <span class="ow">in</span> <span class="n">socket</span><span class="o">.</span><span class="n">if_nameindex</span><span class="p">()]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only Linux and macOS are supported&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">interfaces</span></div>


<div class="viewcode-block" id="get_ip_addresses"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_ip_addresses">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_ip_addresses</span><span class="p">(</span><span class="n">interface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a list of IP addresses associated with a given network interface.</span>

<span class="sd">    :param interface: A string representing the name of the network interface.</span>
<span class="sd">    :return: A list of IP addresses associated with the given network interface.</span>

<span class="sd">    Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pawnlib.resource import server</span>
<span class="sd">            server.ip_addresses = get_ip_addresses(&#39;eth0&#39;)</span>
<span class="sd">            # &gt;&gt; [&#39;192.168.0.1&#39;, &#39;192.168.0.2&#39;]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ip_addresses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Linux&#39;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>
            <span class="n">ip_address</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_ntoa</span><span class="p">(</span><span class="n">fcntl</span><span class="o">.</span><span class="n">ioctl</span><span class="p">(</span>
                <span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span>
                <span class="mh">0x8915</span><span class="p">,</span>  <span class="c1"># SIOCGIFADDR</span>
                <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;256s&#39;</span><span class="p">,</span> <span class="n">interface</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)[:</span><span class="mi">15</span><span class="p">])</span>
            <span class="p">)[</span><span class="mi">20</span><span class="p">:</span><span class="mi">24</span><span class="p">])</span>
            <span class="n">ip_addresses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ip_address</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Darwin&#39;</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;ifconfig&#39;</span><span class="p">,</span> <span class="n">interface</span><span class="p">])</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span> <span class="k">if</span> <span class="s1">&#39;inet &#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">address</span> <span class="ow">in</span> <span class="n">addresses</span><span class="p">:</span>
            <span class="n">ip_addresses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only Linux and macOS are supported&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ip_addresses</span></div>


<div class="viewcode-block" id="get_ip_and_netmask"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_ip_and_netmask">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_ip_and_netmask</span><span class="p">(</span><span class="n">interface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get IP address and netmask of the given interface.</span>

<span class="sd">    :param interface: The name of the interface.</span>
<span class="sd">    :return: A list containing the IP address and netmask.</span>

<span class="sd">    Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pawnlib.resource import server</span>
<span class="sd">            server.ip_info = get_ip_and_netmask(&#39;eth0&#39;)</span>
<span class="sd">            print(ip_info)</span>
<span class="sd">            # &gt;&gt; [&#39;192.168.0.2&#39;, &#39;255.255.255.0&#39;]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ip_info</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Linux&#39;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>
            <span class="c1"># Get IP address</span>
            <span class="n">ip_address</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_ntoa</span><span class="p">(</span><span class="n">fcntl</span><span class="o">.</span><span class="n">ioctl</span><span class="p">(</span>
                <span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span>
                <span class="mh">0x8915</span><span class="p">,</span>  <span class="c1"># SIOCGIFADDR</span>
                <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;256s&#39;</span><span class="p">,</span> <span class="n">interface</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)[:</span><span class="mi">15</span><span class="p">])</span>
            <span class="p">)[</span><span class="mi">20</span><span class="p">:</span><span class="mi">24</span><span class="p">])</span>
            <span class="n">ip_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ip_address</span><span class="p">)</span>

            <span class="c1"># Get netmask</span>
            <span class="n">netmask</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_ntoa</span><span class="p">(</span><span class="n">fcntl</span><span class="o">.</span><span class="n">ioctl</span><span class="p">(</span>
                <span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span>
                <span class="mh">0x891b</span><span class="p">,</span>  <span class="c1"># SIOCGIFNETMASK</span>
                <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;256s&#39;</span><span class="p">,</span> <span class="n">interface</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)[:</span><span class="mi">15</span><span class="p">])</span>
            <span class="p">)[</span><span class="mi">20</span><span class="p">:</span><span class="mi">24</span><span class="p">])</span>
            <span class="n">ip_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">netmask</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Darwin&#39;</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;ifconfig&#39;</span><span class="p">,</span> <span class="n">interface</span><span class="p">])</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;inet &#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">ip_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">netmask</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">cidr_netmask</span> <span class="o">=</span> <span class="n">hex_mask_to_cidr</span><span class="p">(</span><span class="n">netmask</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cidr_netmask</span><span class="p">:</span>
                    <span class="n">ip_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">subnet_mask_to_decimal</span><span class="p">(</span><span class="n">cidr_netmask</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">ip_info</span></div>


<div class="viewcode-block" id="subnet_mask_to_decimal"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.subnet_mask_to_decimal">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">subnet_mask_to_decimal</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert subnet mask to decimal.</span>

<span class="sd">    :param subnet_mask: Subnet mask in integer format.</span>
<span class="sd">    :type subnet_mask: int</span>
<span class="sd">    :return: Decimal subnet mask.</span>
<span class="sd">    :rtype: str</span>

<span class="sd">    Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pawnlib.resource import server</span>
<span class="sd">            server.subnet_mask_to_decimal(24)</span>
<span class="sd">            # &gt;&gt; &#39;255.255.255.0&#39;</span>

<span class="sd">            server.subnet_mask_to_decimal(16)</span>
<span class="sd">            # &gt;&gt; &#39;255.255.0.0&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">subnet_mask</span> <span class="o">&lt;=</span> <span class="mi">32</span><span class="p">:</span>
        <span class="n">binary_subnet</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span> <span class="o">*</span> <span class="n">subnet_mask</span> <span class="o">+</span> <span class="s2">&quot;0&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">32</span> <span class="o">-</span> <span class="n">subnet_mask</span><span class="p">)</span>
        <span class="n">decimal_subnet</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">binary_subnet</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">8</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">8</span><span class="p">)]</span>
        <span class="k">return</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">decimal_subnet</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="get_interface_ips"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_interface_ips">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_interface_ips</span><span class="p">(</span><span class="n">ignore_interfaces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ip_only</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the IP addresses of the interfaces.</span>

<span class="sd">    :param ignore_interfaces: A list of interface names to ignore.</span>
<span class="sd">    :param detail: Whether to show detailed information or not.</span>
<span class="sd">    :param is_sort: Whether to sort the results or not.</span>
<span class="sd">    :param ip_only: If True, return only the IP addresses.</span>
<span class="sd">    :return: A list of tuples containing interface name and IP address, a dictionary with IP, subnet, and gateway, or just IPs if ip_only is True.</span>


<span class="sd">    Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pawnlib.resource import server</span>

<span class="sd">            server.get_interface_ips()</span>
<span class="sd">            # &gt;&gt; [(&#39;lo&#39;, &#39;127.0.0.1 / 8&#39;), (&#39;wlan0&#39;, &#39;192.168.0.10, G/W: 192.168.0.1&#39;)]</span>

<span class="sd">            server.get_interface_ips(detail=True)</span>
<span class="sd">            # &gt;&gt;  [ (&#39;en0&#39;, {&#39;ip&#39;: &#39;20.22.1.13&#39;, &#39;subnet&#39;: &#39;255.255.252.0&#39;, &#39;gateway&#39;: &#39;20.22.0.1&#39;}),(&#39;utun4&#39;, {&#39;ip&#39;: &#39;43.62.13.6&#39;})]</span>

<span class="sd">            server.get_interface_ips(ip_only=True)</span>
<span class="sd">            # &gt;&gt; [&#39;127.0.0.1&#39;, &#39;192.168.0.10&#39;]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">interfaces_and_ips</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">ignore_interfaces</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ignore_interfaces</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">interface_names</span> <span class="o">=</span> <span class="n">get_interface_names</span><span class="p">()</span>
    <span class="n">default_route</span><span class="p">,</span> <span class="n">default_interface</span> <span class="o">=</span> <span class="n">get_default_route_and_interface</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">interface_name</span> <span class="ow">in</span> <span class="n">interface_names</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">interface_name</span> <span class="ow">in</span> <span class="n">ignore_interfaces</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">detail</span><span class="p">:</span>
            <span class="n">ip_and_netmask</span> <span class="o">=</span> <span class="n">get_ip_and_netmask</span><span class="p">(</span><span class="n">interface_name</span><span class="p">)</span>
            <span class="n">ip_dict</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c1"># Only add to the dict if the IP value exists</span>
            <span class="k">if</span> <span class="n">ip_and_netmask</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ip_and_netmask</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ip_dict</span><span class="p">[</span><span class="s2">&quot;ip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ip_and_netmask</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ip_and_netmask</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">ip_dict</span><span class="p">[</span><span class="s2">&quot;subnet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ip_and_netmask</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">default_interface</span> <span class="ow">and</span> <span class="n">interface_name</span> <span class="o">==</span> <span class="n">default_interface</span> <span class="ow">and</span> <span class="n">default_route</span><span class="p">:</span>
                    <span class="n">ip_dict</span><span class="p">[</span><span class="s2">&quot;gateway&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_route</span>

            <span class="n">ip_address</span> <span class="o">=</span> <span class="n">ip_dict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ip_address</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_ip_addresses</span><span class="p">(</span><span class="n">interface_name</span><span class="p">))</span>

            <span class="c1"># if default_interface and default_route and interface_name == default_interface:</span>
            <span class="c1">#     ip_address += f&quot;, G/W: {default_route}&quot;</span>

        <span class="k">if</span> <span class="n">ip_address</span><span class="p">:</span>
            <span class="n">interfaces_and_ips</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">interface_name</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">is_sort</span><span class="p">:</span>
        <span class="n">interfaces_and_ips</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;gateway&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;G/W&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ip_only</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ip</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">interfaces_and_ips</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">interfaces_and_ips</span></div>


<div class="viewcode-block" id="get_interface_ips_dict"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_interface_ips_dict">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_interface_ips_dict</span><span class="p">(</span><span class="n">ignore_interfaces</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the IP addresses of all interfaces in a dictionary format.</span>

<span class="sd">    :param ignore_interfaces: list of interfaces to be ignored</span>
<span class="sd">    :return: dictionary with interface names as keys and their IP addresses as values</span>

<span class="sd">    Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pawnlib.resource import server</span>

<span class="sd">            server.get_interface_ips_dict(ignore_interfaces=[&#39;lo&#39;, &#39;eth0&#39;])</span>
<span class="sd">            # &gt;&gt; {&#39;wlan0&#39;: &#39;192.168.1.100&#39;}</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">interface_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">interface</span><span class="p">,</span> <span class="n">ipaddr</span> <span class="ow">in</span> <span class="n">get_interface_ips</span><span class="p">(</span><span class="n">ignore_interfaces</span><span class="o">=</span><span class="n">ignore_interfaces</span><span class="p">):</span>
        <span class="n">interface_dict</span><span class="p">[</span><span class="n">interface</span><span class="p">]</span> <span class="o">=</span> <span class="n">ipaddr</span>
    <span class="k">return</span> <span class="n">interface_dict</span></div>


<div class="viewcode-block" id="get_default_route_and_interface"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_default_route_and_interface">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_default_route_and_interface</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse the route of the process based on the platform.</span>

<span class="sd">    Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pawnlib.resource import server</span>

<span class="sd">            get_default_route_and_interface()</span>
<span class="sd">            # If Linux:</span>
<span class="sd">            # &gt;&gt; (&#39;192.168.1.1&#39;, &#39;eth0&#39;)</span>
<span class="sd">            # If MacOS:</span>
<span class="sd">            # &gt;&gt; (&#39;192.168.1.1&#39;, &#39;en0&#39;)</span>
<span class="sd">            # If other platform:</span>
<span class="sd">            # &gt;&gt; (&quot;Unsupported platform.&quot;, None)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Linux&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_default_route_and_interface_linux</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Darwin&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_default_route_and_interface_macos</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unsupported platform.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: /proc/net/route file not found.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="get_default_route_and_interface_linux"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_default_route_and_interface_linux">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_default_route_and_interface_linux</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse the Linux route.</span>

<span class="sd">    Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pawnlib.resource import server</span>

<span class="sd">            server.get_default_route_and_interface_linux()</span>
<span class="sd">            # &gt;&gt; (&#39;192.168.1.1&#39;, &#39;eth0&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/proc/net/route&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">route_file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">route_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">11</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;00000000&#39;</span><span class="p">:</span>
                <span class="n">default_interface</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">default_route</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span> <span class="mi">16</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)])</span>
                <span class="k">return</span> <span class="n">default_route</span><span class="p">,</span> <span class="n">default_interface</span></div>


<div class="viewcode-block" id="get_default_route_and_interface_macos"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_default_route_and_interface_macos">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_default_route_and_interface_macos</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse the Linux route.</span>

<span class="sd">    Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pawnlib.resource import server</span>

<span class="sd">            server.get_default_route_and_interface_macos()</span>
<span class="sd">            # &gt;&gt; (&#39;192.168.1.1&#39;, &#39;eth0&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">route_output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;netstat&#39;</span><span class="p">,</span> <span class="s1">&#39;-rn&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">route_output</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="k">if</span> <span class="s1">&#39;default&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">default_route</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">default_interface</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">is_valid_ipv4</span><span class="p">(</span><span class="n">default_route</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">default_route</span><span class="p">,</span> <span class="n">default_interface</span>
    <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="ProcessMonitor"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.ProcessMonitor">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">ProcessMonitor</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">console</span><span class="p">:</span> <span class="n">Console</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span> <span class="o">=</span> <span class="n">console</span> <span class="k">if</span> <span class="n">console</span> <span class="k">else</span> <span class="n">Console</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_number</span> <span class="o">=</span> <span class="n">n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_usage</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proc_net_monitor</span> <span class="o">=</span>  <span class="n">ProcNetMonitor</span><span class="p">(</span>
                                                        <span class="n">top_n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                                        <span class="n">refresh_rate</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                                        <span class="n">group_by</span><span class="o">=</span><span class="s2">&quot;pid&quot;</span><span class="p">,</span>
                                                        <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;Mbps&quot;</span><span class="p">,</span>
                                                        <span class="n">protocols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;tcp&quot;</span><span class="p">,</span> <span class="s2">&quot;udp&quot;</span><span class="p">]</span>
                                                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_proc_net_monitor_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_proc_net_monitor</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proc_net_monitor_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_run_proc_net_monitor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ProcNetMonitor.run()ì„ ì‹¤í–‰í•˜ëŠ” ìŠ¤ë ˆë“œ.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proc_net_monitor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ëª¨ë“  ìž‘ì—… ì¢…ë£Œ</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># self.stop_event.set()</span>
        <span class="c1"># self.proc_net_monitor.is_running = False  # ì¢…ë£Œ ì‹ í˜¸ ì„¤ì •</span>
        <span class="c1"># self._proc_net_monitor_thread.join()</span>
        <span class="c1"># self.console.print(&quot;ProcNetMonitor stopped.&quot;, style=&quot;bold green&quot;)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Stopping ProcessMonitor...&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;bold yellow&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proc_net_monitor</span><span class="o">.</span><span class="n">is_running</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># ì¢…ë£Œ ì‹ í˜¸ ì„¤ì •</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proc_net_monitor_thread</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_proc_net_monitor_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;ProcessMonitor stopped.&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;bold green&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="ProcessMonitor.stop"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.ProcessMonitor.stop">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ëª¨ë“  ëª¨ë‹ˆí„°ë§ ìž‘ì—…ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Stopping ProcessMonitor...&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;bold yellow&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proc_net_monitor</span><span class="o">.</span><span class="n">is_running</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># ProcNetMonitor ë£¨í”„ ì¢…ë£Œ ì‹ í˜¸ ì„¤ì •</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proc_net_monitor_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>  <span class="c1"># ìŠ¤ë ˆë“œê°€ ì¢…ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;ProcessMonitor stopped.&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;bold green&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ProcessMonitor.get_top_processes"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.ProcessMonitor.get_top_processes">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_top_processes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">resource</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;memory&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]:</span>
        <span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">all_processes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">psutil</span><span class="o">.</span><span class="n">process_iter</span><span class="p">([</span><span class="s1">&#39;pid&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">resource</span> <span class="o">==</span> <span class="s2">&quot;cpu&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">proc</span> <span class="ow">in</span> <span class="n">all_processes</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">proc</span><span class="o">.</span><span class="n">cpu_percent</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="n">psutil</span><span class="o">.</span><span class="n">NoSuchProcess</span><span class="p">,</span> <span class="n">psutil</span><span class="o">.</span><span class="n">AccessDenied</span><span class="p">,</span> <span class="n">psutil</span><span class="o">.</span><span class="n">ZombieProcess</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
                    <span class="k">pass</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">proc</span> <span class="ow">in</span> <span class="n">all_processes</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">resource</span> <span class="o">==</span> <span class="s2">&quot;memory&quot;</span><span class="p">:</span>
                    <span class="n">memory_percent</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">memory_percent</span><span class="p">()</span>
                    <span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;pid&#39;</span><span class="p">:</span> <span class="n">proc</span><span class="o">.</span><span class="n">pid</span><span class="p">,</span>
                        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">proc</span><span class="o">.</span><span class="n">name</span><span class="p">(),</span>
                        <span class="s1">&#39;memory_percent&#39;</span><span class="p">:</span> <span class="n">memory_percent</span>
                    <span class="p">})</span>
                <span class="k">elif</span> <span class="n">resource</span> <span class="o">==</span> <span class="s2">&quot;cpu&quot;</span><span class="p">:</span>
                    <span class="n">cpu_percent</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">cpu_percent</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                    <span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;pid&#39;</span><span class="p">:</span> <span class="n">proc</span><span class="o">.</span><span class="n">pid</span><span class="p">,</span>
                        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">proc</span><span class="o">.</span><span class="n">name</span><span class="p">(),</span>
                        <span class="s1">&#39;cpu_percent&#39;</span><span class="p">:</span> <span class="n">cpu_percent</span>
                    <span class="p">})</span>
                <span class="k">elif</span> <span class="n">resource</span> <span class="o">==</span> <span class="s2">&quot;io&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;darwin&quot;</span><span class="p">:</span>
                        <span class="k">continue</span>  <span class="c1"># macOSì—ì„œëŠ” I/O ì¹´ìš´í„°ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</span>

                    <span class="n">io_counters</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">io_counters</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">io_counters</span><span class="p">:</span>
                        <span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;pid&#39;</span><span class="p">:</span> <span class="n">proc</span><span class="o">.</span><span class="n">pid</span><span class="p">,</span>
                            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">proc</span><span class="o">.</span><span class="n">name</span><span class="p">(),</span>
                            <span class="s1">&#39;io_read_bytes&#39;</span><span class="p">:</span> <span class="n">io_counters</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">,</span>
                            <span class="s1">&#39;io_write_bytes&#39;</span><span class="p">:</span> <span class="n">io_counters</span><span class="o">.</span><span class="n">write_bytes</span>
                        <span class="p">})</span>
                <span class="c1"># elif resource == &quot;network&quot;:</span>
                <span class="c1">#     net_usage = self.get_process_network_usage(proc.pid)</span>
                <span class="c1">#     if net_usage:</span>
                <span class="c1">#         processes.append(net_usage)</span>

            <span class="k">except</span> <span class="p">(</span><span class="n">psutil</span><span class="o">.</span><span class="n">NoSuchProcess</span><span class="p">,</span> <span class="n">psutil</span><span class="o">.</span><span class="n">AccessDenied</span><span class="p">,</span> <span class="n">psutil</span><span class="o">.</span><span class="n">ZombieProcess</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
                <span class="k">continue</span>

        <span class="c1"># ì •ë ¬ ë° ìƒìœ„ nê°œ ë°˜í™˜</span>
        <span class="k">if</span> <span class="n">resource</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">,</span> <span class="s2">&quot;cpu&quot;</span><span class="p">]:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;memory_percent&#39;</span> <span class="k">if</span> <span class="n">resource</span> <span class="o">==</span> <span class="s2">&quot;memory&quot;</span> <span class="k">else</span> <span class="s1">&#39;cpu_percent&#39;</span>
            <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">processes</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="n">n</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">resource</span> <span class="o">==</span> <span class="s2">&quot;io&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span>
                <span class="n">processes</span><span class="p">,</span>
                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;io_read_bytes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;io_write_bytes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)[:</span><span class="n">n</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">resource</span> <span class="o">==</span> <span class="s2">&quot;network&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span>
                <span class="n">processes</span><span class="p">,</span>
                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tx_bytes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rx_bytes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)[:</span><span class="n">n</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="ProcessMonitor.get_network_usage_from_monitor"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.ProcessMonitor.get_network_usage_from_monitor">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_network_usage_from_monitor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch network usage data from ProcNetMonitor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[Dict[str, Union[int, str, float]]]: Process network usage data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_net_monitor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[red]ProcNetMonitor instance is not available![/red]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Use ProcNetMonitor to fetch top N processes</span>
            <span class="c1"># res = self.proc_net_monitor.get_top_n(self.process_number)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_net_monitor</span><span class="o">.</span><span class="n">get_top_n</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_number</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red]Error fetching network usage: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/red]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="ProcessMonitor.create_resource_table"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.ProcessMonitor.create_resource_table">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_resource_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">processes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span> <span class="n">resource</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Table</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ë¦¬ì†ŒìŠ¤ ë°ì´í„°ì— ëŒ€í•œ ë¦¬ì¹˜ í…Œì´ë¸” ìƒì„±.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Top Processes by </span><span class="si">{</span><span class="n">resource</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2"> Usage&quot;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;PID&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">resource</span> <span class="o">==</span> <span class="s2">&quot;memory&quot;</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Memory %&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;magenta&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">resource</span> <span class="o">==</span> <span class="s2">&quot;cpu&quot;</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;CPU %&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;magenta&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">resource</span> <span class="o">==</span> <span class="s2">&quot;io&quot;</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;IO Read (MB)&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;IO Write (MB)&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">resource</span> <span class="o">==</span> <span class="s2">&quot;network&quot;</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;RX Bytes&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;TX Bytes&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">proc</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">resource</span> <span class="o">==</span> <span class="s2">&quot;memory&quot;</span><span class="p">:</span>
                <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">proc</span><span class="p">[</span><span class="s1">&#39;pid&#39;</span><span class="p">]),</span>
                    <span class="n">proc</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">proc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;memory_percent&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">resource</span> <span class="o">==</span> <span class="s2">&quot;cpu&quot;</span><span class="p">:</span>
                <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">proc</span><span class="p">[</span><span class="s1">&#39;pid&#39;</span><span class="p">]),</span>
                    <span class="n">proc</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">proc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cpu_percent&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">resource</span> <span class="o">==</span> <span class="s2">&quot;io&quot;</span><span class="p">:</span>
                <span class="n">read_mb</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;io_read_bytes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
                <span class="n">write_mb</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;io_write_bytes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
                <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">proc</span><span class="p">[</span><span class="s1">&#39;pid&#39;</span><span class="p">]),</span>
                    <span class="n">proc</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">read_mb</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">write_mb</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">resource</span> <span class="o">==</span> <span class="s2">&quot;network&quot;</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">proc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pid&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">)),</span>
                    <span class="n">proc</span><span class="p">[</span><span class="s1">&#39;comm&#39;</span><span class="p">],</span>
                    <span class="n">format_network_traffic</span><span class="p">(</span><span class="n">proc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tcp_sent_rate&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
                    <span class="n">format_network_traffic</span><span class="p">(</span><span class="n">proc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tcp_recv_rate&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
                <span class="p">]</span>
                <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="o">*</span><span class="n">row</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">table</span></div>


<div class="viewcode-block" id="ProcessMonitor.create_dashboard"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.ProcessMonitor.create_dashboard">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_dashboard</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Layout</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">memory_processes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_top_processes</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">process_number</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="s2">&quot;memory&quot;</span><span class="p">)</span>
            <span class="n">cpu_processes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_top_processes</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">process_number</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
            <span class="n">io_processes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_top_processes</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">process_number</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="s2">&quot;io&quot;</span><span class="p">)</span>

            <span class="c1"># Fetch network data from ProcNetMonitor</span>
            <span class="n">network_processes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network_usage_from_monitor</span><span class="p">()</span>
            <span class="n">memory_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_resource_table</span><span class="p">(</span><span class="n">memory_processes</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="s2">&quot;memory&quot;</span><span class="p">)</span>
            <span class="n">cpu_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_resource_table</span><span class="p">(</span><span class="n">cpu_processes</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
            <span class="n">io_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_resource_table</span><span class="p">(</span><span class="n">io_processes</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="s2">&quot;io&quot;</span><span class="p">)</span>
            <span class="n">network_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_resource_table</span><span class="p">(</span><span class="n">network_processes</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="s2">&quot;network&quot;</span><span class="p">)</span>

            <span class="n">memory_panel</span> <span class="o">=</span> <span class="n">Panel</span><span class="p">(</span><span class="n">memory_table</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;[bold magenta]Memory Usage[/bold magenta]&quot;</span><span class="p">,</span> <span class="n">border_style</span><span class="o">=</span><span class="s2">&quot;magenta&quot;</span><span class="p">)</span>
            <span class="n">cpu_panel</span> <span class="o">=</span> <span class="n">Panel</span><span class="p">(</span><span class="n">cpu_table</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;[bold cyan]CPU Usage[/bold cyan]&quot;</span><span class="p">,</span> <span class="n">border_style</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">)</span>
            <span class="n">io_panel</span> <span class="o">=</span> <span class="n">Panel</span><span class="p">(</span><span class="n">io_table</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;[bold yellow]I/O Usage[/bold yellow]&quot;</span><span class="p">,</span> <span class="n">border_style</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">)</span>
            <span class="n">network_panel</span> <span class="o">=</span> <span class="n">Panel</span><span class="p">(</span><span class="n">network_table</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;[bold yellow]Network Usage[/bold yellow]&quot;</span><span class="p">,</span> <span class="n">border_style</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">)</span>

            <span class="n">layout</span> <span class="o">=</span> <span class="n">Layout</span><span class="p">()</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">split_column</span><span class="p">(</span>
                <span class="n">Layout</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;row1&quot;</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">Layout</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;row2&quot;</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">layout</span><span class="p">[</span><span class="s2">&quot;row1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split_row</span><span class="p">(</span>
                <span class="n">Layout</span><span class="p">(</span><span class="n">memory_panel</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;memory&quot;</span><span class="p">),</span>
                <span class="n">Layout</span><span class="p">(</span><span class="n">cpu_panel</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">layout</span><span class="p">[</span><span class="s2">&quot;row2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split_row</span><span class="p">(</span>
                <span class="n">Layout</span><span class="p">(</span><span class="n">io_panel</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;io&quot;</span><span class="p">),</span>
                <span class="n">Layout</span><span class="p">(</span><span class="n">network_panel</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;network&quot;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">layout</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red]Error in create_dashboard: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/red]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Layout</span><span class="p">()</span></div>


<div class="viewcode-block" id="ProcessMonitor.run_live"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.ProcessMonitor.run_live">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_live</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">Live</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_dashboard</span><span class="p">(),</span> <span class="n">refresh_per_second</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">console</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="p">)</span> <span class="k">as</span> <span class="n">live</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc_net_monitor</span><span class="o">.</span><span class="n">is_running</span><span class="p">:</span>
                    <span class="n">live</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_dashboard</span><span class="p">())</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Stopping NetworkMonitor.&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;bold yellow&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="MemoryStatus"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.MemoryStatus">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">MemoryStatus</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proc_path</span><span class="o">=</span><span class="s2">&quot;/proc&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proc_path</span> <span class="o">=</span> <span class="n">proc_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_check_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cached_result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache_duration</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># ìºì‹œ ìœ íš¨ ì‹œê°„ (ì´ˆ)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory_history</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pressure_paths_checked</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># ê²½ë¡œ í™•ì¸ ì—¬ë¶€</span>

<div class="viewcode-block" id="MemoryStatus.read_stats_file"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.MemoryStatus.read_stats_file">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">read_stats_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MemoryStatus.parse_meminfo"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.MemoryStatus.parse_meminfo">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_meminfo</span><span class="p">(</span><span class="n">meminfo</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">meminfo</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="MemoryStatus.get_memory_pressure"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.MemoryStatus.get_memory_pressure">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_memory_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pressure_paths_checked</span><span class="p">:</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">proc_path</span><span class="si">}</span><span class="s1">/pressure/memory&#39;</span><span class="p">,</span> <span class="s1">&#39;/sys/fs/cgroup/memory.pressure&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">pressure</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pressure_paths_checked</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">return</span> <span class="p">{</span>
                            <span class="s2">&quot;some_avg10&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">pressure</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]),</span>
                            <span class="s2">&quot;some_avg60&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">pressure</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]),</span>
                            <span class="s2">&quot;some_avg300&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">pressure</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]),</span>
                            <span class="s2">&quot;full_avg10&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">pressure</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]),</span>
                            <span class="s2">&quot;full_avg60&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">pressure</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]),</span>
                            <span class="s2">&quot;full_avg300&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">pressure</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="p">}</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="c1"># self.pressure_paths_checked = False</span>
                    <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pressure_paths_checked</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="MemoryStatus.get_top_memory_processes"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.MemoryStatus.get_top_memory_processes">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_top_memory_processes</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]:</span>
        <span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">proc</span> <span class="ow">in</span> <span class="n">psutil</span><span class="o">.</span><span class="n">process_iter</span><span class="p">([</span><span class="s1">&#39;pid&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;memory_percent&#39;</span><span class="p">]):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;pid&#39;</span><span class="p">:</span> <span class="n">proc</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;pid&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">proc</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;memory_percent&#39;</span><span class="p">:</span> <span class="n">proc</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;memory_percent&#39;</span><span class="p">]</span>
                <span class="p">})</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">psutil</span><span class="o">.</span><span class="n">NoSuchProcess</span><span class="p">,</span> <span class="n">psutil</span><span class="o">.</span><span class="n">AccessDenied</span><span class="p">,</span> <span class="n">psutil</span><span class="o">.</span><span class="n">ZombieProcess</span><span class="p">):</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">processes</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;memory_percent&#39;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="n">n</span><span class="p">]</span></div>

<div class="viewcode-block" id="MemoryStatus.get_huge_pages_info"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.MemoryStatus.get_huge_pages_info">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_huge_pages_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="n">meminfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_meminfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_stats_file</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">proc_path</span><span class="si">}</span><span class="s2">/meminfo&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;HugePages_Total&quot;</span><span class="p">:</span> <span class="n">meminfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;HugePages_Total&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;HugePages_Free&quot;</span><span class="p">:</span> <span class="n">meminfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;HugePages_Free&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;HugePages_Rsvd&quot;</span><span class="p">:</span> <span class="n">meminfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;HugePages_Rsvd&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;HugePages_Surp&quot;</span><span class="p">:</span> <span class="n">meminfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;HugePages_Surp&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;Hugepagesize&quot;</span><span class="p">:</span> <span class="n">meminfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Hugepagesize&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="MemoryStatus.get_memory_status"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.MemoryStatus.get_memory_status">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_memory_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;GB&quot;</span><span class="p">,</span> <span class="n">output_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;dict&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">current_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_check_time</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_duration</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_result</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_result</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">meminfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_stats_file</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">proc_path</span><span class="si">}</span><span class="s2">/meminfo&quot;</span><span class="p">)</span>
            <span class="n">meminfo_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_meminfo</span><span class="p">(</span><span class="n">meminfo</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read memory information: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">units</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;KB&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;MB&quot;</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span> <span class="s2">&quot;GB&quot;</span><span class="p">:</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span> <span class="s2">&quot;TB&quot;</span><span class="p">:</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">unit</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">units</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid unit: </span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">. Choose from KB, MB, GB, TB.&quot;</span><span class="p">)</span>
        <span class="n">unit_multiplier</span> <span class="o">=</span> <span class="n">units</span><span class="p">[</span><span class="n">unit</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>

        <span class="n">total_mem</span> <span class="o">=</span> <span class="n">meminfo_dict</span><span class="p">[</span><span class="s2">&quot;MemTotal&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">unit_multiplier</span>
        <span class="n">free_mem</span> <span class="o">=</span> <span class="n">meminfo_dict</span><span class="p">[</span><span class="s2">&quot;MemFree&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">unit_multiplier</span>
        <span class="n">avail_mem</span> <span class="o">=</span> <span class="n">meminfo_dict</span><span class="p">[</span><span class="s2">&quot;MemAvailable&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">unit_multiplier</span>
        <span class="n">cached_mem</span> <span class="o">=</span> <span class="n">meminfo_dict</span><span class="p">[</span><span class="s2">&quot;Cached&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">unit_multiplier</span>
        <span class="n">buffers_mem</span> <span class="o">=</span> <span class="n">meminfo_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Buffers&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">unit_multiplier</span>
        <span class="n">swap_total</span> <span class="o">=</span> <span class="n">meminfo_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SwapTotal&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">unit_multiplier</span>
        <span class="n">swap_free</span> <span class="o">=</span> <span class="n">meminfo_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SwapFree&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">unit_multiplier</span>

        <span class="n">used_mem</span> <span class="o">=</span> <span class="n">total_mem</span> <span class="o">-</span> <span class="n">free_mem</span> <span class="o">-</span> <span class="n">cached_mem</span> <span class="o">-</span> <span class="n">buffers_mem</span>
        <span class="n">swap_used</span> <span class="o">=</span> <span class="n">swap_total</span> <span class="o">-</span> <span class="n">swap_free</span>
        <span class="n">percent_used</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">total_mem</span> <span class="o">-</span> <span class="n">avail_mem</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_mem</span>
        <span class="n">swap_percent</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">swap_used</span> <span class="o">/</span> <span class="n">swap_total</span> <span class="k">if</span> <span class="n">swap_total</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">total_mem</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="s2">&quot;used&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">used_mem</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="s2">&quot;free&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">free_mem</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="s2">&quot;available&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">avail_mem</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="s2">&quot;cached&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">cached_mem</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="s2">&quot;buffers&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">buffers_mem</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="s2">&quot;percent&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">percent_used</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="s2">&quot;swap_total&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">swap_total</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="s2">&quot;swap_used&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">swap_used</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="s2">&quot;swap_free&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">swap_free</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="s2">&quot;swap_percent&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">swap_percent</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="n">unit</span><span class="p">,</span>
            <span class="s2">&quot;pressure&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_memory_pressure</span><span class="p">(),</span>
            <span class="s2">&quot;top_processes&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_top_memory_processes</span><span class="p">(),</span>
            <span class="s2">&quot;huge_pages&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_huge_pages_info</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">memory_history</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">current_time</span><span class="p">,</span> <span class="n">percent_used</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">memory_history</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">memory_history</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;memory_trend&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">t</span><span class="p">,</span> <span class="s2">&quot;percent&quot;</span><span class="p">:</span> <span class="n">p</span><span class="p">}</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_history</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_check_time</span> <span class="o">=</span> <span class="n">current_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cached_result</span> <span class="o">=</span> <span class="n">result</span>

        <span class="k">if</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s2">&quot;dict&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">elif</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid output format: </span><span class="si">{</span><span class="n">output_format</span><span class="si">}</span><span class="s2">. Choose from dict, json, text.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MemoryStatus.check_memory_threshold"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.MemoryStatus.check_memory_threshold">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_memory_threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">90.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ìž„ê³„ê°’ì„ ì´ˆê³¼í•˜ëŠ”ì§€ í™•ì¸&quot;&quot;&quot;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_memory_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;percent&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold</span></div></div>


<div class="viewcode-block" id="SystemMonitor"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.SystemMonitor">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">SystemMonitor</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">proc_path</span><span class="o">=</span><span class="s2">&quot;/proc&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Interval must be a positive number greater than 0&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="n">interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proc_path</span> <span class="o">=</span> <span class="n">proc_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_net_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_net_dev</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_cpu_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_cpu_stat</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_disk_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_disk_stats</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mem_status</span> <span class="o">=</span> <span class="n">MemoryStatus</span><span class="p">(</span><span class="n">proc_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">proc_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cached_result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache_duration</span> <span class="o">=</span> <span class="mi">1</span>

<div class="viewcode-block" id="SystemMonitor.read_stats_file"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.SystemMonitor.read_stats_file">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">read_stats_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span></div>

<div class="viewcode-block" id="SystemMonitor.parse_net_dev"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.SystemMonitor.parse_net_dev">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">parse_net_dev</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_stats_file</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">proc_path</span><span class="si">}</span><span class="s2">/net/dev&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">iface</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">iface</span> <span class="o">==</span> <span class="s2">&quot;lo&quot;</span> <span class="ow">or</span> <span class="n">iface</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;sit&quot;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">data</span><span class="p">[</span><span class="n">iface</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;recv&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="s1">&#39;sent&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">9</span><span class="p">]),</span>
                <span class="s1">&#39;packets_recv&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                <span class="s1">&#39;packets_sent&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">10</span><span class="p">]),</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="SystemMonitor.parse_cpu_stat"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.SystemMonitor.parse_cpu_stat">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">parse_cpu_stat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_stats_file</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">proc_path</span><span class="si">}</span><span class="s2">/stat&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;cpu &quot;</span><span class="p">):</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span></div>

<div class="viewcode-block" id="SystemMonitor.get_cpu_status"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.SystemMonitor.get_cpu_status">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_cpu_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">end_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_cpu_stat</span><span class="p">()</span>
        <span class="n">start_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_cpu_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_cpu_data</span> <span class="o">=</span> <span class="n">end_values</span>

        <span class="n">diff</span> <span class="o">=</span> <span class="p">[</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span> <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">start_values</span><span class="p">,</span> <span class="n">end_values</span><span class="p">)]</span>
        <span class="n">total_diff</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

        <span class="n">us_percent</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">diff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_diff</span>
        <span class="n">sy_percent</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">diff</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_diff</span>
        <span class="n">id_percent</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">diff</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_diff</span>
        <span class="n">io_wait</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">diff</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_diff</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;usr&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">us_percent</span><span class="p">,</span> <span class="n">decimal</span><span class="p">),</span>
            <span class="s1">&#39;sys&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">sy_percent</span><span class="p">,</span> <span class="n">decimal</span><span class="p">),</span>
            <span class="s1">&#39;idle&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">id_percent</span><span class="p">,</span> <span class="n">decimal</span><span class="p">),</span>
            <span class="s1">&#39;io_wait&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">io_wait</span><span class="p">,</span> <span class="n">decimal</span><span class="p">)</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="SystemMonitor.collect_system_status"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.SystemMonitor.collect_system_status">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">collect_system_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">)</span>
        <span class="n">cpu_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_status</span><span class="p">()</span>
        <span class="n">network_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network_status</span><span class="p">()</span>
        <span class="n">disk_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_disk_usage</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">network_status</span><span class="p">,</span> <span class="n">cpu_status</span><span class="p">,</span> <span class="n">disk_stats</span></div>

<div class="viewcode-block" id="SystemMonitor.get_network_status"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.SystemMonitor.get_network_status">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_network_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">curr_net_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_net_dev</span><span class="p">()</span>
        <span class="n">interface_data</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">total_received</span> <span class="o">=</span> <span class="n">total_sent</span> <span class="o">=</span> <span class="n">total_packets_recv</span> <span class="o">=</span> <span class="n">total_packets_sent</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">iface</span><span class="p">,</span> <span class="n">curr</span> <span class="ow">in</span> <span class="n">curr_net_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_net_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">iface</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prev</span><span class="p">:</span>
                <span class="n">diff_recv</span> <span class="o">=</span> <span class="p">(</span><span class="n">curr</span><span class="p">[</span><span class="s1">&#39;recv&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;recv&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">/</span> <span class="mi">1_000_000</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span>  <span class="c1"># Bytes to Mb</span>
                <span class="n">diff_sent</span> <span class="o">=</span> <span class="p">(</span><span class="n">curr</span><span class="p">[</span><span class="s1">&#39;sent&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;sent&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">/</span> <span class="mi">1_000_000</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span>  <span class="c1"># Bytes to Mb</span>
                <span class="n">diff_packets_recv</span> <span class="o">=</span> <span class="n">curr</span><span class="p">[</span><span class="s1">&#39;packets_recv&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;packets_recv&#39;</span><span class="p">]</span>
                <span class="n">diff_packets_sent</span> <span class="o">=</span> <span class="n">curr</span><span class="p">[</span><span class="s1">&#39;packets_sent&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;packets_sent&#39;</span><span class="p">]</span>

                <span class="n">total_received</span> <span class="o">+=</span> <span class="n">diff_recv</span>
                <span class="n">total_sent</span> <span class="o">+=</span> <span class="n">diff_sent</span>
                <span class="n">total_packets_recv</span> <span class="o">+=</span> <span class="n">diff_packets_recv</span>
                <span class="n">total_packets_sent</span> <span class="o">+=</span> <span class="n">diff_packets_sent</span>

                <span class="n">interface_data</span><span class="p">[</span><span class="n">iface</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;recv&quot;</span><span class="p">:</span> <span class="n">diff_recv</span><span class="p">,</span>
                    <span class="s2">&quot;sent&quot;</span><span class="p">:</span> <span class="n">diff_sent</span><span class="p">,</span>
                    <span class="s2">&quot;packets_recv&quot;</span><span class="p">:</span> <span class="n">diff_packets_recv</span><span class="p">,</span>
                    <span class="s2">&quot;packets_sent&quot;</span><span class="p">:</span> <span class="n">diff_packets_sent</span><span class="p">,</span>
                <span class="p">}</span>

        <span class="n">interface_data</span><span class="p">[</span><span class="s2">&quot;Total&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;recv&quot;</span><span class="p">:</span> <span class="n">total_received</span><span class="p">,</span>
            <span class="s2">&quot;sent&quot;</span><span class="p">:</span> <span class="n">total_sent</span><span class="p">,</span>
            <span class="s2">&quot;packets_recv&quot;</span><span class="p">:</span> <span class="n">total_packets_recv</span><span class="p">,</span>
            <span class="s2">&quot;packets_sent&quot;</span><span class="p">:</span> <span class="n">total_packets_sent</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_net_data</span> <span class="o">=</span> <span class="n">curr_net_data</span>
        <span class="k">return</span> <span class="n">interface_data</span></div>

<div class="viewcode-block" id="SystemMonitor.read_disk_stats"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.SystemMonitor.read_disk_stats">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">read_disk_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">disk_stats</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_stats_file</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">proc_path</span><span class="si">}</span><span class="s2">/diskstats&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">disk_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">disk_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;sd&quot;</span><span class="p">,</span> <span class="s2">&quot;vd&quot;</span><span class="p">,</span> <span class="s2">&quot;nvme&quot;</span><span class="p">]):</span>
                <span class="n">disk_stats</span><span class="p">[</span><span class="n">disk_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;read_ios&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                    <span class="s1">&#39;read_bytes&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span> <span class="o">*</span> <span class="mi">512</span><span class="p">,</span>
                    <span class="s1">&#39;write_ios&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">7</span><span class="p">]),</span>
                    <span class="s1">&#39;write_bytes&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span> <span class="o">*</span> <span class="mi">512</span><span class="p">,</span>
                <span class="p">}</span>
        <span class="k">return</span> <span class="n">disk_stats</span></div>

<div class="viewcode-block" id="SystemMonitor.get_disk_usage"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.SystemMonitor.get_disk_usage">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_disk_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">curr_disk_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_disk_stats</span><span class="p">()</span>
        <span class="n">disk_usage</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">total_read_ios</span> <span class="o">=</span> <span class="n">total_write_ios</span> <span class="o">=</span> <span class="n">total_read_bytes</span> <span class="o">=</span> <span class="n">total_write_bytes</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">disk</span><span class="p">,</span> <span class="n">curr</span> <span class="ow">in</span> <span class="n">curr_disk_stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">disk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_disk_stats</span><span class="p">:</span>
                <span class="n">prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_disk_stats</span><span class="p">[</span><span class="n">disk</span><span class="p">]</span>
                <span class="n">read_ios</span> <span class="o">=</span> <span class="n">curr</span><span class="p">[</span><span class="s1">&#39;read_ios&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;read_ios&#39;</span><span class="p">]</span>
                <span class="n">read_bytes</span> <span class="o">=</span> <span class="n">curr</span><span class="p">[</span><span class="s1">&#39;read_bytes&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;read_bytes&#39;</span><span class="p">]</span>
                <span class="n">write_ios</span> <span class="o">=</span> <span class="n">curr</span><span class="p">[</span><span class="s1">&#39;write_ios&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;write_ios&#39;</span><span class="p">]</span>
                <span class="n">write_bytes</span> <span class="o">=</span> <span class="n">curr</span><span class="p">[</span><span class="s1">&#39;write_bytes&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">prev</span><span class="p">[</span><span class="s1">&#39;write_bytes&#39;</span><span class="p">]</span>

                <span class="n">disk_usage</span><span class="p">[</span><span class="n">disk</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;read_ios&#39;</span><span class="p">:</span> <span class="n">read_ios</span><span class="p">,</span>
                    <span class="s1">&#39;read_bytes&#39;</span><span class="p">:</span> <span class="n">read_bytes</span><span class="p">,</span>
                    <span class="s1">&#39;write_ios&#39;</span><span class="p">:</span> <span class="n">write_ios</span><span class="p">,</span>
                    <span class="s1">&#39;write_bytes&#39;</span><span class="p">:</span> <span class="n">write_bytes</span><span class="p">,</span>
                    <span class="s1">&#39;read_mb&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">read_bytes</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
                    <span class="s1">&#39;write_mb&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">write_bytes</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
                <span class="p">}</span>

                <span class="n">total_read_ios</span> <span class="o">+=</span> <span class="n">read_ios</span>
                <span class="n">total_write_ios</span> <span class="o">+=</span> <span class="n">write_ios</span>
                <span class="n">total_read_bytes</span> <span class="o">+=</span> <span class="n">read_bytes</span>
                <span class="n">total_write_bytes</span> <span class="o">+=</span> <span class="n">write_bytes</span>

        <span class="n">disk_usage</span><span class="p">[</span><span class="s1">&#39;Total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;read_ios&#39;</span><span class="p">:</span> <span class="n">total_read_ios</span><span class="p">,</span>
            <span class="s1">&#39;read_bytes&#39;</span><span class="p">:</span> <span class="n">total_read_bytes</span><span class="p">,</span>
            <span class="s1">&#39;write_ios&#39;</span><span class="p">:</span> <span class="n">total_write_ios</span><span class="p">,</span>
            <span class="s1">&#39;write_bytes&#39;</span><span class="p">:</span> <span class="n">total_write_bytes</span><span class="p">,</span>
            <span class="s1">&#39;read_mb&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">total_read_bytes</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
            <span class="s1">&#39;write_mb&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">total_write_bytes</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_disk_stats</span> <span class="o">=</span> <span class="n">curr_disk_stats</span>
        <span class="k">return</span> <span class="n">disk_usage</span></div>

<div class="viewcode-block" id="SystemMonitor.get_memory_status"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.SystemMonitor.get_memory_status">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_memory_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;GB&quot;</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mem_status</span><span class="o">.</span><span class="n">get_memory_status</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="SystemMonitor.get_system_status"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.SystemMonitor.get_system_status">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_system_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">)</span>
        <span class="n">network_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network_status</span><span class="p">()</span>
        <span class="n">cpu_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_status</span><span class="p">()</span>
        <span class="n">disk_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_disk_usage</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">network_status</span><span class="p">,</span> <span class="n">cpu_status</span><span class="p">,</span> <span class="n">disk_stats</span></div>

<div class="viewcode-block" id="SystemMonitor.print_memory_status"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.SystemMonitor.print_memory_status">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">print_memory_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mem_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_memory_status</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Memory Usage --&gt; </span><span class="si">{</span><span class="n">mem_status</span><span class="p">[</span><span class="s1">&#39;percent&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">% (</span><span class="si">{</span><span class="n">mem_status</span><span class="p">[</span><span class="s1">&#39;used&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">mem_status</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> Used / </span><span class="si">{</span><span class="n">mem_status</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">mem_status</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> Total)&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="get_netstat_count"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_netstat_count">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_netstat_count</span><span class="p">(</span><span class="n">proc_path</span><span class="o">=</span><span class="s2">&quot;/proc&quot;</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">netstate_kind</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;01&#39;</span><span class="p">:</span> <span class="s1">&#39;ESTAB&#39;</span><span class="p">,</span>
        <span class="s1">&#39;02&#39;</span><span class="p">:</span> <span class="s1">&#39;SYN_SENT&#39;</span><span class="p">,</span>
        <span class="s1">&#39;03&#39;</span><span class="p">:</span> <span class="s1">&#39;SYN_RECV&#39;</span><span class="p">,</span>
        <span class="s1">&#39;04&#39;</span><span class="p">:</span> <span class="s1">&#39;FIN_WAIT1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;05&#39;</span><span class="p">:</span> <span class="s1">&#39;FIN_WAIT2&#39;</span><span class="p">,</span>
        <span class="s1">&#39;06&#39;</span><span class="p">:</span> <span class="s1">&#39;TIME_WAIT&#39;</span><span class="p">,</span>
        <span class="s1">&#39;07&#39;</span><span class="p">:</span> <span class="s1">&#39;CLOSE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;08&#39;</span><span class="p">:</span> <span class="s1">&#39;CLOSE_WAIT&#39;</span><span class="p">,</span>
        <span class="s1">&#39;09&#39;</span><span class="p">:</span> <span class="s1">&#39;LAST_ACK&#39;</span><span class="p">,</span>
        <span class="s1">&#39;0A&#39;</span><span class="p">:</span> <span class="s1">&#39;LISTEN&#39;</span><span class="p">,</span>
        <span class="s1">&#39;0B&#39;</span><span class="p">:</span> <span class="s1">&#39;CLOSING&#39;</span>
    <span class="p">}</span>

    <span class="n">netstate_result</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;COUNT&quot;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
        <span class="c1"># &quot;DETAIL&quot;: defaultdict(lambda: defaultdict(int))</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">net_key</span><span class="p">,</span> <span class="n">net_value</span>  <span class="ow">in</span> <span class="n">netstate_kind</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">netstate_result</span><span class="p">[</span><span class="s2">&quot;COUNT&quot;</span><span class="p">][</span><span class="n">net_value</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">detail</span><span class="p">:</span>
        <span class="n">netstate_result</span><span class="p">[</span><span class="s1">&#39;DETAIL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">proc_path</span><span class="si">}</span><span class="s1">/net/tcp&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">lineno</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">lineno</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">lineno</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">line_list</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">local</span> <span class="o">=</span> <span class="n">convert_hex_to_ip_port</span><span class="p">(</span><span class="n">line_list</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">remote</span> <span class="o">=</span> <span class="n">convert_hex_to_ip_port</span><span class="p">(</span><span class="n">line_list</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">kind</span> <span class="o">=</span> <span class="n">netstate_kind</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">line_list</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

                <span class="n">netstate_result</span><span class="p">[</span><span class="s2">&quot;COUNT&quot;</span><span class="p">][</span><span class="n">kind</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">detail</span><span class="p">:</span>
                    <span class="n">local_port</span> <span class="o">=</span> <span class="n">local</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">remote_port</span> <span class="o">=</span> <span class="n">remote</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

                    <span class="k">if</span> <span class="s2">&quot;TIME_WAIT&quot;</span> <span class="ow">in</span> <span class="n">kind</span><span class="p">:</span>
                        <span class="n">port</span> <span class="o">=</span> <span class="n">remote_port</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">port</span> <span class="o">=</span> <span class="n">local_port</span>

                    <span class="n">netstate_result</span><span class="p">[</span><span class="s2">&quot;DETAIL&quot;</span><span class="p">][</span><span class="n">port</span><span class="p">][</span><span class="n">kind</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">netstate_result</span></div>


<div class="viewcode-block" id="convert_hex_to_ip_port"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.convert_hex_to_ip_port">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">convert_hex_to_ip_port</span><span class="p">(</span><span class="n">address</span><span class="p">):</span>
    <span class="n">hex_addr</span><span class="p">,</span> <span class="n">hex_port</span> <span class="o">=</span> <span class="n">address</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">addr_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">hex_addr</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">hex_addr</span><span class="p">),</span> <span class="mi">2</span><span class="p">)]</span>
    <span class="n">addr_list</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="n">addr</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">addr_list</span><span class="p">)</span>
    <span class="n">port</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">hex_port</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span></div>


<span class="k">def</span><span class="w"> </span><span class="nf">_line_split</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">d</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data_type</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">data_type</span><span class="p">()</span>


<div class="viewcode-block" id="get_rlimit_nofile"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_rlimit_nofile">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_rlimit_nofile</span><span class="p">(</span><span class="n">detail</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a dict with the current soft and hard limits of resource.</span>
<span class="sd">    If detail is True, it also includes the number of used file handles</span>
<span class="sd">    and their usage percentage.</span>

<span class="sd">    :param detail: If True, include used_handles and usage_percentage.</span>
<span class="sd">    :return: A dictionary containing &#39;soft&#39;, &#39;hard&#39;, and optionally &#39;used_handles&#39;, &#39;usage_percentage&#39;.</span>

<span class="sd">    Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pawnlib.resource import server</span>
<span class="sd">            server.get_rlimit_nofile(detail=True)</span>

<span class="sd">            ## &gt; {&#39;soft&#39;: 1024, &#39;hard&#39;: 4096, &#39;used_handles&#39;: 512, &#39;usage_percentage&#39;: 50.0}</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">soft</span><span class="p">,</span> <span class="n">hard</span> <span class="o">=</span> <span class="n">__resource</span><span class="o">.</span><span class="n">getrlimit</span><span class="p">(</span><span class="n">__resource</span><span class="o">.</span><span class="n">RLIMIT_NOFILE</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;soft&quot;</span><span class="p">:</span> <span class="n">soft</span><span class="p">,</span>
        <span class="s2">&quot;hard&quot;</span><span class="p">:</span> <span class="n">hard</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">detail</span><span class="p">:</span>
        <span class="c1"># Use lsof to count the number of currently open file handles</span>
        <span class="n">used_handles</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;lsof 2&gt;&amp;1 | grep -v &#39;no pwd entry for UID&#39;| wc -l&quot;</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="c1"># Calculate the percentage of used file handles</span>
        <span class="n">usage_percentage</span> <span class="o">=</span> <span class="p">(</span><span class="n">used_handles</span> <span class="o">/</span> <span class="n">soft</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">if</span> <span class="n">soft</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="c1"># Add these details to the result</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;used_handles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">used_handles</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;usage_percentage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">usage_percentage</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># Round to two decimal places</span>

    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="get_mac_platform_info"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_mac_platform_info">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_mac_platform_info</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :return:</span>

<span class="sd">    Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pawnlib.resource import server</span>
<span class="sd">            server.get_mac_platform_info()</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;system_profiler&#39;</span><span class="p">,</span> <span class="s1">&#39;SPHardwareDataType&#39;</span><span class="p">],</span>
        <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
        <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
    <span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">output</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;Chip:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_line_split</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;Total Number of Cores:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">_line_split</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">_line_split</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="n">tmp</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;cores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="get_platform_info"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_platform_info">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_platform_info</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a dict with platform information, including the specific operating system.</span>

<span class="sd">    :return: A dictionary containing platform information.</span>

<span class="sd">    Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pawnlib.resource import server</span>
<span class="sd">            server.get_platform_info()</span>

<span class="sd">            ## &gt; {&#39;system&#39;: &#39;Darwin&#39;, &#39;os&#39;: &#39;macOS&#39;, &#39;version&#39;: &#39;Darwin Kernel Version 21.6.0: Wed Aug 10 14:28:23 PDT 2022; root:xnu-8020.141.5~2/RELEASE_ARM64_T6000&#39;, &#39;release&#39;: &#39;21.6.0&#39;, &#39;machine&#39;: &#39;arm64&#39;, &#39;processor&#39;: &#39;arm&#39;, &#39;python_version&#39;: &#39;3.9.13&#39;, &#39;model&#39;: &#39;Apple M1 Pro&#39;, &#39;cores&#39;: 10}</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">uname</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">uname</span><span class="p">()</span>
        <span class="n">python_version</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">python_version</span><span class="p">()</span>
        <span class="n">os_name</span> <span class="o">=</span> <span class="s2">&quot;Unknown&quot;</span>

        <span class="k">if</span> <span class="n">uname</span><span class="o">.</span><span class="n">system</span> <span class="o">==</span> <span class="s2">&quot;Darwin&quot;</span><span class="p">:</span>
            <span class="n">os_name</span> <span class="o">=</span> <span class="s2">&quot;macOS&quot;</span>
        <span class="k">elif</span> <span class="n">uname</span><span class="o">.</span><span class="n">system</span> <span class="o">==</span> <span class="s2">&quot;Linux&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;/etc/os-release&quot;</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/etc/os-release&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ID=&quot;</span><span class="p">):</span>
                            <span class="n">os_name</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
                            <span class="k">break</span>
        <span class="k">elif</span> <span class="n">uname</span><span class="o">.</span><span class="n">system</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span><span class="p">:</span>
            <span class="n">os_name</span> <span class="o">=</span> <span class="s2">&quot;Windows&quot;</span>

        <span class="n">platform_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;system&quot;</span><span class="p">:</span> <span class="n">uname</span><span class="o">.</span><span class="n">system</span><span class="p">,</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="n">os_name</span><span class="p">,</span>
            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">uname</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
            <span class="s2">&quot;release&quot;</span><span class="p">:</span> <span class="n">uname</span><span class="o">.</span><span class="n">release</span><span class="p">,</span>
            <span class="s2">&quot;machine&quot;</span><span class="p">:</span> <span class="n">uname</span><span class="o">.</span><span class="n">machine</span><span class="p">,</span>
            <span class="s2">&quot;processor&quot;</span><span class="p">:</span> <span class="n">uname</span><span class="o">.</span><span class="n">processor</span><span class="p">,</span>
            <span class="s2">&quot;python_version&quot;</span><span class="p">:</span> <span class="n">python_version</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">platform_info</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">platform_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;system&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Darwin&quot;</span><span class="p">:</span>
        <span class="n">platform_info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">get_mac_platform_info</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/proc/cpuinfo&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">cpu_count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;model name&#39;</span><span class="p">):</span>
                            <span class="n">model_name</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="n">model</span> <span class="o">=</span> <span class="n">model_name</span>
                            <span class="n">cpu_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">platform_info</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span>
                <span class="n">platform_info</span><span class="p">[</span><span class="s1">&#39;cores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cpu_count</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">platform_info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">platform_info</span></div>


<div class="viewcode-block" id="parse_cpu_load"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.parse_cpu_load">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">parse_cpu_load</span><span class="p">(</span><span class="n">load_str</span><span class="p">):</span>
    <span class="n">load_list</span> <span class="o">=</span> <span class="n">load_str</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">cpu_load_dict</span> <span class="o">=</span> <span class="n">PrettyOrderedDict</span><span class="p">()</span>
    <span class="n">cpu_load_dict</span><span class="p">[</span><span class="s2">&quot;1min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">load_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">cpu_load_dict</span><span class="p">[</span><span class="s2">&quot;5min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">load_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">cpu_load_dict</span><span class="p">[</span><span class="s2">&quot;15min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">load_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cpu_load_dict</span></div>


<div class="viewcode-block" id="get_cpu_load"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_cpu_load">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_cpu_load</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns dict with current cpu load average</span>
<span class="sd">    :return:</span>

<span class="sd">    Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pawnlib.resource import server</span>
<span class="sd">            server.get_cpu_load()</span>
<span class="sd">            ## &gt; {&#39;1min&#39;: 12.29, &#39;5min&#39;: 11.01, &#39;15min&#39;: 11.09}</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">uname</span><span class="p">()</span><span class="o">.</span><span class="n">system</span> <span class="o">==</span> <span class="s2">&quot;Darwin&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_uptime_cmd</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/proc/loadavg&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">cpu_load</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">parse_cpu_load</span><span class="p">(</span><span class="n">cpu_load</span><span class="p">)</span></div>


<div class="viewcode-block" id="parse_proc_stat"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.parse_proc_stat">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">parse_proc_stat</span><span class="p">():</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/proc/stat&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="n">cpu_line</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;cpu &#39;</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">cpu_line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>  <span class="c1"># Skip the &#39;cpu&#39; prefix</span>
    <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">values</span></div>


<div class="viewcode-block" id="calculate_iowait_linux"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.calculate_iowait_linux">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_iowait_linux</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">initial_values</span> <span class="o">=</span> <span class="n">parse_proc_stat</span><span class="p">()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
    <span class="n">final_values</span> <span class="o">=</span> <span class="n">parse_proc_stat</span><span class="p">()</span>

    <span class="n">total_initial</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">initial_values</span><span class="p">)</span>
    <span class="n">total_final</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">final_values</span><span class="p">)</span>

    <span class="n">total_diff</span> <span class="o">=</span> <span class="n">total_final</span> <span class="o">-</span> <span class="n">total_initial</span>
    <span class="n">iowait_diff</span> <span class="o">=</span> <span class="n">final_values</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">initial_values</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>  <span class="c1"># iowait is the 5th value (index 4)</span>

    <span class="n">iowait_percentage</span> <span class="o">=</span> <span class="p">(</span><span class="n">iowait_diff</span> <span class="o">/</span> <span class="n">total_diff</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">iowait_percentage</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="run_command"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.run_command">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">run_command</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="n">command</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error running command </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">command</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="get_iowait"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_iowait">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_iowait</span><span class="p">():</span>
    <span class="n">system</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s1">&#39;Linux&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">calculate_iowait_linux</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported operating system: </span><span class="si">{</span><span class="n">system</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_uptime"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_uptime">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_uptime</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;posix&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;Darwin&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">uname</span><span class="p">()</span><span class="o">.</span><span class="n">sysname</span><span class="p">:</span>
            <span class="n">uptime_seconds</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;sysctl -n kern.boottime | awk &#39;{print $4}&#39; | sed &#39;s/,//&#39;&quot;</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">uptime_seconds</span> <span class="o">=</span> <span class="n">current_time</span> <span class="o">-</span> <span class="n">uptime_seconds</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Linux</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/proc/uptime&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">uptime_seconds</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">uptime_days</span> <span class="o">=</span> <span class="n">uptime_seconds</span> <span class="o">//</span> <span class="p">(</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">)</span>
        <span class="n">uptime_seconds</span> <span class="o">%=</span> <span class="p">(</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">)</span>
        <span class="n">uptime_hours</span> <span class="o">=</span> <span class="n">uptime_seconds</span> <span class="o">//</span> <span class="mi">3600</span>
        <span class="n">uptime_seconds</span> <span class="o">%=</span> <span class="mi">3600</span>
        <span class="n">uptime_minutes</span> <span class="o">=</span> <span class="n">uptime_seconds</span> <span class="o">//</span> <span class="mi">60</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">uptime_days</span><span class="p">)</span><span class="si">}</span><span class="s2"> days, </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">uptime_hours</span><span class="p">)</span><span class="si">}</span><span class="s2"> hours, </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">uptime_minutes</span><span class="p">)</span><span class="si">}</span><span class="s2"> minutes&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Not supported Uptime on this OS&quot;</span></div>

<div class="viewcode-block" id="get_swap_usage"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_swap_usage">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_swap_usage</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;posix&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Swap Usage: Not supported on this OS&quot;</span>

    <span class="k">if</span> <span class="s2">&quot;Darwin&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">uname</span><span class="p">()</span><span class="o">.</span><span class="n">sysname</span><span class="p">:</span>  <span class="c1"># macOS</span>
        <span class="k">return</span> <span class="n">get_macos_swap_usage</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Linux</span>
        <span class="k">return</span> <span class="n">get_linux_swap_usage</span><span class="p">()</span></div>


<div class="viewcode-block" id="get_macos_swap_usage"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_macos_swap_usage">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_macos_swap_usage</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">swap_info</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;sysctl vm.swapusage&quot;</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;total = (\d+\.\d+)M.*used = (\d+\.\d+)M&#39;</span><span class="p">,</span> <span class="n">swap_info</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected swap info format&quot;</span><span class="p">)</span>

        <span class="n">total_swap</span><span class="p">,</span> <span class="n">used_swap</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span>
        <span class="n">total_swap_gb</span> <span class="o">=</span> <span class="n">total_swap</span> <span class="o">/</span> <span class="mi">1024</span>
        <span class="n">used_swap_gb</span> <span class="o">=</span> <span class="n">used_swap</span> <span class="o">/</span> <span class="mi">1024</span>

        <span class="k">return</span> <span class="n">format_swap_usage</span><span class="p">(</span><span class="n">used_swap_gb</span><span class="p">,</span> <span class="n">total_swap_gb</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error getting swap usage: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span></div>


<div class="viewcode-block" id="get_linux_swap_usage"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_linux_swap_usage">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_linux_swap_usage</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/proc/meminfo&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">meminfo</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="n">total_swap</span> <span class="o">=</span> <span class="n">parse_meminfo_line</span><span class="p">(</span><span class="n">meminfo</span><span class="p">,</span> <span class="s2">&quot;SwapTotal&quot;</span><span class="p">)</span>
        <span class="n">free_swap</span> <span class="o">=</span> <span class="n">parse_meminfo_line</span><span class="p">(</span><span class="n">meminfo</span><span class="p">,</span> <span class="s2">&quot;SwapFree&quot;</span><span class="p">)</span>

        <span class="n">total_swap_gb</span> <span class="o">=</span> <span class="n">total_swap</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>
        <span class="n">used_swap_gb</span> <span class="o">=</span> <span class="p">(</span><span class="n">total_swap</span> <span class="o">-</span> <span class="n">free_swap</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>

        <span class="k">return</span> <span class="n">format_swap_usage</span><span class="p">(</span><span class="n">used_swap_gb</span><span class="p">,</span> <span class="n">total_swap_gb</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error getting swap usage: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span></div>


<div class="viewcode-block" id="parse_meminfo_line"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.parse_meminfo_line">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">parse_meminfo_line</span><span class="p">(</span><span class="n">meminfo</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">meminfo</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> not found in meminfo&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="format_swap_usage"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.format_swap_usage">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">format_swap_usage</span><span class="p">(</span><span class="n">used_swap_gb</span><span class="p">,</span> <span class="n">total_swap_gb</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">total_swap_gb</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;No swap configured&quot;</span>

    <span class="n">usage_percentage</span> <span class="o">=</span> <span class="p">(</span><span class="n">used_swap_gb</span> <span class="o">/</span> <span class="n">total_swap_gb</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">used_swap_gb</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> GB / </span><span class="si">{</span><span class="n">total_swap_gb</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> GB (</span><span class="si">{</span><span class="n">usage_percentage</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%)&quot;</span></div>


<div class="viewcode-block" id="get_uptime_cmd"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_uptime_cmd">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_uptime_cmd</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns dict with current cpu load average using uptime command</span>
<span class="sd">    :return:</span>

<span class="sd">    Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pawnlib.resource import server</span>
<span class="sd">            server.get_uptime_cmd()</span>
<span class="sd">            ## &gt; {&#39;1min&#39;: 12.29, &#39;5min&#39;: 11.01, &#39;15min&#39;: 11.09}</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">raw</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="s1">&#39;uptime&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">load_raw</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;load averages:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="c1"># load_list = load_raw.split(&#39; &#39;)</span>
    <span class="k">return</span> <span class="n">parse_cpu_load</span><span class="p">(</span><span class="n">load_raw</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_load_average"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_load_average">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_load_average</span><span class="p">():</span>
    <span class="n">load1</span><span class="p">,</span> <span class="n">load5</span><span class="p">,</span> <span class="n">load15</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getloadavg</span><span class="p">()</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">load1</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">load5</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">load15</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> (1, 5, 15 minutes)&quot;</span></div>


<div class="viewcode-block" id="get_total_memory_usage"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_total_memory_usage">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_total_memory_usage</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Returns float with current memory usage using ps command</span>
<span class="sd">    :return: kilo bytes</span>

<span class="sd">    Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pawnlib.resource import server</span>
<span class="sd">            server.get_total_memory_usage()</span>

<span class="sd">            ## &gt; 24246272.0</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">&#39;ps&#39;</span><span class="p">,</span> <span class="s1">&#39;-caxm&#39;</span><span class="p">,</span> <span class="s1">&#39;-orss,comm&#39;</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="n">process_lines</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">sep</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;[\s]+&#39;</span><span class="p">)</span>
    <span class="n">rss_total</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># kB</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">process_lines</span><span class="p">)):</span>
        <span class="n">row_text</span> <span class="o">=</span> <span class="n">process_lines</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">row_elements</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">row_text</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">rss</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1024</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">rss</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># ignore...</span>
        <span class="n">rss_total</span> <span class="o">+=</span> <span class="n">rss</span>

    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">rss_total</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_mem_osx_info"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_mem_osx_info">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_mem_osx_info</span><span class="p">():</span>
    <span class="n">vm</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">&#39;vm_stat&#39;</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="c1"># Process vm_stat</span>
    <span class="n">vm_lines</span> <span class="o">=</span> <span class="n">vm</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">sep</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;:[\s]+&#39;</span><span class="p">)</span>
    <span class="n">vm_stats</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">vm_lines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">row_text</span> <span class="o">=</span> <span class="n">vm_lines</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">row_elements</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">row_text</span><span class="p">)</span>
        <span class="n">vm_stats</span><span class="p">[(</span><span class="n">row_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row_elements</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;\.&#39;</span><span class="p">))</span> <span class="o">*</span> <span class="mi">4096</span>

    <span class="c1"># print(&#39;Wired Memory:\t\t%d MB&#39; % (vm_stats[&quot;Pages wired down&quot;] / 1024 / 1024))</span>
    <span class="c1"># print(&#39;Active Memory:\t\t%d MB&#39; % (vm_stats[&quot;Pages active&quot;] / 1024 / 1024))</span>
    <span class="c1"># print(&#39;Inactive Memory:\t%d MB&#39; % (vm_stats[&quot;Pages inactive&quot;] / 1024 / 1024))</span>
    <span class="c1"># print(&#39;Free Memory:\t\t%d MB&#39; % (vm_stats[&quot;Pages free&quot;] / 1024 / 1024))</span>
    <span class="c1"># print(&#39;Real Mem Total (ps):\t%.3f MB&#39; % (rssTotal/1024/1024))</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;mem_total&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">sysconf</span><span class="p">(</span><span class="s1">&#39;SC_PAGE_SIZE&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">os</span><span class="o">.</span><span class="n">sysconf</span><span class="p">(</span><span class="s1">&#39;SC_PHYS_PAGES&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">,</span>
        <span class="s1">&#39;mem_free&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">vm_stats</span><span class="p">[</span><span class="s2">&quot;Pages free&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">vm_stats</span><span class="p">[</span><span class="s2">&quot;Pages inactive&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">,</span>
        <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">vm_stats</span><span class="p">[</span><span class="s2">&quot;Pages wired down&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">vm_stats</span><span class="p">[</span><span class="s2">&quot;Pages active&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">vm_stats</span><span class="p">[</span><span class="s2">&quot;Pages inactive&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">vm_stats</span><span class="p">[</span><span class="s2">&quot;Pages free&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">1024</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="get_mem_info"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_mem_info">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_mem_info</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="s2">&quot;GB&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in the /proc/meminfo and return a dictionary of the memory and swap</span>
<span class="sd">    usage for all processes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">units</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;KB&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;MB&quot;</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span> <span class="s2">&quot;GB&quot;</span><span class="p">:</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">unit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">units</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid unit. Expected one of: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">convert_unit</span> <span class="o">=</span> <span class="n">units</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mem_total&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;mem_used&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;mem_free&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;swap_total&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;swap_used&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;swap_free&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;buffers&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;cached&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">uname</span><span class="p">()</span><span class="o">.</span><span class="n">system</span> <span class="o">==</span> <span class="s2">&quot;Darwin&quot;</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">get_mem_osx_info</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/proc/meminfo&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;MemTotal:&#39;</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mem_total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;MemFree:&#39;</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mem_free&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Buffers:&#39;</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;buffers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Cached:&#39;</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;cached&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SwapTotal:&#39;</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;swap_total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SwapFree:&#39;</span><span class="p">:</span> \
                        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;swap_free&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mem_used&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mem_total&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mem_free&#39;</span><span class="p">]</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;swap_used&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;swap_total&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;swap_free&#39;</span><span class="p">]</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">convert_values_to_unit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">convert_unit</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unit</span>

    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="convert_values_to_unit"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.convert_values_to_unit">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">convert_values_to_unit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">convert_unit</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">v</span> <span class="o">/</span> <span class="n">convert_unit</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="get_cpu_time"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_cpu_time">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_cpu_time</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads /proc/stat to gather CPU time statistics for each CPU core.</span>
<span class="sd">    Returns a dictionary with CPU IDs and their respective time metrics.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cpu_infos</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;/proc/stat&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cpu_infos</span>  <span class="c1"># Return empty dict if /proc/stat is unavailable</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/proc/stat&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_stat</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file_stat</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">if</span> <span class="n">field</span><span class="p">]</span>  <span class="c1"># Remove empty strings</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>  <span class="c1"># Basic validation for expected fields</span>
                <span class="k">continue</span>

            <span class="n">cpu_id</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">times</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>  <span class="c1"># Convert to floats</span>
            <span class="n">user</span><span class="p">,</span> <span class="n">nice</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">idle</span><span class="p">,</span> <span class="n">iowait</span> <span class="o">=</span> <span class="n">times</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>  <span class="c1"># Core fields</span>
            <span class="c1"># Optional fields (irq, softirq, etc.) may not always be present</span>
            <span class="n">irq</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">softirq</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">steal</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">7</span> <span class="k">else</span> <span class="mi">0</span>

            <span class="n">idle_time</span> <span class="o">=</span> <span class="n">idle</span> <span class="o">+</span> <span class="n">iowait</span>
            <span class="n">non_idle_time</span> <span class="o">=</span> <span class="n">user</span> <span class="o">+</span> <span class="n">nice</span> <span class="o">+</span> <span class="n">system</span> <span class="o">+</span> <span class="n">irq</span> <span class="o">+</span> <span class="n">softirq</span> <span class="o">+</span> <span class="n">steal</span>
            <span class="n">total_time</span> <span class="o">=</span> <span class="n">idle_time</span> <span class="o">+</span> <span class="n">non_idle_time</span>

            <span class="n">cpu_infos</span><span class="p">[</span><span class="n">cpu_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="n">total_time</span><span class="p">,</span>
                <span class="s1">&#39;idle&#39;</span><span class="p">:</span> <span class="n">idle_time</span><span class="p">,</span>
                <span class="s1">&#39;iowait&#39;</span><span class="p">:</span> <span class="n">iowait</span>
            <span class="p">}</span>
    <span class="k">return</span> <span class="n">cpu_infos</span></div>


<div class="viewcode-block" id="get_cpu_usage_percentage"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_cpu_usage_percentage">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_cpu_usage_percentage</span><span class="p">(</span><span class="n">interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates CPU usage percentage over a given interval.</span>
<span class="sd">    Returns a dictionary with CPU usage percentages per core, average, and iowait.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">get_cpu_time</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">start</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">get_cpu_time</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">end</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="n">cpu_usages</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">iowait_usages</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">cpu</span> <span class="ow">in</span> <span class="n">start</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cpu</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">end</span><span class="p">:</span>
            <span class="k">continue</span>  <span class="c1"># Skip if CPU data is missing in end snapshot</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">diff_total</span> <span class="o">=</span> <span class="n">end</span><span class="p">[</span><span class="n">cpu</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">start</span><span class="p">[</span><span class="n">cpu</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span>
            <span class="n">diff_idle</span> <span class="o">=</span> <span class="n">end</span><span class="p">[</span><span class="n">cpu</span><span class="p">][</span><span class="s1">&#39;idle&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">start</span><span class="p">[</span><span class="n">cpu</span><span class="p">][</span><span class="s1">&#39;idle&#39;</span><span class="p">]</span>
            <span class="n">diff_iowait</span> <span class="o">=</span> <span class="n">end</span><span class="p">[</span><span class="n">cpu</span><span class="p">][</span><span class="s1">&#39;iowait&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">start</span><span class="p">[</span><span class="n">cpu</span><span class="p">][</span><span class="s1">&#39;iowait&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">diff_total</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Avoid division by zero or negative time</span>
                <span class="n">cpu_usage_percentage</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cpu_usage_percentage</span> <span class="o">=</span> <span class="p">(</span><span class="n">diff_total</span> <span class="o">-</span> <span class="n">diff_idle</span><span class="p">)</span> <span class="o">/</span> <span class="n">diff_total</span> <span class="o">*</span> <span class="mi">100</span>

            <span class="n">cpu_usages</span><span class="p">[</span><span class="n">cpu</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">cpu_usage_percentage</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">iowait_usages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diff_iowait</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Missing data for </span><span class="si">{</span><span class="n">cpu</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

    <span class="k">if</span> <span class="n">cpu_usages</span><span class="p">:</span>
        <span class="n">cpu_usages</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">cpu_usages</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">cpu_usages</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">cpu_usages</span><span class="p">[</span><span class="s1">&#39;iowait&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">iowait_usages</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">iowait_usages</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cpu_usages</span></div>


<div class="viewcode-block" id="get_aws_metadata"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_aws_metadata">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_aws_metadata</span><span class="p">(</span><span class="n">meta_ip</span><span class="o">=</span><span class="s2">&quot;169.254.169.254&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">meta_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;http://</span><span class="si">{</span><span class="n">meta_ip</span><span class="si">}</span><span class="s1">/latest&#39;</span>
    <span class="c1"># those 3 top subdirectories are not exposed with a final &#39;/&#39;</span>
    <span class="n">metadict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dynamic&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;meta-data&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;user-data&#39;</span><span class="p">:</span> <span class="p">{}}</span>
    <span class="k">for</span> <span class="n">sub_sect</span> <span class="ow">in</span> <span class="n">metadict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">aws_data_crawl</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meta_url</span><span class="p">,</span> <span class="n">sub_sect</span><span class="p">),</span> <span class="n">metadict</span><span class="p">[</span><span class="n">sub_sect</span><span class="p">],</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">metadict</span></div>


<div class="viewcode-block" id="aws_data_crawl"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.aws_data_crawl">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">aws_data_crawl</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">timeout</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">jequest</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status_code&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">404</span> <span class="ow">or</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status_code&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">999</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">l</span><span class="p">:</span> <span class="c1"># &quot;instance-identity/\n&quot; case</span>
            <span class="k">continue</span>
        <span class="n">new_url</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
        <span class="c1"># a key is detected with a final &#39;/&#39;</span>
        <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">):</span>
            <span class="n">new_key</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">d</span><span class="p">[</span><span class="n">new_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">aws_data_crawl</span><span class="p">(</span><span class="n">new_url</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="n">new_key</span><span class="p">],</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">jequest</span><span class="p">(</span><span class="n">new_url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">):</span>
                <span class="n">d</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_kakao_metadata"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_kakao_metadata">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_kakao_metadata</span><span class="p">(</span><span class="n">meta_ip</span><span class="o">=</span><span class="s2">&quot;169.254.169.254&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">2.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves metadata from Kakao Cloud instance.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        meta_ip (str): IP address of the metadata service</span>
<span class="sd">        timeout (float): Timeout for HTTP requests in seconds</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Metadata from Kakao Cloud instance</span>

<span class="sd">    Raises:</span>
<span class="sd">        MetadataError: When metadata retrieval fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;http://</span><span class="si">{</span><span class="n">meta_ip</span><span class="si">}</span><span class="s2">/latest&quot;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X-aws-ec2-metadata-token&#39;</span><span class="p">:</span> <span class="s1">&#39;required&#39;</span><span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;dynamic&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s2">&quot;meta-data&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s2">&quot;user-data&quot;</span><span class="p">:</span> <span class="p">{}</span>
        <span class="p">}</span>

        <span class="c1"># Get meta-data</span>
        <span class="n">meta_data</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;meta-data&quot;</span><span class="p">]</span>
        <span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;ami-id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/meta-data/ami-id&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;ami-launch-index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/meta-data/ami-launch-index&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;ami-manifest-path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/meta-data/ami-manifest-path&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>

        <span class="c1"># Get block-device-mapping</span>
        <span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;block-device-mapping&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;ami&quot;</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/meta-data/block-device-mapping/ami&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="s2">&quot;ebs0&quot;</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/meta-data/block-device-mapping/ebs0&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="s2">&quot;root&quot;</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/meta-data/block-device-mapping/root&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="p">}</span>

        <span class="c1"># Get instance information</span>
        <span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;hostname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/meta-data/hostname&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;instance-action&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/meta-data/instance-action&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;instance-id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/meta-data/instance-id&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;instance-type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/meta-data/instance-type&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;local-hostname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/meta-data/local-hostname&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;local-ipv4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/meta-data/local-ipv4&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>

        <span class="c1"># Get placement information</span>
        <span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;placement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;availability-zone&quot;</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/meta-data/placement/availability-zone&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="p">}</span>

        <span class="c1"># Get network information</span>
        <span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;public-hostname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/meta-data/public-hostname&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;public-ipv4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/meta-data/public-ipv4&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>

        <span class="c1"># Get security information</span>
        <span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;public-keys&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;0=kakao&quot;</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/meta-data/public-keys/0/openssh-key&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">}</span>
        <span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;reservation-id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/meta-data/reservation-id&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;security-groups&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/meta-data/security-groups&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>

        <span class="k">return</span> <span class="n">metadata</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to retrieve Kakao Cloud metadata: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_gcp_metadata"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_gcp_metadata">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_gcp_metadata</span><span class="p">(</span><span class="n">meta_ip</span><span class="o">=</span><span class="s2">&quot;metadata.google.internal&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">meta_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;http://</span><span class="si">{</span><span class="n">meta_ip</span><span class="si">}</span><span class="s1">/computeMetadata/v1/&#39;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Metadata-Flavor&#39;</span><span class="p">:</span> <span class="s1">&#39;Google&#39;</span><span class="p">}</span>
    <span class="n">metadict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fetch_metadata</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">meta_url</span><span class="si">}{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
                <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Non-200 status code </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> for URL: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[]</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching GCP metadata at </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">crawl</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">fetch_metadata</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
                <span class="n">metadict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">crawl</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">item_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">meta_url</span><span class="si">}{</span><span class="n">path</span><span class="si">}{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                        <span class="n">metadict</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch metadata for </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">. Status code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">metadict</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching GCP metadata at </span><span class="si">{</span><span class="n">item_url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">metadict</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">crawl</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">metadict</span></div>


<div class="viewcode-block" id="get_oci_metadata_async"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_oci_metadata_async">[docs]</a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_oci_metadata_async</span><span class="p">(</span><span class="n">meta_ip</span><span class="o">=</span><span class="s2">&quot;169.254.169.254&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">meta_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;http://</span><span class="si">{</span><span class="n">meta_ip</span><span class="si">}</span><span class="s1">/opc/v1/&#39;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s1">&#39;Bearer Oracle&#39;</span><span class="p">}</span>
    <span class="n">metadict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientTimeout</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">timeout</span><span class="p">))</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_metadata</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">meta_url</span><span class="si">}{</span><span class="n">path</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">None</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                    <span class="k">return</span> <span class="n">text</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># ì˜ˆì œ: ì£¼ìš” ë©”íƒ€ë°ì´í„° í•­ëª©ë§Œ ìˆ˜ì§‘</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;instance/id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;instance/ocid&quot;</span><span class="p">,</span>
            <span class="s2">&quot;instance/region&quot;</span><span class="p">,</span>
            <span class="s2">&quot;instance/display-name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;instance/availability-domain&quot;</span><span class="p">,</span>
            <span class="s2">&quot;instance/compartment-id&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">crawl</span><span class="p">():</span>
            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
                <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">fetch_metadata</span><span class="p">(</span><span class="n">path</span><span class="p">)))</span>
            <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">metadict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>

        <span class="k">await</span> <span class="n">crawl</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">metadict</span></div>

<div class="viewcode-block" id="get_oci_metadata"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.get_oci_metadata">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_oci_metadata</span><span class="p">(</span><span class="n">meta_ip</span><span class="o">=</span><span class="s2">&quot;169.254.169.254&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">get_oci_metadata_async</span><span class="p">(</span><span class="n">meta_ip</span><span class="p">,</span> <span class="n">timeout</span><span class="p">))</span></div>


<div class="viewcode-block" id="io_flags_to_string"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.io_flags_to_string">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">io_flags_to_string</span><span class="p">(</span><span class="n">flags</span><span class="p">):</span>
    <span class="n">flag_descriptions</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">os</span><span class="o">.</span><span class="n">O_RDONLY</span><span class="p">:</span> <span class="s1">&#39;O_RDONLY&#39;</span><span class="p">,</span>
        <span class="n">os</span><span class="o">.</span><span class="n">O_WRONLY</span><span class="p">:</span> <span class="s1">&#39;O_WRONLY&#39;</span><span class="p">,</span>
        <span class="n">os</span><span class="o">.</span><span class="n">O_RDWR</span><span class="p">:</span> <span class="s1">&#39;O_RDWR&#39;</span><span class="p">,</span>
        <span class="n">os</span><span class="o">.</span><span class="n">O_CREAT</span><span class="p">:</span> <span class="s1">&#39;O_CREAT&#39;</span><span class="p">,</span>
        <span class="n">os</span><span class="o">.</span><span class="n">O_EXCL</span><span class="p">:</span> <span class="s1">&#39;O_EXCL&#39;</span><span class="p">,</span>
        <span class="n">os</span><span class="o">.</span><span class="n">O_TRUNC</span><span class="p">:</span> <span class="s1">&#39;O_TRUNC&#39;</span><span class="p">,</span>
        <span class="n">os</span><span class="o">.</span><span class="n">O_APPEND</span><span class="p">:</span> <span class="s1">&#39;O_APPEND&#39;</span><span class="p">,</span>
        <span class="n">os</span><span class="o">.</span><span class="n">O_NONBLOCK</span><span class="p">:</span> <span class="s1">&#39;O_NONBLOCK&#39;</span><span class="p">,</span>
        <span class="n">os</span><span class="o">.</span><span class="n">O_SYNC</span><span class="p">:</span> <span class="s1">&#39;O_SYNC&#39;</span><span class="p">,</span>
        <span class="n">os</span><span class="o">.</span><span class="n">O_DSYNC</span><span class="p">:</span> <span class="s1">&#39;O_DSYNC&#39;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s1">&#39;O_RSYNC&#39;</span><span class="p">):</span>
        <span class="n">flag_descriptions</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">O_RSYNC</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;O_RSYNC&#39;</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">flag_descriptions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>


<div class="viewcode-block" id="DiskUsage"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.DiskUsage">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">DiskUsage</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_partitions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;/System/Volumes&quot;</span><span class="p">,</span> <span class="s2">&quot;/private/var/folders/&quot;</span><span class="p">,</span> <span class="s2">&quot;/sys&quot;</span><span class="p">,</span> <span class="s2">&quot;/proc&quot;</span><span class="p">,</span> <span class="s2">&quot;/dev&quot;</span><span class="p">,</span> <span class="s2">&quot;/run/docker/netns&quot;</span><span class="p">,</span> <span class="s2">&quot;/var/lib/docker&quot;</span><span class="p">,</span>
            <span class="s2">&quot;/run&quot;</span><span class="p">,</span> <span class="s2">&quot;/snap&quot;</span><span class="p">,</span> <span class="s2">&quot;/boot/efi&quot;</span><span class="p">,</span> <span class="s2">&quot;/var/lib/nfs/rpc_pipefs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;/var/run&quot;</span><span class="p">,</span>  <span class="s2">&quot;/var/lock&quot;</span><span class="p">,</span> <span class="s2">&quot;/media&quot;</span> <span class="p">,</span> <span class="s2">&quot;/mnt&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit_factors</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;KB&quot;</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span>
            <span class="s2">&quot;MB&quot;</span><span class="p">:</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;GB&quot;</span><span class="p">:</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
            <span class="s2">&quot;TB&quot;</span><span class="p">:</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">4</span><span class="p">,</span>
            <span class="s2">&quot;PB&quot;</span><span class="p">:</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">5</span>
        <span class="p">}</span>

<div class="viewcode-block" id="DiskUsage.match_list"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.DiskUsage.match_list">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">match_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the text matches any pattern in the list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="DiskUsage.get_mount_points"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.DiskUsage.get_mount_points">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_mount_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of all mount points along with their device names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mount_points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Darwin&#39;</span><span class="p">:</span>  <span class="c1"># macOS</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;df&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">device_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">mount_point</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ignore_partitions</span><span class="p">,</span> <span class="n">mount_point</span><span class="p">):</span>
                        <span class="n">mount_points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">device_name</span><span class="p">,</span> <span class="n">mount_point</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error occurred while running df: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Linux&#39;</span><span class="p">:</span>  <span class="c1"># Linux</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/proc/mounts&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">device_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">mount_point</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ignore_partitions</span><span class="p">,</span> <span class="n">mount_point</span><span class="p">):</span>
                            <span class="n">mount_points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">device_name</span><span class="p">,</span> <span class="n">mount_point</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Unsupported operating system&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mount_points</span></div>



<div class="viewcode-block" id="DiskUsage.get_disk_usage"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.DiskUsage.get_disk_usage">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_disk_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mount_point</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;GB&quot;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get disk usage information for a specific mount point or all mount points.</span>

<span class="sd">        :param mount_point: Mount point to check. Use &quot;/&quot;, &quot;/home&quot;, or &quot;all&quot;.</span>
<span class="sd">        :param unit: Unit for disk usage. Can be &quot;B&quot;, &quot;KB&quot;, &quot;MB&quot;, &quot;GB&quot;, &quot;TB&quot;, or &quot;auto&quot;. Default is &quot;GB&quot;.</span>
<span class="sd">        :param precision: Number of decimal places for the output. Default is 2.</span>
<span class="sd">        :return: Disk usage information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_factors</span> <span class="ow">and</span> <span class="n">unit</span> <span class="o">!=</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported unit: </span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">. Supported units are B, KB, MB, GB, TB, auto.&quot;</span><span class="p">)</span>

        <span class="n">disk_info</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">mount_point</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">device_name</span><span class="p">,</span> <span class="n">mp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mount_points</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">ismount</span><span class="p">(</span><span class="n">mp</span><span class="p">):</span>
                    <span class="n">disk_info</span><span class="p">[</span><span class="n">mp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;device&#39;</span><span class="p">:</span> <span class="n">device_name</span><span class="p">,</span>
                        <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">calculate_disk_usage_with_auto_unit</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
                    <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">ismount</span><span class="p">(</span><span class="n">mount_point</span><span class="p">):</span>
                <span class="n">device_name</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">dev</span> <span class="k">for</span> <span class="n">dev</span><span class="p">,</span> <span class="n">mp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mount_points</span><span class="p">()</span> <span class="k">if</span> <span class="n">mp</span> <span class="o">==</span> <span class="n">mount_point</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">disk_info</span><span class="p">[</span><span class="n">mount_point</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;device&#39;</span><span class="p">:</span> <span class="n">device_name</span><span class="p">,</span>
                    <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">calculate_disk_usage_with_auto_unit</span><span class="p">(</span><span class="n">mount_point</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mount_point</span><span class="si">}</span><span class="s2"> is not a valid mount point&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">disk_info</span></div>

    <span class="c1"># @staticmethod</span>
    <span class="c1"># def calculate_disk_usage(mount_point, factor, precision, unit):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     Helper function to calculate disk usage for a given mount point.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     total, used, free = shutil.disk_usage(mount_point)</span>
    <span class="c1">#     return {</span>
    <span class="c1">#         &quot;total&quot;: round(total / factor, precision),</span>
    <span class="c1">#         &quot;used&quot;: round(used / factor, precision),</span>
    <span class="c1">#         &quot;free&quot;: round(free / factor, precision),</span>
    <span class="c1">#         &quot;percent&quot;: round(used / total * 100, precision) if total &gt; 0 else 0,</span>
    <span class="c1">#         &quot;unit&quot;: unit</span>
    <span class="c1">#     }</span>
    <span class="c1">#</span>
    <span class="c1"># def calculate_disk_usage_with_auto_unit(self, mount_point, precision, unit):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     Calculate disk usage with automatic unit selection if &#39;auto&#39; is specified.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     total, used, free = shutil.disk_usage(mount_point)</span>
    <span class="c1">#</span>
    <span class="c1">#     if unit == &quot;auto&quot;:</span>
    <span class="c1">#         if total &gt;= self.unit_factors[&quot;PB&quot;]:</span>
    <span class="c1">#             factor = self.unit_factors[&quot;PB&quot;]</span>
    <span class="c1">#             unit = &quot;PB&quot;</span>
    <span class="c1">#         elif total &gt;= self.unit_factors[&quot;TB&quot;]:</span>
    <span class="c1">#             factor = self.unit_factors[&quot;TB&quot;]</span>
    <span class="c1">#             unit = &quot;TB&quot;</span>
    <span class="c1">#         elif total &gt;= self.unit_factors[&quot;GB&quot;]:</span>
    <span class="c1">#             factor = self.unit_factors[&quot;GB&quot;]</span>
    <span class="c1">#             unit = &quot;GB&quot;</span>
    <span class="c1">#         elif total &gt;= self.unit_factors[&quot;MB&quot;]:</span>
    <span class="c1">#             factor = self.unit_factors[&quot;MB&quot;]</span>
    <span class="c1">#             unit = &quot;MB&quot;</span>
    <span class="c1">#         elif total &gt;= self.unit_factors[&quot;KB&quot;]:</span>
    <span class="c1">#             factor = self.unit_factors[&quot;KB&quot;]</span>
    <span class="c1">#             unit = &quot;KB&quot;</span>
    <span class="c1">#         else:</span>
    <span class="c1">#             factor = self.unit_factors[&quot;B&quot;]</span>
    <span class="c1">#             unit = &quot;B&quot;</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         factor = self.unit_factors[unit]</span>
    <span class="c1">#</span>
    <span class="c1">#     return {</span>
    <span class="c1">#         &quot;total&quot;: round(total / factor, precision),</span>
    <span class="c1">#         &quot;used&quot;: round(used / factor, precision),</span>
    <span class="c1">#         &quot;free&quot;: round(free / factor, precision),</span>
    <span class="c1">#         &quot;percent&quot;: round(used / total * 100, precision) if total &gt; 0 else 0,</span>
    <span class="c1">#         &quot;unit&quot;: unit</span>
    <span class="c1">#     }</span>

<div class="viewcode-block" id="DiskUsage.calculate_disk_usage"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.DiskUsage.calculate_disk_usage">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_disk_usage</span><span class="p">(</span><span class="n">mount_point</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function to calculate disk usage for a given mount point.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">total</span><span class="p">,</span> <span class="n">used</span><span class="p">,</span> <span class="n">free</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">disk_usage</span><span class="p">(</span><span class="n">mount_point</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">total</span> <span class="o">/</span> <span class="n">factor</span><span class="p">,</span> <span class="n">precision</span><span class="p">),</span>
            <span class="s2">&quot;used&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">used</span> <span class="o">/</span> <span class="n">factor</span><span class="p">,</span> <span class="n">precision</span><span class="p">),</span>
            <span class="s2">&quot;free&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">free</span> <span class="o">/</span> <span class="n">factor</span><span class="p">,</span> <span class="n">precision</span><span class="p">),</span>
            <span class="s2">&quot;percent&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">used</span> <span class="o">/</span> <span class="n">total</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span> <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="n">unit</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="DiskUsage.calculate_disk_usage_with_auto_unit"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.DiskUsage.calculate_disk_usage_with_auto_unit">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_disk_usage_with_auto_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mount_point</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate disk usage with automatic unit selection if &#39;auto&#39; is specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">total</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">disk_usage</span><span class="p">(</span><span class="n">mount_point</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">unit_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;PB&quot;</span><span class="p">,</span> <span class="s2">&quot;TB&quot;</span><span class="p">,</span> <span class="s2">&quot;GB&quot;</span><span class="p">,</span> <span class="s2">&quot;MB&quot;</span><span class="p">,</span> <span class="s2">&quot;KB&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_factors</span><span class="p">[</span><span class="n">unit_name</span><span class="p">]:</span>
                    <span class="n">unit</span> <span class="o">=</span> <span class="n">unit_name</span>
                    <span class="k">break</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_disk_usage</span><span class="p">(</span>
            <span class="n">mount_point</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_factors</span><span class="p">[</span><span class="n">unit</span><span class="p">],</span>
            <span class="n">precision</span><span class="p">,</span>
            <span class="n">unit</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="DiskPerformanceTester"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.DiskPerformanceTester">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">DiskPerformanceTester</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to test disk performance by measuring read and write speeds.</span>

<span class="sd">    :param file_path: Path to the file used for testing.</span>
<span class="sd">    :param file_size_mb: Size of the test file in megabytes.</span>
<span class="sd">    :param iterations: Number of iterations for the test.</span>
<span class="sd">    :param block_size_kb: Size of each block in kilobytes.</span>
<span class="sd">    :param num_threads: Number of threads to use for the test.</span>
<span class="sd">    :param io_pattern: I/O pattern, e.g., &quot;sequential&quot; or &quot;random&quot;.</span>
<span class="sd">    :param decimal_places: Number of decimal places for results.</span>
<span class="sd">    :param console: Console object for logging.</span>
<span class="sd">    :param verbose: Flag to enable verbose logging.</span>
<span class="sd">    :param additional_info: Additional info for result file</span>

<span class="sd">    Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            tester = DiskPerformanceTester(&quot;/tmp/testfile&quot;, 100)</span>

<span class="sd">            tester.run_parallel_tests()</span>

<span class="sd">            # or</span>

<span class="sd">            tester.measure_write_speed(&quot;/tmp/testfile&quot;, task_id, progress)</span>
<span class="sd">            tester.measure_read_speed(&quot;/tmp/testfile&quot;, task_id, progress)</span>
<span class="sd">            tester.cleanup_and_exit()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">file_size_mb</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">block_size_kb</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">num_threads</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">io_pattern</span><span class="o">=</span><span class="s2">&quot;sequential&quot;</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">console</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">additional_info</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_file_path</span> <span class="o">=</span> <span class="n">file_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_size_mb</span> <span class="o">=</span> <span class="n">file_size_mb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterations</span> <span class="o">=</span> <span class="n">iterations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block_size_kb</span> <span class="o">=</span> <span class="n">block_size_kb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_threads</span> <span class="o">=</span> <span class="n">num_threads</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">io_pattern</span> <span class="o">=</span> <span class="n">io_pattern</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_size_kb</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">))</span>  <span class="c1"># Random data for write</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_speeds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_speeds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_write_duration</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_read_duration</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">average_write_speed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">average_read_speed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_files</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List to track generated test files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">additional_info</span> <span class="o">=</span> <span class="n">additional_info</span>
        <span class="k">if</span> <span class="n">console</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span> <span class="o">=</span> <span class="n">console</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span> <span class="o">=</span> <span class="n">pawn</span><span class="o">.</span><span class="n">console</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">decimal_places</span> <span class="o">=</span> <span class="n">decimal_places</span>
        <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_and_exit</span><span class="p">)</span>
        <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_and_exit</span><span class="p">)</span>

<div class="viewcode-block" id="DiskPerformanceTester.log_with_progress"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.DiskPerformanceTester.log_with_progress">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">log_with_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">progress</span><span class="p">:</span> <span class="n">Progress</span><span class="p">,</span> <span class="n">task_id</span><span class="p">:</span> <span class="n">TaskID</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper function to log messages with progress&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="n">progress</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task_id</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="DiskPerformanceTester.get_write_flags"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.DiskPerformanceTester.get_write_flags">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_write_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">O_WRONLY</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">O_CREAT</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">O_TRUNC</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">O_SYNC</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s1">&#39;O_RSYNC&#39;</span><span class="p">):</span>
            <span class="n">flags</span> <span class="o">|=</span> <span class="n">os</span><span class="o">.</span><span class="n">O_RSYNC</span>
        <span class="k">return</span> <span class="n">flags</span></div>

<div class="viewcode-block" id="DiskPerformanceTester.measure_write_speed"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.DiskPerformanceTester.measure_write_speed">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">measure_write_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">task_id</span><span class="p">,</span> <span class="n">progress</span><span class="p">):</span>
        <span class="n">total_speed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">total_duration</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">speeds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span><span class="p">):</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_write_flags</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_with_progress</span><span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="n">task_id</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] Opened file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> for writing with fd </span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="s2"> (flags: </span><span class="si">{</span><span class="n">io_flags_to_string</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_size_mb</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_size_kb</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_with_progress</span><span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="n">task_id</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] Closed file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> with fd </span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_with_progress</span><span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="n">task_id</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] OS error writing to file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_with_progress</span><span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="n">task_id</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] Unexpected error writing to file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="n">total_duration</span> <span class="o">+=</span> <span class="n">duration</span>
            <span class="k">if</span> <span class="n">duration</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_size_mb</span> <span class="o">/</span> <span class="n">duration</span>  <span class="c1"># MB/s</span>
                <span class="n">speeds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">decimal_places</span><span class="p">))</span>
                <span class="n">total_speed</span> <span class="o">+=</span> <span class="n">speed</span>
            <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task_id</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">average_speed</span> <span class="o">=</span> <span class="n">total_speed</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterations</span> <span class="c1"># Sum of all speeds in this thread</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Write total speed for </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">average_speed</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB/s&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">speeds</span><span class="p">,</span> <span class="n">total_duration</span></div>

<div class="viewcode-block" id="DiskPerformanceTester.measure_read_speed"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.DiskPerformanceTester.measure_read_speed">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">measure_read_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">task_id</span><span class="p">,</span> <span class="n">progress</span><span class="p">):</span>
        <span class="n">total_speed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">total_duration</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">speeds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prepare_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">task_id</span><span class="p">,</span> <span class="n">progress</span><span class="p">)</span>  <span class="c1"># Ensure the file is ready to be read</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">O_RDONLY</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">O_SYNC</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_with_progress</span><span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="n">task_id</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] Opened file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> for reading with fd </span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="s2"> (flags: </span><span class="si">{</span><span class="n">io_flags_to_string</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_size_kb</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">):</span>
                    <span class="k">pass</span>
                <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_with_progress</span><span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="n">task_id</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] Closed file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> with fd </span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_with_progress</span><span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="n">task_id</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] OS error reading from file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_with_progress</span><span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="n">task_id</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] Unexpected error reading from file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="n">total_duration</span> <span class="o">+=</span> <span class="n">duration</span>
            <span class="k">if</span> <span class="n">duration</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_size_mb</span> <span class="o">/</span> <span class="n">duration</span>  <span class="c1"># MB/s</span>
                <span class="n">speeds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">decimal_places</span><span class="p">))</span>
                <span class="n">total_speed</span> <span class="o">+=</span> <span class="n">speed</span>
            <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task_id</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">average_speed</span> <span class="o">=</span> <span class="n">total_speed</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterations</span> <span class="c1"># Sum of all speeds in this thread</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Read total speed for </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">average_speed</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB/s&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">speeds</span><span class="p">,</span> <span class="n">total_duration</span></div>

<div class="viewcode-block" id="DiskPerformanceTester.prepare_file"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.DiskPerformanceTester.prepare_file">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">prepare_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">task_id</span><span class="p">,</span> <span class="n">progress</span><span class="p">):</span>
        <span class="c1"># Ensure the file is ready to be read</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_WRONLY</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">O_CREAT</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">O_TRUNC</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">O_SYNC</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_with_progress</span><span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="n">task_id</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Preparing file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> for reading with fd </span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="s2"> (O_SYNC)&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_size_mb</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_size_kb</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_with_progress</span><span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="n">task_id</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Prepared and closed file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> with fd </span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_with_progress</span><span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="n">task_id</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;OS error preparing file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_with_progress</span><span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="n">task_id</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unexpected error preparing file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DiskPerformanceTester.cleanup"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.DiskPerformanceTester.cleanup">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleted file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OS error deleting file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error deleting file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DiskPerformanceTester.cleanup_files"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.DiskPerformanceTester.cleanup_files">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">cleanup_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_files</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="DiskPerformanceTester.cleanup_and_exit"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.DiskPerformanceTester.cleanup_and_exit">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">cleanup_and_exit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Signal </span><span class="si">{</span><span class="n">signum</span><span class="si">}</span><span class="s2"> received. Cleaning up and exiting.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_files</span><span class="p">()</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="DiskPerformanceTester.run_test"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.DiskPerformanceTester.run_test">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_name</span><span class="p">,</span> <span class="n">measure_func</span><span class="p">,</span> <span class="n">progress</span><span class="p">):</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">task_name</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_threads</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterations</span><span class="p">)</span>
        <span class="n">speeds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">total_duration</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_threads</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">futures</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_threads</span><span class="p">):</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_file_path</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">task_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">test_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                <span class="n">futures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">measure_func</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="n">progress</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">futures</span><span class="p">:</span>
                <span class="n">speed</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
                <span class="n">speeds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
                <span class="n">total_duration</span> <span class="o">+=</span> <span class="n">duration</span>

        <span class="k">return</span> <span class="n">speeds</span><span class="p">,</span> <span class="n">total_duration</span></div>

<div class="viewcode-block" id="DiskPerformanceTester.run_parallel_tests"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.DiskPerformanceTester.run_parallel_tests">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_parallel_tests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">write_speeds</span><span class="p">,</span> <span class="n">total_write_duration</span> <span class="o">=</span> <span class="p">[],</span> <span class="mi">0</span>
        <span class="n">read_speeds</span><span class="p">,</span> <span class="n">total_read_duration</span> <span class="o">=</span> <span class="p">[],</span> <span class="mi">0</span>

        <span class="k">with</span> <span class="n">Progress</span><span class="p">(</span>
                <span class="n">TextColumn</span><span class="p">(</span><span class="s2">&quot;[progress.description]</span><span class="si">{task.description}</span><span class="s2">&quot;</span><span class="p">),</span>
                <span class="n">BarColumn</span><span class="p">(</span><span class="n">bar_width</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                <span class="s2">&quot;[progress.percentage]</span><span class="si">{task.percentage:&gt;3.0f}</span><span class="s2">%&quot;</span><span class="p">,</span>
                <span class="n">TimeElapsedColumn</span><span class="p">(),</span>
                <span class="n">TimeRemainingColumn</span><span class="p">(),</span>
                <span class="n">console</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="p">)</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>

            <span class="n">write_speeds</span><span class="p">,</span> <span class="n">total_write_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_test</span><span class="p">(</span><span class="s2">&quot;Write Test&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_write_speed</span><span class="p">,</span> <span class="n">progress</span><span class="p">)</span>
            <span class="n">read_speeds</span><span class="p">,</span> <span class="n">total_read_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_test</span><span class="p">(</span><span class="s2">&quot;Read Test&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_read_speed</span><span class="p">,</span> <span class="n">progress</span><span class="p">)</span>

        <span class="c1"># Flatten the list of speeds</span>
        <span class="n">flat_write_speeds</span> <span class="o">=</span> <span class="p">[</span><span class="n">speed</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">write_speeds</span> <span class="k">for</span> <span class="n">speed</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
        <span class="n">flat_read_speeds</span> <span class="o">=</span> <span class="p">[</span><span class="n">speed</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">read_speeds</span> <span class="k">for</span> <span class="n">speed</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>

        <span class="c1"># Calculate overall average speeds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_speeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_speeds</span><span class="p">(</span><span class="n">flat_write_speeds</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_speeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_speeds</span><span class="p">(</span><span class="n">flat_read_speeds</span><span class="p">)</span>

        <span class="n">total_write_size_mb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_size_mb</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterations</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_threads</span>
        <span class="n">total_read_size_mb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_size_mb</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterations</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_threads</span>

        <span class="k">if</span> <span class="n">total_write_duration</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">average_write_speed</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">total_write_size_mb</span> <span class="o">/</span> <span class="n">total_write_duration</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">decimal_places</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">average_write_speed</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">total_read_duration</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">average_read_speed</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">total_read_size_mb</span> <span class="o">/</span> <span class="n">total_read_duration</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">decimal_places</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">average_read_speed</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Cleanup all test files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_files</span><span class="p">()</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_results_dict</span><span class="p">()</span>

        <span class="c1"># Print summary</span>
        <span class="c1"># self.print_summary()</span>

        <span class="c1"># Save results</span>
        <span class="c1"># self.save_results()</span>

        <span class="c1"># Visualize results</span>
        <span class="c1"># self.visualize_results()</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="DiskPerformanceTester.validate_speeds"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.DiskPerformanceTester.validate_speeds">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_speeds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speeds</span><span class="p">):</span>
        <span class="c1"># Validate and filter out unrealistic speed values</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">speeds</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">speeds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># If there is only one speed, return it as it is</span>
            <span class="k">return</span> <span class="n">speeds</span>

        <span class="n">mean</span> <span class="o">=</span> <span class="n">statistics</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">speeds</span><span class="p">)</span>
        <span class="n">stdev</span> <span class="o">=</span> <span class="n">statistics</span><span class="o">.</span><span class="n">stdev</span><span class="p">(</span><span class="n">speeds</span><span class="p">)</span>

        <span class="c1"># Accept speeds within 3 standard deviations of the mean</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">speed</span> <span class="k">for</span> <span class="n">speed</span> <span class="ow">in</span> <span class="n">speeds</span> <span class="k">if</span> <span class="n">mean</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">stdev</span> <span class="o">&lt;=</span> <span class="n">speed</span> <span class="o">&lt;=</span> <span class="n">mean</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">stdev</span><span class="p">]</span></div>

<div class="viewcode-block" id="DiskPerformanceTester.print_summary"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.DiskPerformanceTester.print_summary">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">print_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Write speeds: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">write_speeds</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">threads_write_result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">threads_read_result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_threads</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">threads_write_result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(Threads: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">average_write_speed</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">num_threads</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB/s per thread)&quot;</span>
            <span class="n">threads_read_result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(Threads: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">average_read_speed</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">num_threads</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB/s per thread)&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average write speed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">average_write_speed</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB/s </span><span class="si">{</span><span class="n">threads_write_result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Read speeds: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">read_speeds</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average read speed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">average_read_speed</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB/s </span><span class="si">{</span><span class="n">threads_read_result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CPU load during test: </span><span class="si">{</span><span class="n">dict_to_line</span><span class="p">(</span><span class="n">get_cpu_load</span><span class="p">(),</span><span class="w"> </span><span class="n">end_separator</span><span class="o">=</span><span class="s1">&#39;, &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DiskPerformanceTester.create_results_dict"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.DiskPerformanceTester.create_results_dict">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_results_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;write_speeds&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_speeds</span><span class="p">,</span>
            <span class="s2">&quot;average_write_speed&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">average_write_speed</span><span class="p">,</span>
            <span class="s2">&quot;read_speeds&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_speeds</span><span class="p">,</span>
            <span class="s2">&quot;average_read_speed&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">average_read_speed</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">additional_info</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;additional_info&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">additional_info</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="DiskPerformanceTester.save_results"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.DiskPerformanceTester.save_results">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_results_dict</span><span class="p">()</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;disk_performance_results.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Results saved to disk_performance_results.json&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="FileSystemTester"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.FileSystemTester">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">FileSystemTester</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_dir</span><span class="p">,</span> <span class="n">file_count</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">file_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">console</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span> <span class="o">=</span> <span class="n">test_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_count</span> <span class="o">=</span> <span class="n">file_count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_size</span> <span class="o">=</span> <span class="n">file_size</span>  <span class="c1"># in bytes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterations</span> <span class="o">=</span> <span class="n">iterations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decimal_places</span> <span class="o">=</span> <span class="n">decimal_places</span>

        <span class="k">if</span> <span class="n">console</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span> <span class="o">=</span> <span class="n">console</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span> <span class="o">=</span> <span class="n">pawn</span><span class="o">.</span><span class="n">console</span>

<div class="viewcode-block" id="FileSystemTester.setup"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.FileSystemTester.setup">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">)</span></div>

<div class="viewcode-block" id="FileSystemTester.cleanup"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.FileSystemTester.cleanup">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">)</span></div>

<div class="viewcode-block" id="FileSystemTester.generate_random_string"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.FileSystemTester.generate_random_string">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_random_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">size</span><span class="p">))</span></div>

<div class="viewcode-block" id="FileSystemTester.test_file_creation"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.FileSystemTester.test_file_creation">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_file_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">progress</span><span class="p">,</span> <span class="n">task_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Start File creation test&quot;</span><span class="p">)</span>
        <span class="n">durations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_count</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;file_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_random_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_size</span><span class="p">))</span>
                <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task_id</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="n">durations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
        <span class="n">avg_duration</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File creation test completed in </span><span class="si">{</span><span class="n">avg_duration</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1"> seconds (average over </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span><span class="si">}</span><span class="s1"> iterations)&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">avg_duration</span></div>

<div class="viewcode-block" id="FileSystemTester.test_file_reading"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.FileSystemTester.test_file_reading">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_file_reading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">progress</span><span class="p">,</span> <span class="n">task_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Start File reading test&quot;</span><span class="p">)</span>
        <span class="n">durations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
            <span class="c1"># Create files first</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_count</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;file_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_random_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_size</span><span class="p">))</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_count</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;file_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task_id</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="n">durations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
        <span class="n">avg_duration</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File reading test completed in </span><span class="si">{</span><span class="n">avg_duration</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1"> seconds (average over </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span><span class="si">}</span><span class="s1"> iterations)&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">avg_duration</span></div>

<div class="viewcode-block" id="FileSystemTester.test_file_deletion"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.FileSystemTester.test_file_deletion">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_file_deletion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">progress</span><span class="p">,</span> <span class="n">task_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Start File deletion test&quot;</span><span class="p">)</span>
        <span class="n">durations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
            <span class="c1"># Create files first</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_count</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;file_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_random_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_size</span><span class="p">))</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_count</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;file_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.txt&#39;</span><span class="p">))</span>
                <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task_id</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="n">durations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
        <span class="n">avg_duration</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File deletion test completed in </span><span class="si">{</span><span class="n">avg_duration</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1"> seconds (average over </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span><span class="si">}</span><span class="s1"> iterations)&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">avg_duration</span></div>

<div class="viewcode-block" id="FileSystemTester.test_directory_traversal"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.FileSystemTester.test_directory_traversal">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_directory_traversal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">progress</span><span class="p">,</span> <span class="n">task_id</span><span class="p">):</span>
        <span class="n">durations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
            <span class="c1"># Create files first</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_count</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;file_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_random_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_size</span><span class="p">))</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
                <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task_id</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="n">durations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
        <span class="n">avg_duration</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Directory traversal test completed in </span><span class="si">{</span><span class="n">avg_duration</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1"> seconds (average over </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span><span class="si">}</span><span class="s1"> iterations)&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">avg_duration</span></div>

<div class="viewcode-block" id="FileSystemTester.run_tests"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.FileSystemTester.run_tests">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_tests</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_print</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Starting file system tests with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">file_count</span><span class="si">}</span><span class="s1"> files of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">file_size</span><span class="si">}</span><span class="s1"> bytes each, running </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span><span class="si">}</span><span class="s1"> iterations&#39;</span><span class="p">)</span>

        <span class="n">total_tasks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterations</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_count</span> <span class="o">*</span> <span class="mi">4</span>
        <span class="k">with</span> <span class="n">Progress</span><span class="p">(</span>
                <span class="n">TextColumn</span><span class="p">(</span><span class="s2">&quot;[progress.description]</span><span class="si">{task.description}</span><span class="s2">&quot;</span><span class="p">),</span>
                <span class="n">BarColumn</span><span class="p">(</span><span class="n">bar_width</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                <span class="s2">&quot;[progress.percentage]</span><span class="si">{task.percentage:&gt;3.1f}</span><span class="s2">%&quot;</span><span class="p">,</span>
                <span class="n">TimeElapsedColumn</span><span class="p">(),</span>
                <span class="n">TimeRemainingColumn</span><span class="p">(),</span>
                <span class="n">console</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">console</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>
            <span class="n">creation_task</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="s2">&quot;File Creation&quot;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_count</span><span class="p">)</span>
            <span class="n">reading_task</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="s2">&quot;File Reading&quot;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_count</span><span class="p">)</span>
            <span class="n">deletion_task</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="s2">&quot;File Deletion&quot;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_count</span><span class="p">)</span>
            <span class="n">traversal_task</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="s2">&quot;Directory Traversal&quot;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_count</span><span class="p">)</span>

            <span class="n">file_creation_time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_file_creation</span><span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="n">creation_task</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">decimal_places</span><span class="p">)</span>
            <span class="n">file_reading_time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_file_reading</span><span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="n">reading_task</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">decimal_places</span><span class="p">)</span>
            <span class="n">file_deletion_time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_file_deletion</span><span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="n">deletion_task</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">decimal_places</span><span class="p">)</span>
            <span class="n">directory_traversal_time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_directory_traversal</span><span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="n">traversal_task</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">decimal_places</span><span class="p">)</span>

            <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">creation_task</span><span class="p">,</span> <span class="n">completed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_count</span><span class="p">)</span>
            <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">reading_task</span><span class="p">,</span> <span class="n">completed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_count</span><span class="p">)</span>
            <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">deletion_task</span><span class="p">,</span> <span class="n">completed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_count</span><span class="p">)</span>
            <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">traversal_task</span><span class="p">,</span> <span class="n">completed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_count</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;file_creation_time&quot;</span><span class="p">:</span> <span class="n">file_creation_time</span><span class="p">,</span>
            <span class="s2">&quot;file_reading_time&quot;</span><span class="p">:</span> <span class="n">file_reading_time</span><span class="p">,</span>
            <span class="s2">&quot;directory_traversal_time&quot;</span><span class="p">:</span> <span class="n">directory_traversal_time</span><span class="p">,</span>
            <span class="s2">&quot;file_deletion_time&quot;</span><span class="p">:</span> <span class="n">file_deletion_time</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">is_print</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_results</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="FileSystemTester.print_results"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.FileSystemTester.print_results">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">print_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;File System Test Results&quot;</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">,</span> <span class="n">no_wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Duration (s)&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;magenta&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">table</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="SSHLogPathResolver"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.SSHLogPathResolver">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">SSHLogPathResolver</span><span class="p">:</span>
    <span class="n">log_file_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;ubuntu&#39;</span><span class="p">:</span> <span class="s1">&#39;/var/log/auth.log&#39;</span><span class="p">,</span>
        <span class="s1">&#39;centos&#39;</span><span class="p">:</span> <span class="s1">&#39;/var/log/secure&#39;</span><span class="p">,</span>
        <span class="s1">&#39;rocky&#39;</span><span class="p">:</span> <span class="s1">&#39;/var/log/secure&#39;</span><span class="p">,</span>
        <span class="s1">&#39;macos&#39;</span><span class="p">:</span> <span class="s1">&#39;/var/log/system.log&#39;</span><span class="p">,</span>
        <span class="s1">&#39;debian&#39;</span><span class="p">:</span> <span class="s1">&#39;/var/log/auth.log&#39;</span><span class="p">,</span>
        <span class="s1">&#39;fedora&#39;</span><span class="p">:</span> <span class="s1">&#39;/var/log/secure&#39;</span><span class="p">,</span>
        <span class="s1">&#39;amzn&#39;</span><span class="p">:</span> <span class="s1">&#39;/var/log/secure&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">os_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">raise_on_failure</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">os_name</span> <span class="o">=</span> <span class="n">os_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">os_info</span> <span class="o">=</span> <span class="n">get_platform_info</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">os_name</span> <span class="o">=</span> <span class="n">os_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;os&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">raise_on_failure</span> <span class="o">=</span> <span class="n">raise_on_failure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span>

<div class="viewcode-block" id="SSHLogPathResolver.get_path"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.SSHLogPathResolver.get_path">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">log_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_file_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">os_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">log_path</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">log_path</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">raise_on_failure</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported OS: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">os_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;/var/log/secure&#39;</span></div>
<div class="viewcode-block" id="SSHLogPathResolver.extract_directory"><a class="viewcode-back" href="../../../module/pawnlib.resource.html#pawnlib.resource.server.SSHLogPathResolver.extract_directory">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">extract_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_file_path</span><span class="p">))</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, jinwoo.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>