

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pawnlib.utils.notify &mdash; Pawnlib v2.1.36</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />

  
      <script src="../../../_static/jquery.js"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
      <script src="../../../_static/doctools.js"></script>
      <script src="../../../_static/sphinx_highlight.js"></script>
      <script src="../../../_static/clipboard.min.js"></script>
      <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            pawnlib
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Welcome to pawnlib’s documentation!</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Packages</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.asyncio.html">pawnlib.asyncio package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.builder.html">pawnlib.builder package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.cli.html">pawnlib.cli package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.config.html">pawnlib.config package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.docker.html">pawnlib.docker package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.exceptions.html">pawnlib.exceptions package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.input.html">pawnlib.input package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.metrics.html">pawnlib.metrics package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.output.html">pawnlib.output package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.resource.html">pawnlib.resource package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.typing.html">pawnlib.typing package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.utils.html">pawnlib.utils package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">pawnlib</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pawnlib.utils.notify</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pawnlib.utils.notify</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pawnlib.config.globalconfig</span><span class="w"> </span><span class="kn">import</span> <span class="n">pawnlib_config</span> <span class="k">as</span> <span class="n">pawn</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pawnlib.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup_logger</span><span class="p">,</span> <span class="n">get_logger</span><span class="p">,</span> <span class="n">LoggerMixinVerbose</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pawnlib.output</span><span class="w"> </span><span class="kn">import</span> <span class="n">color_print</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pawnlib.resource</span><span class="w"> </span><span class="kn">import</span> <span class="n">net</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pawnlib.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">date_utils</span><span class="p">,</span> <span class="n">shorten_text</span><span class="p">,</span> <span class="n">escape_markdown</span><span class="p">,</span> <span class="n">escape_non_markdown</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pawnlib.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">http</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pawnlib.utils.network</span><span class="w"> </span><span class="kn">import</span> <span class="n">disable_requests_ssl_warnings</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">aiohttp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pawnlib.typing.constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">StatusType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Awaitable</span><span class="p">,</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rich.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>


<span class="n">SlackReturnType</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;SlackReturnType&#39;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">Awaitable</span><span class="p">[</span><span class="nb">bool</span><span class="p">])</span>
<span class="n">SlackResponseType</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;SlackResponseType&#39;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span>

<div class="viewcode-block" id="TelegramBot"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.TelegramBot">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">TelegramBot</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to interact with the Telegram Bot API.</span>

<span class="sd">    :param bot_token: Telegram bot token. If not provided, it will be fetched from the &#39;TELEGRAM_BOT_TOKEN&#39; environment variable.</span>
<span class="sd">    :param chat_id: Chat ID to send messages to. If not provided, it will be fetched from the &#39;TELEGRAM_CHAT_ID&#39; environment variable or determined dynamically.</span>
<span class="sd">    :param verify_ssl: Whether to verify the SSL certificate for HTTPS requests. (default: True).</span>
<span class="sd">    :param ignore_ssl_warning: Whether to ignore SSL warnings. If True, SSL warnings will be suppressed.</span>
<span class="sd">    :param async_mode: Whether to use asynchronous mode. If False, synchronous mode will be used. (default: True)</span>
<span class="sd">    :param max_retries: Maximum number of retries for 429 Too Many Requests errors. (default: 5)</span>
<span class="sd">    :param retry_delay: Delay in seconds between retries for 429 Too Many Requests errors. (default: 5)</span>

<span class="sd">    :raises ValueError: If the bot token is not provided either as an argument or an environment variable.</span>

<span class="sd">    Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            bot = TelegramBot(bot_token=&quot;your_bot_token&quot;, chat_id=&quot;your_chat_id&quot;, async_mode=False)</span>
<span class="sd">            bot.send_message(&quot;Hello, world!&quot;)</span>
<span class="sd">            bot.send_html_message(&quot;&lt;b&gt;Hello, world!&lt;/b&gt;&quot;)</span>
<span class="sd">            bot.send_plain_text_message(&quot;Just plain text.&quot;)</span>
<span class="sd">            bot.send_dict_message({&quot;key&quot;: &quot;value&quot;})</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot_token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">chat_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verify_ssl</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ignore_ssl_warning</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">async_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">retry_delay</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bot_token</span> <span class="o">=</span> <span class="p">(</span><span class="n">bot_token</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;TELEGRAM_BOT_TOKEN&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot_token</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Telegram bot token is required. Please set it as an argument or in the &#39;TELEGRAM_BOT_TOKEN&#39; environment variable.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chat_id</span> <span class="o">=</span> <span class="n">chat_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api.telegram.org/bot</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bot_token</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chat_id</span> <span class="o">=</span> <span class="p">(</span><span class="n">chat_id</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;TELEGRAM_CHAT_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span> <span class="o">=</span> <span class="n">verify_ssl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">async_mode</span> <span class="o">=</span> <span class="n">async_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span> <span class="o">=</span> <span class="n">max_retries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retry_delay</span> <span class="o">=</span> <span class="n">retry_delay</span>

        <span class="k">if</span> <span class="n">ignore_ssl_warning</span><span class="p">:</span>
            <span class="n">disable_requests_ssl_warnings</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">chat_id</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chat_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_chat_id</span><span class="p">()</span>

        <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;bot_token=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bot_token</span><span class="si">}</span><span class="s2">, chat_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">chat_id</span><span class="si">}</span><span class="s2">, async_mode=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">async_mode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="TelegramBot.escape_markdown"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.TelegramBot.escape_markdown">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">escape_markdown</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Escape Markdown special characters for MarkdownV2.</span>

<span class="sd">        :param text: The text to escape.</span>
<span class="sd">        :return: The escaped text.</span>

<span class="sd">        Example:</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                bot = TelegramBot(bot_token=&quot;your_bot_token&quot;, chat_id=&quot;your_chat_id&quot;)</span>
<span class="sd">                escaped_text = bot.escape_markdown(&quot;Hello *world*!&quot;)</span>
<span class="sd">                print(escaped_text)  # Output: Hello \*world\*!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># escape_chars = r&#39;_*[]()~`&gt;#+-=|{}.!&#39;</span>
        <span class="n">escape_chars</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;_*`.()-&#39;</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;([</span><span class="si">{</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">escape_chars</span><span class="p">)</span><span class="si">}</span><span class="s1">])&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">\1&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">))</span></div>

<div class="viewcode-block" id="TelegramBot.send_multiple_messages_async"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.TelegramBot.send_multiple_messages_async">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_multiple_messages_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">messages</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send multiple messages asynchronously.</span>

<span class="sd">        :param messages: A list of messages to send.</span>
<span class="sd">        :return: A list of responses from the Telegram API.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">send_auto_message_async</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">]</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span></div>

<div class="viewcode-block" id="TelegramBot.send_multiple_messages"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.TelegramBot.send_multiple_messages">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_multiple_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">messages</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send multiple messages synchronously.</span>

<span class="sd">        :param messages: A list of messages to send.</span>
<span class="sd">        :return: A list of responses from the Telegram API.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">async_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">send_multiple_messages_async</span><span class="p">(</span><span class="n">messages</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">send_message_sync</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">]</span></div>

<div class="viewcode-block" id="TelegramBot.send_message"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.TelegramBot.send_message">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">parse_mode</span><span class="o">=</span><span class="s2">&quot;Markdown&quot;</span><span class="p">,</span> <span class="n">disable_web_page_preview</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">async_mode</span><span class="p">:</span>
            <span class="c1"># return asyncio.run(self.send_message_async(message, parse_mode, disable_web_page_preview))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_message_async</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">parse_mode</span><span class="p">,</span> <span class="n">disable_web_page_preview</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_message_sync</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">parse_mode</span><span class="p">,</span> <span class="n">disable_web_page_preview</span><span class="p">)</span></div>


<div class="viewcode-block" id="TelegramBot.build_payload"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.TelegramBot.build_payload">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">build_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">parse_mode</span><span class="o">=</span><span class="s2">&quot;Markdown&quot;</span><span class="p">,</span> <span class="n">disable_web_page_preview</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pass_escape</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build the payload for sending a message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape_markdown</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="k">if</span> <span class="n">parse_mode</span> <span class="o">==</span> <span class="s2">&quot;MarkdownV2&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pass_escape</span> <span class="k">else</span> <span class="n">message</span>
        <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_message -&gt; </span><span class="si">{</span><span class="n">_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;chat_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">chat_id</span><span class="p">,</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">_message</span><span class="p">,</span>
            <span class="s2">&quot;parse_mode&quot;</span><span class="p">:</span> <span class="n">parse_mode</span><span class="p">,</span>
            <span class="s2">&quot;disable_web_page_preview&quot;</span><span class="p">:</span> <span class="n">disable_web_page_preview</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">payload</span></div>

<div class="viewcode-block" id="TelegramBot.send_message_sync"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.TelegramBot.send_message_sync">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_message_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">parse_mode</span><span class="o">=</span><span class="s2">&quot;Markdown&quot;</span><span class="p">,</span> <span class="n">disable_web_page_preview</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pass_escape</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_payload</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">parse_mode</span><span class="p">,</span> <span class="n">disable_web_page_preview</span><span class="p">,</span> <span class="n">pass_escape</span><span class="p">)</span>

        <span class="n">retries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">retries</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">api_url</span><span class="si">}</span><span class="s2">/sendMessage&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>  <span class="c1"># 성공적으로 메시지를 보낸 경우</span>
                <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>
                    <span class="n">retries</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;429 Too Many Requests error. Retrying in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">retry_delay</span><span class="si">}</span><span class="s2"> seconds...&quot;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">retry_delay</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to send message: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
            <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error sending message: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">retries</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">retry_delay</span><span class="p">)</span>

        <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Maximum number of retries reached. Failed to send message.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="TelegramBot.send_message_async"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.TelegramBot.send_message_async">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_message_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">parse_mode</span><span class="o">=</span><span class="s2">&quot;MarkdownV2&quot;</span><span class="p">,</span> <span class="n">disable_web_page_preview</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pass_escape</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_payload</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">parse_mode</span><span class="p">,</span> <span class="n">disable_web_page_preview</span><span class="p">,</span> <span class="n">pass_escape</span><span class="p">)</span>

        <span class="n">retries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">retries</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
                    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">api_url</span><span class="si">}</span><span class="s2">/sendMessage&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">ssl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                            <span class="k">return</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>  <span class="c1"># 성공적으로 메시지를 보낸 경우</span>
                        <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>
                            <span class="n">retries</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;429 Too Many Requests error. Retrying in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">retry_delay</span><span class="si">}</span><span class="s2"> seconds...&quot;</span><span class="p">)</span>
                            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">retry_delay</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to send message: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="k">await</span><span class="w"> </span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">return</span> <span class="kc">None</span>
            <span class="k">except</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error sending message: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">retries</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">retry_delay</span><span class="p">)</span>

        <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Maximum number of retries reached. Failed to send message.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="TelegramBot.send_html_message"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.TelegramBot.send_html_message">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_html_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">parse_mode</span><span class="o">=</span><span class="s2">&quot;HTML&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TelegramBot.send_html_message_async"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.TelegramBot.send_html_message_async">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_html_message_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_message_async</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">parse_mode</span><span class="o">=</span><span class="s2">&quot;HTML&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TelegramBot.send_plain_text_message"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.TelegramBot.send_plain_text_message">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_plain_text_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">parse_mode</span><span class="o">=</span><span class="s2">&quot;Markdown&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">parse_mode</span><span class="o">=</span><span class="n">parse_mode</span><span class="p">)</span></div>

<div class="viewcode-block" id="TelegramBot.send_plain_text_message_async"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.TelegramBot.send_plain_text_message_async">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_plain_text_message_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">parse_mode</span><span class="o">=</span><span class="s2">&quot;Markdown&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_message_async</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">parse_mode</span><span class="o">=</span><span class="n">parse_mode</span><span class="p">)</span></div>

<div class="viewcode-block" id="TelegramBot.send_dict_message"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.TelegramBot.send_dict_message">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_dict_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_dict</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">message_dict</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_plain_text_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="TelegramBot.send_dict_message_async"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.TelegramBot.send_dict_message_async">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_dict_message_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_dict</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">message_dict</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_plain_text_message_async</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="TelegramBot.get_chat_id"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.TelegramBot.get_chat_id">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_chat_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve chat_id by getting updates from the Telegram bot API&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">api_url</span><span class="si">}</span><span class="s2">/getUpdates&quot;</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;result&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">chat_id</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;message&quot;</span><span class="p">][</span><span class="s2">&quot;chat&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retrieved chat_id: </span><span class="si">{</span><span class="n">chat_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">chat_id</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No messages found in bot updates to retrieve chat_id.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to retrieve updates: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TelegramBot.display_all_chat_updates"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.TelegramBot.display_all_chat_updates">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_all_chat_updates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve all unique chat_ids and their details by getting updates from the Telegram bot API&quot;&quot;&quot;</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">api_url</span><span class="si">}</span><span class="s2">/getUpdates&quot;</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to retrieve updates: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Telegram Updates&quot;</span><span class="p">)</span>

        <span class="c1"># 테이블 열 추가</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Update ID&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Chat ID&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;magenta&quot;</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Chat Title&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;magenta&quot;</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;magenta&quot;</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;From&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Message&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;result&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="c1"># 날짜 기준으로 정렬</span>
            <span class="n">updates</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">update</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]:</span>
                <span class="n">timestamp</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="s2">&quot;message&quot;</span> <span class="ow">in</span> <span class="n">update</span><span class="p">:</span>
                    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">update</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">][</span><span class="s2">&quot;date&quot;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="s2">&quot;my_chat_member&quot;</span> <span class="ow">in</span> <span class="n">update</span><span class="p">:</span>
                    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">update</span><span class="p">[</span><span class="s2">&quot;my_chat_member&quot;</span><span class="p">][</span><span class="s2">&quot;date&quot;</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">updates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">update</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">))</span>

            <span class="c1"># 날짜 기준으로 정렬 (내림차순)</span>
            <span class="n">updates</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">update</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">updates</span><span class="p">:</span>
                <span class="n">chat_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_chat_info</span><span class="p">(</span><span class="n">update</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">chat_info</span><span class="p">:</span>
                    <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="o">*</span><span class="n">chat_info</span><span class="p">)</span>

        <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>  <span class="c1"># 테이블 출력</span></div>
        <span class="c1"># pawn.console.print(data)</span>


<div class="viewcode-block" id="TelegramBot.extract_chat_info"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.TelegramBot.extract_chat_info">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">extract_chat_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract chat information from the update.&quot;&quot;&quot;</span>

        <span class="n">chat_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">chat_title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">chat_type</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">from_user</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">message_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;message&quot;</span> <span class="ow">in</span> <span class="n">update</span> <span class="ow">and</span> <span class="s2">&quot;chat&quot;</span> <span class="ow">in</span> <span class="n">update</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]:</span>
            <span class="n">chat_id</span> <span class="o">=</span> <span class="n">update</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">][</span><span class="s2">&quot;chat&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
            <span class="n">chat_title</span> <span class="o">=</span> <span class="n">update</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">][</span><span class="s2">&quot;chat&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;N/A&quot;</span><span class="p">)</span>
            <span class="n">chat_type</span> <span class="o">=</span> <span class="n">update</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">][</span><span class="s2">&quot;chat&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;N/A&quot;</span><span class="p">)</span>
            <span class="n">from_user</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">update</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">][</span><span class="s1">&#39;from&#39;</span><span class="p">][</span><span class="s1">&#39;first_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">update</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">][</span><span class="s1">&#39;from&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;last_name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">message_text</span> <span class="o">=</span> <span class="n">update</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">update</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="s2">&quot;my_chat_member&quot;</span> <span class="ow">in</span> <span class="n">update</span><span class="p">:</span>
            <span class="n">chat_id</span> <span class="o">=</span> <span class="n">update</span><span class="p">[</span><span class="s1">&#39;my_chat_member&#39;</span><span class="p">][</span><span class="s1">&#39;chat&#39;</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="n">chat_title</span> <span class="o">=</span> <span class="n">update</span><span class="p">[</span><span class="s2">&quot;my_chat_member&quot;</span><span class="p">][</span><span class="s2">&quot;chat&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;N/A&quot;</span><span class="p">)</span>
            <span class="n">chat_type</span> <span class="o">=</span> <span class="n">update</span><span class="p">[</span><span class="s2">&quot;my_chat_member&quot;</span><span class="p">][</span><span class="s2">&quot;chat&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;N/A&quot;</span><span class="p">)</span>
            <span class="n">from_user</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">update</span><span class="p">[</span><span class="s1">&#39;my_chat_member&#39;</span><span class="p">][</span><span class="s1">&#39;from&#39;</span><span class="p">][</span><span class="s1">&#39;first_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">update</span><span class="p">[</span><span class="s1">&#39;my_chat_member&#39;</span><span class="p">][</span><span class="s1">&#39;from&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;last_name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">update</span><span class="p">[</span><span class="s1">&#39;my_chat_member&#39;</span><span class="p">][</span><span class="s1">&#39;new_chat_member&#39;</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">update</span><span class="p">[</span><span class="s1">&#39;my_chat_member&#39;</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;group_chat_created&quot;</span> <span class="ow">in</span> <span class="n">update</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="p">{}):</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Group Chat Created&quot;</span>

        <span class="k">if</span> <span class="n">chat_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">update</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;update_id&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)),</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">chat_id</span><span class="p">),</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">chat_title</span><span class="p">),</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">chat_type</span><span class="p">),</span>
                <span class="n">from_user</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                <span class="n">message_text</span><span class="p">,</span>
                <span class="n">timestamp</span><span class="p">,</span>
                <span class="n">status</span> <span class="k">if</span> <span class="n">status</span> <span class="k">else</span> <span class="s2">&quot;N/A&quot;</span>
            <span class="p">]</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="TelegramBot.save_chat_id"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.TelegramBot.save_chat_id">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_chat_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chat_id_file</span><span class="o">=</span><span class="s2">&quot;chat_id.txt&quot;</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">chat_id_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chat_id</span><span class="p">))</span>
        <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;chat_id saved to </span><span class="si">{</span><span class="n">chat_id_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TelegramBot.load_chat_id"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.TelegramBot.load_chat_id">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_chat_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chat_id_file</span><span class="o">=</span><span class="s2">&quot;chat_id.txt&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">chat_id_file</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">chat_id_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chat_id</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded chat_id from </span><span class="si">{</span><span class="n">chat_id_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;chat_id file </span><span class="si">{</span><span class="n">chat_id_file</span><span class="si">}</span><span class="s2"> not found. Retrieving chat_id using getUpdates...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chat_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_chat_id</span><span class="p">()</span></div>

<div class="viewcode-block" id="TelegramBot.send_auto_message"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.TelegramBot.send_auto_message">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_auto_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_dict_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_html</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_html_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_markdown</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">parse_mode</span><span class="o">=</span><span class="s2">&quot;Markdown&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_plain_text_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported message type&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TelegramBot.send_auto_message_async"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.TelegramBot.send_auto_message_async">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_auto_message_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_dict_message_async</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_html</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_html_message_async</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_markdown</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_message_async</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">parse_mode</span><span class="o">=</span><span class="s2">&quot;Markdown&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_plain_text_message_async</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported message type&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TelegramBot.is_html"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.TelegramBot.is_html">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&lt;[^&gt;]+&gt;&#39;</span><span class="p">,</span> <span class="n">message</span><span class="p">))</span></div>

<div class="viewcode-block" id="TelegramBot.is_markdown"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.TelegramBot.is_markdown">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_markdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the string contains MarkdownV2 special characters&quot;&quot;&quot;</span>
        <span class="c1"># MarkdownV2에서 사용하는 특수 문자를 검사</span>
        <span class="n">markdown_special_chars</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;[_*[\]()~`&gt;#+-=|</span><span class="si">{}</span><span class="s1">.!]&#39;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[</span><span class="si">{</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">markdown_special_chars</span><span class="p">)</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">,</span> <span class="n">message</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="SlackNotifier"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.SlackNotifier">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">SlackNotifier</span><span class="p">(</span><span class="n">LoggerMixinVerbose</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for sending Slack messages. Provides both synchronous and asynchronous methods.</span>

<span class="sd">    :param webhook_url: Slack webhook URL. If not provided, it will be fetched from the environment variable &#39;SLACK_WEBHOOK_URL&#39;.</span>
<span class="sd">    :param username: Username to display in Slack.</span>
<span class="sd">    :param icon_emoji: Emoji to use as the icon for the message.</span>
<span class="sd">    :param retries: Number of retry attempts in case of failure.</span>
<span class="sd">    :param retry_delay: Time to wait between retries (in seconds).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">webhook_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;PawnBot&quot;</span><span class="p">,</span>
        <span class="n">icon_emoji</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;:robot_face:&quot;</span><span class="p">,</span>
        <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">retry_delay</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">webhook_url</span> <span class="o">=</span> <span class="n">webhook_url</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;SLACK_WEBHOOK_URL&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">icon_emoji</span> <span class="o">=</span> <span class="n">icon_emoji</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retries</span> <span class="o">=</span> <span class="n">retries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retry_delay</span> <span class="o">=</span> <span class="n">retry_delay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_logger</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">webhook_url</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Slack webhook URL is not set. Please set the &#39;webhook_url&#39; parameter or the &#39;SLACK_WEBHOOK_URL&#39; environment variable.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_level_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return color code according to the message level.&quot;&quot;&quot;</span>
        <span class="n">color_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="s2">&quot;5be312&quot;</span><span class="p">,</span>
            <span class="s2">&quot;warn&quot;</span><span class="p">:</span> <span class="s2">&quot;f2c744&quot;</span><span class="p">,</span>
            <span class="s2">&quot;warning&quot;</span><span class="p">:</span> <span class="s2">&quot;f2c744&quot;</span><span class="p">,</span>
            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;ff0000&quot;</span><span class="p">,</span>
            <span class="s2">&quot;trace&quot;</span><span class="p">:</span> <span class="s2">&quot;1e90ff&quot;</span><span class="p">,</span>
            <span class="s2">&quot;critical&quot;</span><span class="p">:</span> <span class="s2">&quot;ff00ff&quot;</span><span class="p">,</span>
            <span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="s2">&quot;a9a9a9&quot;</span><span class="p">,</span>
            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="s2">&quot;5be312&quot;</span><span class="p">,</span>
            <span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="s2">&quot;ff0000&quot;</span><span class="p">,</span>
            <span class="s2">&quot;in_progress&quot;</span><span class="p">:</span> <span class="s2">&quot;f2c744&quot;</span><span class="p">,</span>
            <span class="s2">&quot;complete&quot;</span><span class="p">:</span> <span class="s2">&quot;5be312&quot;</span><span class="p">,</span>
            <span class="s2">&quot;paused&quot;</span><span class="p">:</span> <span class="s2">&quot;f2c744&quot;</span><span class="p">,</span>
            <span class="s2">&quot;running&quot;</span><span class="p">:</span> <span class="s2">&quot;f2c744&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">level</span> <span class="o">=</span> <span class="n">level</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">level</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="n">color_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="s2">&quot;5be312&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_status_emoji</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StatusType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return emoji according to the status.&quot;&quot;&quot;</span>
        <span class="n">status_emojis</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="s1">&#39;✅&#39;</span><span class="p">,</span>  <span class="c1"># 성공</span>
            <span class="s1">&#39;failed&#39;</span><span class="p">:</span> <span class="s1">&#39;🚨&#39;</span><span class="p">,</span>  <span class="c1"># 실패</span>
            <span class="s1">&#39;warning&#39;</span><span class="p">:</span> <span class="s1">&#39;⚠️&#39;</span><span class="p">,</span>  <span class="c1"># 경고</span>
            <span class="s1">&#39;info&#39;</span><span class="p">:</span> <span class="s1">&#39;ℹ️&#39;</span><span class="p">,</span>  <span class="c1"># 정보</span>
            <span class="s1">&#39;critical&#39;</span><span class="p">:</span> <span class="s1">&#39;❗&#39;</span><span class="p">,</span>  <span class="c1"># 중대한 문제</span>
            <span class="s1">&#39;in_progress&#39;</span><span class="p">:</span> <span class="s1">&#39;⏳&#39;</span><span class="p">,</span>  <span class="c1"># 진행 중</span>
            <span class="s1">&#39;complete&#39;</span><span class="p">:</span> <span class="s1">&#39;🏁&#39;</span><span class="p">,</span>  <span class="c1"># 완료</span>
            <span class="s1">&#39;paused&#39;</span><span class="p">:</span> <span class="s1">&#39;⏸️&#39;</span><span class="p">,</span>  <span class="c1"># 일시 중지</span>
            <span class="s1">&#39;running&#39;</span><span class="p">:</span> <span class="s1">&#39;🏃&#39;</span><span class="p">,</span>  <span class="c1"># 실행</span>
            <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;🔴&#39;</span><span class="p">,</span>  <span class="c1"># 에러</span>
            <span class="s1">&#39;retrying&#39;</span><span class="p">:</span> <span class="s1">&#39;🔄&#39;</span><span class="p">,</span>  <span class="c1"># 재시도 중</span>
            <span class="s1">&#39;changed&#39;</span><span class="p">:</span> <span class="s1">&#39;♻️&#39;</span><span class="p">,</span>  <span class="c1"># 변경</span>
            <span class="s1">&#39;stopped&#39;</span><span class="p">:</span> <span class="s1">&#39;🛑&#39;</span><span class="p">,</span>  <span class="c1"># 중단</span>
            <span class="s1">&#39;queued&#39;</span><span class="p">:</span> <span class="s1">&#39;⌛&#39;</span><span class="p">,</span>  <span class="c1"># 대기 중</span>
            <span class="s1">&#39;canceled&#39;</span><span class="p">:</span> <span class="s1">&#39;❌&#39;</span><span class="p">,</span>  <span class="c1"># 작업 취소</span>
            <span class="s1">&#39;approved&#39;</span><span class="p">:</span> <span class="s1">&#39;👍&#39;</span><span class="p">,</span>  <span class="c1"># 승인</span>
            <span class="s1">&#39;rejected&#39;</span><span class="p">:</span> <span class="s1">&#39;👎&#39;</span><span class="p">,</span>  <span class="c1"># 거절</span>
            <span class="s1">&#39;scheduled&#39;</span><span class="p">:</span> <span class="s1">&#39;🗓️&#39;</span><span class="p">,</span>  <span class="c1"># 스케줄된 작업</span>
            <span class="s1">&#39;maintenance&#39;</span><span class="p">:</span> <span class="s1">&#39;🛠️&#39;</span><span class="p">,</span>  <span class="c1"># 유지보수</span>
            <span class="s1">&#39;update&#39;</span><span class="p">:</span> <span class="s1">&#39;⬆️&#39;</span><span class="p">,</span>  <span class="c1"># 업데이트</span>
            <span class="s1">&#39;unknown&#39;</span><span class="p">:</span> <span class="s1">&#39;❓&#39;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">status_emojis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">status</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="SlackNotifier.create_message_payload"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.SlackNotifier.create_message_payload">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_message_payload</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">],</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">msg_level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;info&quot;</span><span class="p">,</span>
        <span class="n">status</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StatusType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">simple_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">footer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">timestamp_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_text_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create message payload.&quot;&quot;&quot;</span>

        <span class="n">emoji</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_status_emoji</span><span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="k">if</span> <span class="n">status</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_level_color</span><span class="p">(</span><span class="n">msg_level</span><span class="p">)</span>
        <span class="n">title_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">emoji</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">emoji</span> <span class="ow">and</span> <span class="n">title</span> <span class="k">else</span> <span class="n">title</span>

        <span class="c1"># Date/time formatting</span>
        <span class="n">current_timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="n">formatted_time</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">timestamp_format</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
            <span class="n">formatted_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">timestamp_format</span><span class="p">)</span>

        <span class="c1"># Set default payload</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
            <span class="s2">&quot;icon_emoji&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">icon_emoji</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Simple mode</span>
        <span class="k">if</span> <span class="n">simple_mode</span><span class="p">:</span>
            <span class="n">msg_content</span> <span class="o">=</span> <span class="n">message</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg_content</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_text_length</span><span class="p">:</span>
                <span class="n">msg_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg_content</span><span class="p">[:</span><span class="n">max_text_length</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span>

            <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title_text</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">msg_content</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">return</span> <span class="n">payload</span>

        <span class="c1"># Normal mode</span>
        <span class="n">attachments</span> <span class="o">=</span> <span class="p">[{</span>
            <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">title_text</span><span class="p">,</span>
            <span class="s2">&quot;ts&quot;</span><span class="p">:</span> <span class="n">current_timestamp</span><span class="p">,</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">text</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="p">}]</span>

        <span class="c1"># Process message content</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">message</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;N/A&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;short&quot;</span><span class="p">:</span> <span class="kc">True</span>
                <span class="p">})</span>
            <span class="n">attachments</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="c1"># if text:</span>
            <span class="c1">#     attachments[0][&quot;fallback&quot;] = text</span>
            <span class="c1"># else:</span>
            <span class="n">text_content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">message</span><span class="p">])</span>
            <span class="n">attachments</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text_content</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">attachments</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="c1"># Add timestamp format</span>
        <span class="k">if</span> <span class="n">formatted_time</span><span class="p">:</span>
            <span class="n">attachments</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;footer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">footer</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">formatted_time</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">footer</span> <span class="k">else</span> <span class="n">formatted_time</span>
        <span class="k">elif</span> <span class="n">footer</span><span class="p">:</span>
            <span class="n">attachments</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;footer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">footer</span><span class="si">}</span><span class="s2"> | sent from </span><span class="si">{</span><span class="n">net</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;attachments&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">attachments</span>
        <span class="k">return</span> <span class="n">payload</span></div>

<div class="viewcode-block" id="SlackNotifier.send"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.SlackNotifier.send">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">send</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">],</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">msg_level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;info&quot;</span><span class="p">,</span>
        <span class="n">status</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StatusType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">simple_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">footer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">timestamp_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Synchronously send a Slack message.</span>

<span class="sd">        :param message: The message to send (string, dictionary, list)</span>
<span class="sd">        :param title: Message title</span>
<span class="sd">        :param msg_level: Message severity level (info, warn, error, critical, etc.)</span>
<span class="sd">        :param status: Status type or string for dynamic emoji and message formatting.</span>
<span class="sd">        :param simple_mode: If True, send a simplified message without additional info.</span>
<span class="sd">        :param footer: Footer text to display at the bottom of the message.</span>
<span class="sd">        :param timestamp_format: Time display format (e.g. &quot;%Y-%m-%d %H:%M:%S&quot;)</span>
<span class="sd">        :return: Boolean indicating success or failure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">webhook_url</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;SlackNotifier: Webhook URL is not set.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_message_payload</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">msg_level</span><span class="o">=</span><span class="n">msg_level</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
            <span class="n">simple_mode</span><span class="o">=</span><span class="n">simple_mode</span><span class="p">,</span>
            <span class="n">footer</span><span class="o">=</span><span class="n">footer</span><span class="p">,</span>
            <span class="n">timestamp_format</span><span class="o">=</span><span class="n">timestamp_format</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Retry logic</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">retries</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">webhook_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span> <span class="ow">and</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;ok&quot;</span><span class="p">:</span>
                    <span class="n">pawn</span><span class="o">.</span><span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;SlackNotifier: Message sent successfully&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SlackNotifier: Response error. Status code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">, response: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SlackNotifier: Exception occurred: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># If not the last attempt, wait and retry</span>
            <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">retries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SlackNotifier: Retrying... (</span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">retries</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">retry_delay</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="SlackNotifier.send_async"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.SlackNotifier.send_async">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_async</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">],</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">msg_level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;info&quot;</span><span class="p">,</span>
        <span class="n">status</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StatusType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">simple_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">footer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">timestamp_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Asynchronously send a Slack message.</span>

<span class="sd">        :param message: The message to send (string, dictionary, list)</span>
<span class="sd">        :param title: Message title</span>
<span class="sd">        :param msg_level: Message severity level (info, warn, error, critical, etc.)</span>
<span class="sd">        :param status: Status type or string for dynamic emoji and message formatting.</span>
<span class="sd">        :param simple_mode: If True, send a simplified message without additional info.</span>
<span class="sd">        :param footer: Footer text to display at the bottom of the message.</span>
<span class="sd">        :param timestamp_format: Time display format (e.g. &quot;%Y-%m-%d %H:%:M:%S&quot;)</span>
<span class="sd">        :return: Boolean indicating success or failure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">webhook_url</span><span class="p">:</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;SlackNotifier: Webhook URL is not set.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_message_payload</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">msg_level</span><span class="o">=</span><span class="n">msg_level</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
            <span class="n">simple_mode</span><span class="o">=</span><span class="n">simple_mode</span><span class="p">,</span>
            <span class="n">footer</span><span class="o">=</span><span class="n">footer</span><span class="p">,</span>
            <span class="n">timestamp_format</span><span class="o">=</span><span class="n">timestamp_format</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Asynchronous retry logic</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">retries</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
                    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">webhook_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientTimeout</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                            <span class="n">response_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                            <span class="k">if</span> <span class="n">response_text</span> <span class="o">==</span> <span class="s2">&quot;ok&quot;</span><span class="p">:</span>
                                <span class="n">pawn</span><span class="o">.</span><span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;SlackNotifier: Asynchronous message sent successfully&quot;</span><span class="p">)</span>
                                <span class="k">return</span> <span class="kc">True</span>
                        <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SlackNotifier: Response error. Status code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">, response: </span><span class="si">{</span><span class="k">await</span><span class="w"> </span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SlackNotifier: Exception occurred during asynchronous send: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># If not the last attempt, wait and retry</span>
            <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">retries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">pawn</span><span class="o">.</span><span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SlackNotifier: Retrying... (</span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">retries</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">retry_delay</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="SlackNotifier.send_batch"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.SlackNotifier.send_batch">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send multiple messages in batch (synchronous)</span>

<span class="sd">        :param messages: List of messages to send [{&quot;message&quot;: &quot;content&quot;, &quot;title&quot;: &quot;title&quot;, ...}, ...]</span>
<span class="sd">        :return: List of results for each message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">msg_data</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="o">**</span><span class="n">msg_data</span><span class="p">)</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="SlackNotifier.send_batch_async"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.SlackNotifier.send_batch_async">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_batch_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send multiple messages in batch (asynchronous)</span>

<span class="sd">        :param messages: List of messages to send [{&quot;message&quot;: &quot;content&quot;, &quot;title&quot;: &quot;title&quot;, ...}, ...]</span>
<span class="sd">        :return: List of results for each message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">send_async</span><span class="p">(</span><span class="o">**</span><span class="n">msg_data</span><span class="p">)</span> <span class="k">for</span> <span class="n">msg_data</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">]</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span></div>

<div class="viewcode-block" id="SlackNotifier.send_error"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.SlackNotifier.send_error">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">additional_info</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Error occurred&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send error information</span>

<span class="sd">        :param error: The exception object that occurred</span>
<span class="sd">        :param additional_info: Additional information dictionary</span>
<span class="sd">        :param title: Message title</span>
<span class="sd">        :return: Boolean indicating success or failure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
        <span class="n">error_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">error</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="n">error_traceback</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>

        <span class="n">message</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Error Type&quot;</span><span class="p">:</span> <span class="n">error_type</span><span class="p">,</span>
            <span class="s2">&quot;Error Message&quot;</span><span class="p">:</span> <span class="n">error_message</span><span class="p">,</span>
            <span class="s2">&quot;Stack Trace&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;```</span><span class="si">{</span><span class="n">error_traceback</span><span class="p">[:</span><span class="mi">800</span><span class="p">]</span><span class="si">}</span><span class="s2">```&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">error_traceback</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">800</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;```</span><span class="si">{</span><span class="n">error_traceback</span><span class="si">}</span><span class="s2">```&quot;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">additional_info</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">additional_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">message</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">msg_level</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="s2">&quot;failed&quot;</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="SlackNotifier.send_error_async"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.SlackNotifier.send_error_async">[docs]</a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_error_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">additional_info</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Error occurred&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send error information asynchronously</span>

<span class="sd">        :param error: The exception object that occurred</span>
<span class="sd">        :param additional_info: Additional information dictionary</span>
<span class="sd">        :param title: Message title</span>
<span class="sd">        :return: Boolean indicating success or failure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
        <span class="n">error_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">error</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="n">error_traceback</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>

        <span class="n">message</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Error Type&quot;</span><span class="p">:</span> <span class="n">error_type</span><span class="p">,</span>
            <span class="s2">&quot;Error Message&quot;</span><span class="p">:</span> <span class="n">error_message</span><span class="p">,</span>
            <span class="s2">&quot;Stack Trace&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;```</span><span class="si">{</span><span class="n">error_traceback</span><span class="p">[:</span><span class="mi">800</span><span class="p">]</span><span class="si">}</span><span class="s2">```&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">error_traceback</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">800</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;```</span><span class="si">{</span><span class="n">error_traceback</span><span class="si">}</span><span class="s2">```&quot;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">additional_info</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">additional_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">message</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_async</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">msg_level</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="s2">&quot;failed&quot;</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="get_level_color"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.get_level_color">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_level_color</span><span class="p">(</span><span class="n">c_level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">color_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="s2">&quot;5be312&quot;</span><span class="p">,</span>
        <span class="s2">&quot;warn&quot;</span><span class="p">:</span> <span class="s2">&quot;f2c744&quot;</span><span class="p">,</span>
        <span class="s2">&quot;warning&quot;</span><span class="p">:</span> <span class="s2">&quot;f2c744&quot;</span><span class="p">,</span>
        <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;ff0000&quot;</span><span class="p">,</span>
        <span class="s2">&quot;trace&quot;</span><span class="p">:</span> <span class="s2">&quot;1e90ff&quot;</span><span class="p">,</span>
        <span class="s2">&quot;critical&quot;</span><span class="p">:</span> <span class="s2">&quot;ff00ff&quot;</span><span class="p">,</span>
        <span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="s2">&quot;a9a9a9&quot;</span><span class="p">,</span>
        <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="s2">&quot;5be312&quot;</span><span class="p">,</span>
        <span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="s2">&quot;ff0000&quot;</span><span class="p">,</span>
        <span class="s2">&quot;in_progress&quot;</span><span class="p">:</span> <span class="s2">&quot;f2c744&quot;</span><span class="p">,</span>
        <span class="s2">&quot;complete&quot;</span><span class="p">:</span> <span class="s2">&quot;5be312&quot;</span><span class="p">,</span>
        <span class="s2">&quot;paused&quot;</span><span class="p">:</span> <span class="s2">&quot;f2c744&quot;</span><span class="p">,</span>
        <span class="s2">&quot;running&quot;</span><span class="p">:</span> <span class="s2">&quot;f2c744&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">c_level</span> <span class="o">=</span> <span class="n">c_level</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">c_level</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="k">return</span> <span class="n">color_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c_level</span><span class="p">,</span> <span class="s2">&quot;5be312&quot;</span><span class="p">)</span>  <span class="c1"># 기본 색상</span></div>


<div class="viewcode-block" id="get_status_emoji"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.get_status_emoji">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_status_emoji</span><span class="p">(</span><span class="n">status</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StatusType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return appropriate emoji based on the status.</span>

<span class="sd">    :param status: The status (success, failed, warning, etc.)</span>
<span class="sd">    :return: Emoji string corresponding to the status</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># status_emojis = {</span>
    <span class="c1">#     &#39;success&#39;: &#39;:white_check_mark:&#39;,  # 성공</span>
    <span class="c1">#     &#39;failed&#39;: &#39;:x:&#39;,  # 실패</span>
    <span class="c1">#     &#39;warning&#39;: &#39;:warning:&#39;,  # 경고</span>
    <span class="c1">#     &#39;info&#39;: &#39;:information_source:&#39;,  # 정보</span>
    <span class="c1">#     &#39;critical&#39;: &#39;:bangbang:&#39;,  # 중대한 문제</span>
    <span class="c1">#     &#39;in_progress&#39;: &#39;:hourglass_flowing_sand:&#39;,  # 진행 중</span>
    <span class="c1">#     &#39;complete&#39;: &#39;:checkered_flag:&#39;,  # 완료</span>
    <span class="c1">#     &#39;paused&#39;: &#39;:pause_button:&#39;,  # 일시 중지</span>
    <span class="c1">#     &#39;running&#39;: &#39;:runner:&#39;,  # 실행 중</span>
    <span class="c1">#     &#39;error&#39;: &#39;:red_circle:&#39;,  # 에러</span>
    <span class="c1">#     &#39;retrying&#39;: &#39;:repeat:&#39;,  # 재시도 중</span>
    <span class="c1">#     &#39;stopped&#39;: &#39;:stop_sign:&#39;,  # 중단</span>
    <span class="c1">#     &#39;queued&#39;: &#39;:hourglass:&#39;,  # 대기 중</span>
    <span class="c1"># }</span>
    <span class="n">status_emojis</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="s1">&#39;✅&#39;</span><span class="p">,</span>  <span class="c1"># 성공</span>
        <span class="s1">&#39;failed&#39;</span><span class="p">:</span> <span class="s1">&#39;🚨&#39;</span><span class="p">,</span>  <span class="c1"># 실패</span>
        <span class="s1">&#39;warning&#39;</span><span class="p">:</span> <span class="s1">&#39;⚠️&#39;</span><span class="p">,</span>  <span class="c1"># 경고</span>
        <span class="s1">&#39;info&#39;</span><span class="p">:</span> <span class="s1">&#39;ℹ️&#39;</span><span class="p">,</span>  <span class="c1"># 정보</span>
        <span class="s1">&#39;critical&#39;</span><span class="p">:</span> <span class="s1">&#39;❗&#39;</span><span class="p">,</span>  <span class="c1"># 중대한 문제</span>
        <span class="s1">&#39;in_progress&#39;</span><span class="p">:</span> <span class="s1">&#39;⏳&#39;</span><span class="p">,</span>  <span class="c1"># 진행 중</span>
        <span class="s1">&#39;complete&#39;</span><span class="p">:</span> <span class="s1">&#39;🏁&#39;</span><span class="p">,</span>  <span class="c1"># 완료</span>
        <span class="s1">&#39;paused&#39;</span><span class="p">:</span> <span class="s1">&#39;⏸️&#39;</span><span class="p">,</span>  <span class="c1"># 일시 중지</span>
        <span class="s1">&#39;running&#39;</span><span class="p">:</span> <span class="s1">&#39;🏃&#39;</span><span class="p">,</span>  <span class="c1"># 실행</span>
        <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;🔴&#39;</span><span class="p">,</span>  <span class="c1"># 에러</span>
        <span class="s1">&#39;retrying&#39;</span><span class="p">:</span> <span class="s1">&#39;🔄&#39;</span><span class="p">,</span>  <span class="c1"># 재시도 중</span>
        <span class="s1">&#39;stopped&#39;</span><span class="p">:</span> <span class="s1">&#39;🛑&#39;</span><span class="p">,</span>  <span class="c1"># 중단</span>
        <span class="s1">&#39;queued&#39;</span><span class="p">:</span> <span class="s1">&#39;⌛&#39;</span><span class="p">,</span>  <span class="c1"># 대기 중</span>
        <span class="s1">&#39;canceled&#39;</span><span class="p">:</span> <span class="s1">&#39;❌&#39;</span><span class="p">,</span>  <span class="c1"># 작업 취소</span>
        <span class="s1">&#39;approved&#39;</span><span class="p">:</span> <span class="s1">&#39;👍&#39;</span><span class="p">,</span>  <span class="c1"># 승인</span>
        <span class="s1">&#39;rejected&#39;</span><span class="p">:</span> <span class="s1">&#39;👎&#39;</span><span class="p">,</span>  <span class="c1"># 거절</span>
        <span class="s1">&#39;scheduled&#39;</span><span class="p">:</span> <span class="s1">&#39;🗓️&#39;</span><span class="p">,</span>  <span class="c1"># 스케줄된 작업</span>
        <span class="s1">&#39;maintenance&#39;</span><span class="p">:</span> <span class="s1">&#39;🛠️&#39;</span><span class="p">,</span>  <span class="c1"># 유지보수</span>
        <span class="s1">&#39;update&#39;</span><span class="p">:</span> <span class="s1">&#39;⬆️&#39;</span><span class="p">,</span>  <span class="c1"># 업데이트</span>
        <span class="s1">&#39;unknown&#39;</span><span class="p">:</span> <span class="s1">&#39;❓&#39;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">status_emojis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># 기본값은 알 수 없는 상태 이모지</span></div>


<div class="viewcode-block" id="create_slack_payload"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.create_slack_payload">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">create_slack_payload</span><span class="p">(</span>
        <span class="n">msg_text</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">send_user_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">msg_level</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">status</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StatusType</span><span class="p">],</span>
        <span class="n">simple_mode</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">icon_emoji</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">max_value_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">footer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create the payload for sending a message to Slack.</span>

<span class="sd">    :param msg_text: The main message text, can be a string, dict, or list.</span>
<span class="sd">    :type msg_text: Union[str, dict, list]</span>
<span class="sd">    :param title: Title of the message.</span>
<span class="sd">    :type title: str</span>
<span class="sd">    :param send_user_name: The username to display in Slack.</span>
<span class="sd">    :type send_user_name: str</span>
<span class="sd">    :param msg_level: Severity level of the message (info, warning, error, critical).</span>
<span class="sd">    :type msg_level: str</span>
<span class="sd">    :param status: Status type or string for dynamic emoji and message formatting.</span>
<span class="sd">    :type status: Union[str, StatusType]</span>
<span class="sd">    :param simple_mode: If True, send a simplified message without additional info.</span>
<span class="sd">    :type simple_mode: bool</span>
<span class="sd">    :param icon_emoji: Optional emoji to display as the icon for the message.</span>
<span class="sd">    :type icon_emoji: str</span>
<span class="sd">    :param max_value_length: Maximum length for any single value.</span>
<span class="sd">    :type max_value_length: int</span>
<span class="sd">    :param footer: Footer text to display at the bottom of the message.</span>
<span class="sd">    :type footer: str</span>
<span class="sd">    :param text: Optional text to display in Slack</span>
<span class="sd">    :type text: str</span>
<span class="sd">    :return: Dictionary containing the Slack message payload.</span>
<span class="sd">    :rtype: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">truncate_text</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Truncate text if it exceeds the maximum length.&quot;&quot;&quot;</span>
        <span class="n">_text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_text</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_text</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_length</span> <span class="k">else</span> <span class="n">_text</span><span class="p">[:</span><span class="n">max_length</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;...&quot;</span>

    <span class="n">emoji</span> <span class="o">=</span> <span class="n">get_status_emoji</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
    <span class="n">msg_title</span> <span class="o">=</span> <span class="n">title</span> <span class="k">if</span> <span class="n">title</span> <span class="k">else</span> <span class="n">shorten_text</span><span class="p">(</span><span class="n">msg_text</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">p_color</span> <span class="o">=</span> <span class="n">get_level_color</span><span class="p">(</span><span class="n">msg_level</span><span class="p">)</span>
    <span class="n">_msg_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">emoji</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">msg_title</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">status</span> <span class="k">else</span> <span class="n">msg_title</span>

    <span class="n">category_emoji</span> <span class="o">=</span> <span class="s2">&quot;▪️&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">send_user_name</span><span class="p">,</span>
        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">_msg_title</span><span class="p">,</span>
        <span class="s2">&quot;icon_emoji&quot;</span><span class="p">:</span> <span class="n">icon_emoji</span> <span class="k">if</span> <span class="n">icon_emoji</span> <span class="k">else</span> <span class="s2">&quot;:robot_face:&quot;</span><span class="p">,</span>
        <span class="s2">&quot;blocks&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;divider&quot;</span><span class="p">}],</span>
        <span class="s2">&quot;attachments&quot;</span><span class="p">:</span> <span class="p">[{</span>
            <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="n">p_color</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;blocks&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;header&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;plain_text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">_msg_title</span><span class="p">}},</span>
                <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;section&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;mrkdwn&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">category_emoji</span><span class="si">}{</span><span class="s2">&quot;*Host*&quot;</span><span class="si">:</span><span class="s1">^12s</span><span class="si">}</span><span class="s1"> : </span><span class="si">{</span><span class="n">net</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">()</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">net</span><span class="o">.</span><span class="n">get_public_ip</span><span class="p">(</span><span class="n">use_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}},</span>
                <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;section&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;mrkdwn&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">category_emoji</span><span class="si">}{</span><span class="s2">&quot;*Date*&quot;</span><span class="si">:</span><span class="s1">^12s</span><span class="si">}</span><span class="s1"> : </span><span class="si">{</span><span class="n">date_utils</span><span class="o">.</span><span class="n">todaydate</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}}]</span>
        <span class="p">}]</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">footer</span><span class="p">:</span>
        <span class="n">formatted_message</span> <span class="o">=</span> <span class="n">format_slack_message</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">emoji</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">emoji</span> <span class="k">else</span> <span class="n">title</span><span class="p">,</span>
            <span class="n">msg_text</span><span class="o">=</span><span class="n">msg_text</span><span class="p">,</span>
            <span class="n">msg_level</span><span class="o">=</span><span class="n">msg_level</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
            <span class="n">icon_emoji</span><span class="o">=</span><span class="s2">&quot;:rocket:&quot;</span><span class="p">,</span>
            <span class="n">footer</span><span class="o">=</span><span class="n">footer</span> <span class="ow">or</span> <span class="s2">&quot;Additional info&quot;</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="n">text</span>
        <span class="p">)</span>
        <span class="c1"># from pawnlib.output import print_var</span>
        <span class="c1"># print_var(formatted_message)</span>
        <span class="k">return</span> <span class="n">formatted_message</span>

    <span class="k">elif</span> <span class="n">simple_mode</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">send_user_name</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg_title</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">msg_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;attachments&quot;</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_make_attachment</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;Info&quot;</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">category_emoji</span><span class="si">}{</span><span class="s2">&quot;Info&quot;</span><span class="si">:</span><span class="s1">^12s</span><span class="si">}</span><span class="s1"> : </span><span class="si">{</span><span class="n">truncate_text</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">max_value_length</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">elif</span> <span class="n">key</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;💡</span><span class="si">{</span><span class="n">key</span><span class="si">:</span><span class="s1">^12s</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">truncate_text</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">max_value_length</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">key</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">category_emoji</span><span class="si">}{</span><span class="s2">&quot;Info&quot;</span><span class="si">:</span><span class="s1">^12s</span><span class="si">}</span><span class="s1"> : </span><span class="si">{</span><span class="n">truncate_text</span><span class="p">(</span><span class="n">msg_text</span><span class="p">,</span><span class="w"> </span><span class="n">max_value_length</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;section&quot;</span><span class="p">,</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;plain_text&quot;</span><span class="p">,</span>
                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">text</span>
            <span class="p">},</span>
        <span class="p">}</span>
    <span class="n">_attachments</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">attachment</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;attachments&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg_text</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">msg_text</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span><span class="p">:</span>
                    <span class="n">attachment</span><span class="p">[</span><span class="s1">&#39;blocks&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_make_attachment</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">truncate_text</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">max_value_length</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg_text</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">value_in_list</span> <span class="ow">in</span> <span class="n">msg_text</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value_in_list</span><span class="p">:</span>
                    <span class="n">attachment</span><span class="p">[</span><span class="s1">&#39;blocks&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_make_attachment</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">value_in_list</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">msg_text</span><span class="p">:</span>
            <span class="n">attachment</span><span class="p">[</span><span class="s1">&#39;blocks&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_make_attachment</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">truncate_text</span><span class="p">(</span><span class="n">msg_text</span><span class="p">,</span> <span class="n">max_value_length</span><span class="p">)))</span>
        <span class="n">_attachments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attachment</span><span class="p">)</span>
    <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;attachments&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_attachments</span>
    <span class="k">return</span> <span class="n">payload</span></div>


<div class="viewcode-block" id="send_slack_async"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.send_slack_async">[docs]</a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_slack_async</span><span class="p">(</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Asynchronous Slack message sender with retry logic.</span>

<span class="sd">    :param url: Slack webhook URL.</span>
<span class="sd">    :type url: str</span>
<span class="sd">    :param payload: The payload to send to Slack.</span>
<span class="sd">    :type payload: dict</span>
<span class="sd">    :param retries: Number of retry attempts in case of failure.</span>
<span class="sd">    :type retries: int</span>

<span class="sd">    :return: Boolean indicating success or failure.</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">retries</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                        <span class="n">pawn</span><span class="o">.</span><span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[OK][Slack] Slack message sent successfully.&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR][Slack] Error in response. Status: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR][Slack] Exception occurred: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[INFO][Slack] Retrying... (</span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">retries</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="send_slack_sync"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.send_slack_sync">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">send_slack_sync</span><span class="p">(</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Synchronous Slack message sender with retry logic.</span>

<span class="sd">    :param url: Slack webhook URL.</span>
<span class="sd">    :type url: str</span>
<span class="sd">    :param payload: The payload to send to Slack.</span>
<span class="sd">    :type payload: dict</span>
<span class="sd">    :param retries: Number of retry attempts in case of failure.</span>
<span class="sd">    :type retries: int</span>

<span class="sd">    :return: Boolean indicating success or failure.</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">retries</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">post_result</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">post_result</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span> <span class="ow">and</span> <span class="n">post_result</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;ok&quot;</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[OK][Slack] Slack message sent successfully.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR][Slack] Error in response. Status: </span><span class="si">{</span><span class="n">post_result</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">, Response: </span><span class="si">{</span><span class="n">shorten_text</span><span class="p">(</span><span class="n">post_result</span><span class="o">.</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR][Slack] Exception occurred: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[INFO][Slack] Retrying... (</span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">retries</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="send_slack"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.send_slack">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">send_slack</span><span class="p">(</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">msg_text</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">send_user_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;CtxBot&quot;</span><span class="p">,</span>
        <span class="n">msg_level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span>
        <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">status</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StatusType</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ℹ️&#39;</span><span class="p">,</span>
        <span class="n">simple_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">async_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">icon_emoji</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">footer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SlackReturnType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Send a message to Slack with optional retry logic and dynamic emoji based on status.</span>

<span class="sd">    :param url: Slack webhook URL (fetched from env `SLACK_WEBHOOK_URL` if not provided)</span>
<span class="sd">    :type url: str</span>
<span class="sd">    :param msg_text: The main message to send</span>
<span class="sd">    :type msg_text: Union[str, dict, list]</span>
<span class="sd">    :param title: Optional title for the message</span>
<span class="sd">    :type title: str</span>
<span class="sd">    :param text: Optional text to display in Slack</span>
<span class="sd">    :type text: str</span>
<span class="sd">    :param send_user_name: Username to display in Slack</span>
<span class="sd">    :type send_user_name: str</span>
<span class="sd">    :param msg_level: Message severity level (info, warning, error, critical)</span>
<span class="sd">    :type msg_level: str</span>
<span class="sd">    :param retries: Number of retries in case of failure</span>
<span class="sd">    :type retries: int</span>
<span class="sd">    :param status: Either a string or StatusType enum value to use a different format with emojis</span>
<span class="sd">    :type status: Union[str, StatusType]</span>
<span class="sd">    :param simple_mode: If True, send a simple message without extra info like host or date</span>
<span class="sd">    :type simple_mode: bool</span>
<span class="sd">    :param async_mode: If True, sends the message asynchronously</span>
<span class="sd">    :type async_mode: bool</span>
<span class="sd">    :param icon_emoji: Optional emoji to display as the icon for the message.</span>
<span class="sd">    :type icon_emoji: str</span>
<span class="sd">    :param footer: Footer text to display at the bottom of the message.</span>
<span class="sd">    :type footer: str</span>
<span class="sd">    :return: Boolean indicating success or failure</span>
<span class="sd">    :rtype: bool</span>

<span class="sd">    Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pawnlib.utils.notify import send_slack</span>

<span class="sd">            # Send a message with status using StatusType enum</span>
<span class="sd">            send_slack(SLACK_WEBHOOK_URL, &quot;The process completed successfully&quot;,</span>
<span class="sd">                       title=&quot;Process Status&quot;, msg_level=&quot;info&quot;, status=StatusType.SUCCESS)</span>

<span class="sd">            # Send a message with status using string</span>
<span class="sd">            send_slack(SLACK_WEBHOOK_URL, &quot;The process completed successfully&quot;,</span>
<span class="sd">                       title=&quot;Process Status&quot;, msg_level=&quot;info&quot;, status=&quot;success&quot;)</span>

<span class="sd">            # Send an error message</span>
<span class="sd">            send_slack(SLACK_WEBHOOK_URL, &quot;The process failed due to an unexpected error&quot;,</span>
<span class="sd">                       title=&quot;Process Status&quot;, msg_level=&quot;error&quot;, status=&quot;failed&quot;)</span>

<span class="sd">            # Send a warning message</span>
<span class="sd">            send_slack(SLACK_WEBHOOK_URL, &quot;The disk space is running low&quot;,</span>
<span class="sd">                       title=&quot;System Warning&quot;, msg_level=&quot;warning&quot;, status=&quot;warning&quot;)</span>

<span class="sd">            # Send a message for an in-progress task</span>
<span class="sd">            send_slack(SLACK_WEBHOOK_URL, &quot;The process is currently running&quot;,</span>
<span class="sd">                       title=&quot;Process Status&quot;, msg_level=&quot;info&quot;, status=&quot;in_progress&quot;)</span>

<span class="sd">            # Send a message for task completion</span>
<span class="sd">            send_slack(SLACK_WEBHOOK_URL, &quot;The task has been completed&quot;,</span>
<span class="sd">                       title=&quot;Task Status&quot;, msg_level=&quot;info&quot;, status=&quot;complete&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">setup_logger</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;send_slack&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;SLACK_WEBHOOK_URL&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">url</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using SLACK_WEBHOOK_URL from environment variables.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Required SLACK_WEBHOOK_URL&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">async_mode</span><span class="p">:</span>
                <span class="n">future</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">()</span>
                <span class="n">future</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">future</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

    <span class="n">payload</span> <span class="o">=</span> <span class="n">create_slack_payload</span><span class="p">(</span>
        <span class="n">msg_text</span><span class="o">=</span><span class="n">msg_text</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">send_user_name</span><span class="o">=</span><span class="n">send_user_name</span><span class="p">,</span>
        <span class="n">msg_level</span><span class="o">=</span><span class="n">msg_level</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
        <span class="n">simple_mode</span><span class="o">=</span><span class="n">simple_mode</span><span class="p">,</span>
        <span class="n">icon_emoji</span><span class="o">=</span><span class="n">icon_emoji</span><span class="p">,</span>
        <span class="n">footer</span><span class="o">=</span><span class="n">footer</span><span class="p">,</span>
        <span class="n">text</span><span class="o">=</span><span class="n">text</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">async_mode</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">send_slack_async</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">retries</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">send_slack_sync</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">retries</span><span class="p">)</span></div>


<div class="viewcode-block" id="send_slack_token"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.send_slack_token">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">send_slack_token</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">channel_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">send_user</span><span class="o">=</span><span class="s2">&quot;python_app&quot;</span><span class="p">,</span> <span class="n">msg_level</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
        <span class="n">msg_title</span> <span class="o">=</span> <span class="n">title</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg_title</span> <span class="o">=</span> <span class="n">message</span>

    <span class="n">p_color</span> <span class="o">=</span> <span class="n">get_level_color</span><span class="p">(</span><span class="n">msg_level</span><span class="p">)</span>

    <span class="n">attachments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="c1"># &quot;pretext&quot;: f&quot;[{send_user}] {title}&quot;,</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span>
            <span class="c1"># &quot;text&quot;: f&quot;{converter.todaydate(&#39;ms&#39;)}  {message}&quot;,</span>
            <span class="c1"># &quot;mrkdwn_in&quot;: [&quot;pretext&quot;]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="n">p_color</span><span class="p">,</span>
            <span class="s2">&quot;blocks&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;section&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;plain_text&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Title : </span><span class="si">{</span><span class="n">msg_title</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;divider&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;section&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;plain_text&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;+ [HOST]&quot;</span><span class="si">:</span><span class="s1">^12s</span><span class="si">}</span><span class="s1"> : </span><span class="si">{</span><span class="n">net</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">()</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">net</span><span class="o">.</span><span class="n">get_public_ip</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;section&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;plain_text&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;+ [DATE]&quot;</span><span class="si">:</span><span class="s1">^12s</span><span class="si">}</span><span class="s1"> : </span><span class="si">{</span><span class="p">(</span><span class="n">date_utils</span><span class="o">.</span><span class="n">todaydate</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="p">}</span>
                <span class="p">},</span>
            <span class="p">],</span>
            <span class="c1"># &quot;mrkdwn_in&quot;: [&quot;blocks&quot;],</span>
        <span class="p">}</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attachments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;blocks&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">message_k</span><span class="p">,</span> <span class="n">message_v</span> <span class="ow">in</span> <span class="n">message</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">attachments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;blocks&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;section&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;plain_text&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;+ [</span><span class="si">{</span><span class="n">message_k</span><span class="si">:</span><span class="s2">&lt;12s</span><span class="si">}</span><span class="s2">]: </span><span class="si">{</span><span class="n">message_v</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">attachments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;blocks&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;section&quot;</span><span class="p">,</span>
                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;plain_text&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;+ [DESC]&#39;</span><span class="si">:</span><span class="s2">^12s</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;channel&quot;</span><span class="p">:</span> <span class="n">channel_name</span><span class="p">,</span>
        <span class="s2">&quot;attachments&quot;</span><span class="p">:</span> <span class="n">attachments</span>
    <span class="p">}</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">jequest</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://slack.com/api/chat.postMessage&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">res</span> <span class="ow">and</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status_code&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">200</span> <span class="ow">and</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">][</span><span class="s1">&#39;ok&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[OK][Slack] Send slack with token&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR][Slack] Got errors, status_code=</span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status_code&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">, text=</span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR][Slack] Got errors -&gt; </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="format_slack_message"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.format_slack_message">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">format_slack_message</span><span class="p">(</span><span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">msg_text</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">msg_level</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
                         <span class="n">status</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">icon_emoji</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">footer</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="n">p_color</span> <span class="o">=</span> <span class="n">get_level_color</span><span class="p">(</span><span class="n">msg_level</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg_text</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">msg_text</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
                <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;N/A&quot;</span><span class="p">,</span>
                <span class="s2">&quot;short&quot;</span><span class="p">:</span> <span class="kc">True</span>
            <span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># msg_text가 string일 때 fields는 필요 없음</span>
        <span class="n">msg_text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">msg_text</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;attachments&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;fallback&quot;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
                <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="n">p_color</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">text</span> <span class="ow">or</span> <span class="n">msg_text</span><span class="p">,</span>
                <span class="s2">&quot;footer&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">footer</span><span class="si">}</span><span class="s2"> run and sent from </span><span class="si">{</span><span class="n">net</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ts&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
                <span class="s2">&quot;icon_emoji&quot;</span><span class="p">:</span> <span class="n">icon_emoji</span><span class="p">,</span>
                <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span></div>

<div class="viewcode-block" id="send_slack_notification"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.notify.send_slack_notification">[docs]</a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_slack_notification</span><span class="p">(</span><span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">msg_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="n">icon_emoji</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">footer</span><span class="o">=</span><span class="s2">&quot;Pawnlib&quot;</span><span class="p">):</span>
    <span class="n">formatted_message</span> <span class="o">=</span> <span class="n">format_slack_message</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">msg_text</span><span class="o">=</span><span class="n">msg_text</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="n">level</span><span class="p">,</span>
        <span class="n">icon_emoji</span><span class="o">=</span><span class="n">icon_emoji</span> <span class="ow">or</span> <span class="s2">&quot;:rocket:&quot;</span><span class="p">,</span>
        <span class="n">footer</span><span class="o">=</span><span class="n">footer</span>
    <span class="p">)</span>
    <span class="n">slack_webhook_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;SLACK_WEBHOOK_URL&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">slack_webhook_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">formatted_message</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red]Failed to send Slack notification: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">[/red]&quot;</span><span class="p">)</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, jinwoo.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>