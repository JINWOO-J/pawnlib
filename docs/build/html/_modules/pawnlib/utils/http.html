<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pawnlib.utils.http &mdash; Pawnlib v1.0.20</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            pawnlib
          </a>
              <div class="version">
                1.0.20
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Welcome to pawnlib’s documentation!</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Packages</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.asyncio.html">pawnlib.asyncio package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.builder.html">pawnlib.builder package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.config.html">pawnlib.config package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.input.html">pawnlib.input package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.output.html">pawnlib.output package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.resource.html">pawnlib.resource package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.typing.html">pawnlib.typing package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module/pawnlib.utils.html">pawnlib.utils package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">pawnlib</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pawnlib.utils.http</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pawnlib.utils.http</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">pawnlib.config.globalconfig</span> <span class="kn">import</span> <span class="n">pawnlib_config</span> <span class="k">as</span> <span class="n">pawn</span><span class="p">,</span> <span class="n">global_verbose</span><span class="p">,</span> <span class="n">pconf</span><span class="p">,</span> <span class="n">SimpleNamespace</span><span class="p">,</span> <span class="n">Null</span>
<span class="kn">from</span> <span class="nn">pawnlib.output</span> <span class="kn">import</span> <span class="n">NoTraceBackException</span><span class="p">,</span> <span class="n">dump</span><span class="p">,</span> <span class="n">syntax_highlight</span><span class="p">,</span> <span class="n">kvPrint</span><span class="p">,</span> <span class="n">debug_logging</span><span class="p">,</span> <span class="n">PrintRichTable</span><span class="p">,</span> <span class="n">get_debug_here_info</span>
<span class="kn">from</span> <span class="nn">pawnlib.resource</span> <span class="kn">import</span> <span class="n">net</span>
<span class="kn">from</span> <span class="nn">pawnlib.typing</span> <span class="kn">import</span> <span class="n">date_utils</span>
<span class="kn">from</span> <span class="nn">pawnlib.typing.converter</span> <span class="kn">import</span> <span class="n">append_suffix</span><span class="p">,</span> <span class="n">append_prefix</span><span class="p">,</span> <span class="n">hex_to_number</span><span class="p">,</span> <span class="n">FlatDict</span><span class="p">,</span> <span class="n">FlatterDict</span><span class="p">,</span> <span class="n">flatten</span><span class="p">,</span> <span class="n">const</span><span class="p">,</span> <span class="n">shorten_text</span>
<span class="kn">from</span> <span class="nn">pawnlib.typing.constants</span> <span class="kn">import</span> <span class="n">const</span>
<span class="kn">from</span> <span class="nn">pawnlib.typing.generator</span> <span class="kn">import</span> <span class="n">json_rpc</span><span class="p">,</span> <span class="n">random_token_address</span><span class="p">,</span> <span class="n">generate_json_rpc</span>
<span class="kn">from</span> <span class="nn">pawnlib.typing.check</span> <span class="kn">import</span> <span class="n">keys_exists</span><span class="p">,</span> <span class="n">is_int</span><span class="p">,</span> <span class="n">is_float</span><span class="p">,</span> <span class="n">list_depth</span><span class="p">,</span> <span class="n">is_valid_token_address</span><span class="p">,</span> <span class="n">keys_exists</span><span class="p">,</span> <span class="n">sys_exit</span>
<span class="kn">from</span> <span class="nn">pawnlib.utils.operate_handler</span> <span class="kn">import</span> <span class="n">WaitStateLoop</span>
<span class="kn">from</span> <span class="nn">websocket</span> <span class="kn">import</span> <span class="n">create_connection</span><span class="p">,</span> <span class="n">WebSocket</span><span class="p">,</span> <span class="n">enableTrace</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pawnlib.utils</span> <span class="kn">import</span> <span class="n">icx_signer</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Type</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Literal</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Literal</span>

<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">auto</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">operator</span> <span class="k">as</span> <span class="nn">_operator</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">InitVar</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">import</span> <span class="nn">requests</span>


<span class="n">ALLOWS_HTTP_METHOD</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;patch&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">]</span>
<span class="n">ALLOW_OPERATOR</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;!=&quot;</span><span class="p">,</span> <span class="s2">&quot;==&quot;</span><span class="p">,</span> <span class="s2">&quot;&gt;=&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;=&quot;</span><span class="p">,</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="s2">&quot;include&quot;</span><span class="p">,</span> <span class="s2">&quot;exclude&quot;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">_ResponseWithElapsed</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Response</span><span class="p">):</span>
    <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;Response [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">], </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span><span class="si">}</span><span class="s2">ms, succ=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">success</span><span class="si">}</span><span class="s2">&gt;&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;Response [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">], </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span><span class="si">}</span><span class="s2">ms, succ=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">success</span><span class="si">}</span><span class="s2">&gt;&quot;</span>

    <span class="k">def</span> <span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;_content&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">),</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>


<span class="n">requests</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Response</span><span class="o">.</span><span class="fm">__str__</span> <span class="o">=</span> <span class="n">_ResponseWithElapsed</span><span class="o">.</span><span class="fm">__str__</span>
<span class="n">requests</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Response</span><span class="o">.</span><span class="fm">__repr__</span> <span class="o">=</span> <span class="n">_ResponseWithElapsed</span><span class="o">.</span><span class="fm">__repr__</span>
<span class="n">requests</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Response</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">_ResponseWithElapsed</span><span class="o">.</span><span class="n">error</span>
<span class="n">requests</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Response</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="n">_ResponseWithElapsed</span><span class="o">.</span><span class="n">success</span>
<span class="n">requests</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Response</span><span class="o">.</span><span class="n">as_dict</span> <span class="o">=</span> <span class="n">_ResponseWithElapsed</span><span class="o">.</span><span class="n">as_dict</span>


<div class="viewcode-block" id="HttpResponse"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.HttpResponse">[docs]</a><span class="k">class</span> <span class="nc">HttpResponse</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">999</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">elapsed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">success</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_code</span> <span class="o">=</span> <span class="n">status_code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="n">response</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">error</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">=</span> <span class="n">elapsed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="n">success</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">json</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">json</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ok</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ok</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;HttpResponse&gt; status_code=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">, response=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="si">}</span><span class="s2">, error=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;HttpResponse&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span>

<div class="viewcode-block" id="HttpResponse.as_dict"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.HttpResponse.as_dict">[docs]</a>    <span class="k">def</span> <span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span></div></div>


<div class="viewcode-block" id="StrEnum"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.StrEnum">[docs]</a><span class="k">class</span> <span class="nc">StrEnum</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_generate_next_value_</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">last_values</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">name</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span></div>


<div class="viewcode-block" id="AllowsHttpMethod"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.AllowsHttpMethod">[docs]</a><span class="k">class</span> <span class="nc">AllowsHttpMethod</span><span class="p">(</span><span class="n">StrEnum</span><span class="p">):</span>
    <span class="n">get</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">post</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">patch</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">delete</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span></div>


<div class="viewcode-block" id="AllowsKey"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.AllowsKey">[docs]</a><span class="k">class</span> <span class="nc">AllowsKey</span><span class="p">(</span><span class="n">StrEnum</span><span class="p">):</span>
    <span class="n">status_code</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">raw</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">reason</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">http_version</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">r_headers</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">elapsed</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span></div>


<div class="viewcode-block" id="NetworkInfo"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.NetworkInfo">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">NetworkInfo</span><span class="p">:</span>
    <span class="n">network_name</span><span class="p">:</span> <span class="n">InitVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mainnet&quot;</span>
    <span class="n">platform</span><span class="p">:</span> <span class="n">InitVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;icon&quot;</span>
    <span class="n">force</span><span class="p">:</span> <span class="n">InitVar</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">network_api</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">planet_api</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">nid</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">network</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">valid_network</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">platform</span><span class="o">=</span><span class="s2">&quot;icon&quot;</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_platform_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;icon&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;symbol&quot;</span><span class="p">:</span> <span class="s2">&quot;ICX&quot;</span><span class="p">,</span>
                <span class="s2">&quot;network_info&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;mainnet&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;network_api&quot;</span><span class="p">:</span> <span class="s2">&quot;https://ctz.solidwallet.io&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;nid&quot;</span><span class="p">:</span> <span class="s2">&quot;0x1&quot;</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;lisbon&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;network_api&quot;</span><span class="p">:</span> <span class="s2">&quot;https://lisbon.net.solidwallet.io&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;nid&quot;</span><span class="p">:</span> <span class="s2">&quot;0x2&quot;</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;sejong&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;network_api&quot;</span><span class="p">:</span> <span class="s2">&quot;https://sejong.net.solidwallet.io&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;nid&quot;</span><span class="p">:</span> <span class="s2">&quot;0x53&quot;</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;cdnet&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;network_api&quot;</span><span class="p">:</span> <span class="s2">&quot;http://20.20.1.122:9000&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;nid&quot;</span><span class="p">:</span> <span class="s2">&quot;0x53&quot;</span>
                    <span class="p">},</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s2">&quot;havah&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;symbol&quot;</span><span class="p">:</span> <span class="s2">&quot;HVH&quot;</span><span class="p">,</span>
                <span class="s2">&quot;network_info&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;mainnet&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;planet_api&quot;</span><span class="p">:</span> <span class="s2">&quot;https://planet.havah.io&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;network_api&quot;</span><span class="p">:</span> <span class="s2">&quot;https://ctz.havah.io&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;nid&quot;</span><span class="p">:</span> <span class="s2">&quot;0x100&quot;</span>  <span class="c1"># 256</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;vega&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;planet_api&quot;</span><span class="p">:</span> <span class="s2">&quot;https://planet.vega.havah.io&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;network_api&quot;</span><span class="p">:</span> <span class="s2">&quot;https://ctz.vega.havah.io&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;nid&quot;</span><span class="p">:</span> <span class="s2">&quot;0x101&quot;</span>  <span class="c1"># 257</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;deneb&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;planet_api&quot;</span><span class="p">:</span> <span class="s2">&quot;https://planet.dev.havah.io&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;network_api&quot;</span><span class="p">:</span> <span class="s2">&quot;https://ctz.dev.havah.io&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;nid&quot;</span><span class="p">:</span> <span class="s2">&quot;0x110&quot;</span>  <span class="c1"># 272</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;svm_havah&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;network_api&quot;</span><span class="p">:</span> <span class="s2">&quot;http://20.20.1.153:9900&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;nid&quot;</span><span class="p">:</span> <span class="s2">&quot;0x8361&quot;</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network_name</span> <span class="o">=</span> <span class="n">network_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network_info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">static_values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nid&quot;</span><span class="p">,</span> <span class="s2">&quot;network_api&quot;</span><span class="p">,</span> <span class="s2">&quot;endpoint&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">()</span>

<div class="viewcode-block" id="NetworkInfo.is_set_static_values"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.NetworkInfo.is_set_static_values">[docs]</a>    <span class="k">def</span> <span class="nf">is_set_static_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">static_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_values</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">static_value</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">_get_network_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">platform</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">network_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">network_name</span> <span class="o">=</span> <span class="n">network_name</span>
        <span class="k">if</span> <span class="n">platform</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">network_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_name</span> <span class="o">==</span> <span class="s2">&quot;veganet&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">network_name</span> <span class="o">=</span> <span class="s2">&quot;vega&quot;</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_name</span> <span class="o">==</span> <span class="s2">&quot;denebnet&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">network_name</span> <span class="o">=</span> <span class="s2">&quot;deneb&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_platform_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Allowed platform - values </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_platform_info</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_set_static_values</span><span class="p">():</span>
            <span class="n">_network_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_platform_info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;network_info&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_network_info</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_network_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_name</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Allowed network_name in &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="si">}</span><span class="s2">&#39; - values </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">_network_info</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">network_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_platform_info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">][</span><span class="s1">&#39;network_info&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_name</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">_network_info</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_platform_info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;symbol&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_info</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">valid_network</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">network_info</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">network_info</span><span class="p">[</span><span class="s1">&#39;network_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">network_info</span><span class="p">[</span><span class="s1">&#39;platform&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span>

    <span class="k">def</span> <span class="nf">_initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">platform</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_network_info</span><span class="p">(</span><span class="n">network_name</span><span class="p">,</span> <span class="n">platform</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_info</span><span class="p">:</span>
            <span class="n">this_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_info</span>

            <span class="k">if</span> <span class="n">this_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;network&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;network&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">this_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">this_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

<div class="viewcode-block" id="NetworkInfo.set_network"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.NetworkInfo.set_network">[docs]</a>    <span class="k">def</span> <span class="nf">set_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">platform</span><span class="o">=</span><span class="s2">&quot;icon&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">network_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">(</span><span class="n">network_name</span><span class="o">=</span><span class="n">network_name</span><span class="p">,</span> <span class="n">platform</span><span class="o">=</span><span class="n">platform</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkInfo.list"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.NetworkInfo.list">[docs]</a>    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_info</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

<div class="viewcode-block" id="NetworkInfo.get_platform_list"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.NetworkInfo.get_platform_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_platform_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_platform_info</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

<div class="viewcode-block" id="NetworkInfo.get_network_list"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.NetworkInfo.get_network_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_network_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">platform</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">platform</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_platform_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_platform_info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">][</span><span class="s1">&#39;network_info&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

<div class="viewcode-block" id="NetworkInfo.tuple"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.NetworkInfo.tuple">[docs]</a>    <span class="k">def</span> <span class="nf">tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_info</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

<div class="viewcode-block" id="NetworkInfo.to_dict"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.NetworkInfo.to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_info</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_info</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_info</span></div>

    <span class="k">def</span> <span class="nf">_parse_network_info_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_info</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_info</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">network_info_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;network_info=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">network_info</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">self_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">self_dict</span><span class="p">[</span><span class="s1">&#39;_platform_info&#39;</span><span class="p">]</span>
            <span class="n">network_info_str</span> <span class="o">=</span> <span class="n">self_dict</span>
        <span class="k">return</span> <span class="n">network_info_str</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_parse_network_info_string</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_parse_network_info_string</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span></div>


<div class="viewcode-block" id="IconRpcTemplates"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcTemplates">[docs]</a><span class="k">class</span> <span class="nc">IconRpcTemplates</span><span class="p">:</span>
    <span class="n">requires_sign_method</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;icx_sendTransaction&#39;</span><span class="p">,</span> <span class="s1">&#39;icx_sendTransaction(SCORE)&#39;</span><span class="p">,</span> <span class="s1">&#39;icx_call&#39;</span><span class="p">]</span>
    <span class="n">templates</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;main_api&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1"># &quot;icx_getTotalSupply&quot;: json_rpc(&quot;icx_getTotalSupply&quot;),</span>
            <span class="s2">&quot;icx_getTotalSupply&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s2">&quot;icx_getLastBlock&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s2">&quot;icx_getBalance&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}},</span>
            <span class="s2">&quot;icx_getTransactionResult&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;txHash&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}},</span>
            <span class="s2">&quot;icx_getTransactionByHash&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;txHash&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}},</span>
            <span class="s2">&quot;icx_getBlockByHeight&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}},</span>
            <span class="s2">&quot;icx_getBlockByHash&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;hash&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}},</span>
            <span class="s2">&quot;icx_getScoreApi&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}},</span>
            <span class="s2">&quot;icx_call&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">},</span>
            <span class="s2">&quot;icx_sendTransaction&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;nid&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;stepLimit&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;0x3&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;nonce&quot;</span><span class="p">:</span> <span class="s2">&quot;0x23&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s2">&quot;icx_sendTransaction(SCORE)&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;icx_sendTransaction&quot;</span><span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;IISS&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;setStake&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;icx_sendTransaction&quot;</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;setStake&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">),</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">return_rpc</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_category</span> <span class="o">=</span> <span class="n">category</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_method</span> <span class="o">=</span> <span class="n">method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_rpc</span><span class="p">()</span>

<div class="viewcode-block" id="IconRpcTemplates.get_category"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcTemplates.get_category">[docs]</a>    <span class="k">def</span> <span class="nf">get_category</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

<div class="viewcode-block" id="IconRpcTemplates.get_methods"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcTemplates.get_methods">[docs]</a>    <span class="k">def</span> <span class="nf">get_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">methods</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_category</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_category</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">_category</span> <span class="o">==</span> <span class="n">category</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_category</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">methods</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_category</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">methods</span></div>

<div class="viewcode-block" id="IconRpcTemplates.create_rpc"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcTemplates.create_rpc">[docs]</a>    <span class="k">def</span> <span class="nf">create_rpc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{},</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="IconRpcTemplates.is_required_sign"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcTemplates.is_required_sign">[docs]</a>    <span class="k">def</span> <span class="nf">is_required_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires_sign_method</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="IconRpcTemplates.load_template"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcTemplates.load_template">[docs]</a>    <span class="k">def</span> <span class="nf">load_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_category</span><span class="p">:</span>
            <span class="n">_template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_category</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_template</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">_template</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_template</span></div>

<div class="viewcode-block" id="IconRpcTemplates.get_rpc"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcTemplates.get_rpc">[docs]</a>    <span class="k">def</span> <span class="nf">get_rpc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">category</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_category</span> <span class="o">=</span> <span class="n">category</span>
        <span class="k">if</span> <span class="n">method</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_method</span> <span class="o">=</span> <span class="n">method</span>

        <span class="c1"># if self._category:</span>
        <span class="c1">#     _template = self.templates.get(self._category)</span>
        <span class="c1"># else:</span>
        <span class="c1">#     _template = self.templates.values()</span>
        <span class="n">_template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_template</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_method</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_template</span><span class="p">:</span>
                <span class="n">_arguments</span> <span class="o">=</span> <span class="n">_template</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="p">{})</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_arguments</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Template Error] Syntax Error -&gt; category=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_category</span><span class="si">}</span><span class="s2">, method=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_method</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Template Error] Required method -&gt;  category=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_category</span><span class="si">}</span><span class="s2">, method=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_method</span> <span class="o">=</span> <span class="n">_arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_method</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_params</span> <span class="o">=</span> <span class="n">_arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;params&#39;</span><span class="p">,</span> <span class="p">{})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">return_rpc</span> <span class="o">=</span> <span class="n">json_rpc</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_method</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">)</span>

                <span class="c1"># pawn.console.log(f&quot;-- return_rpc {self.return_rpc}&quot;)</span>

                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_rpc</span>
        <span class="k">return</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="IconRpcTemplates.get_required_params"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcTemplates.get_required_params">[docs]</a>    <span class="k">def</span> <span class="nf">get_required_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span></div></div>


<div class="viewcode-block" id="IconRpcHelper"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcHelper">[docs]</a><span class="k">class</span> <span class="nc">IconRpcHelper</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">wallet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">network_info</span><span class="p">:</span> <span class="n">NetworkInfo</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">raise_on_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wallet</span> <span class="o">=</span> <span class="n">wallet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">governance_address</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_payload</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network_info</span> <span class="o">=</span> <span class="n">network_info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raise_on_failure</span> <span class="o">=</span> <span class="n">raise_on_failure</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_info</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_info</span><span class="o">.</span><span class="n">network_api</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">append_suffix</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;/api/v3&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_url</span> <span class="o">=</span> <span class="n">append_suffix</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;/api/v3d&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signed_tx</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent_method</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_can_be_signed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_error</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_global_reqeust_payload</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="IconRpcHelper.initialize"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcHelper.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># self._set_governance_address()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_info</span><span class="p">:</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_info</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Not found network_info&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_set_governance_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_info</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">governance_address</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_info</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;havah&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">method</span> <span class="ow">and</span> <span class="n">method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">governance_address</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">CHAIN_SCORE_ADDRESS</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">governance_address</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">GOVERNANCE_ADDRESS</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">governance_address</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;cx</span><span class="si">{</span><span class="s1">&#39;0&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">39</span><span class="si">}</span><span class="s2">1&quot;</span>

    <span class="k">def</span> <span class="nf">_decorator_enforce_kwargs</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">from_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">func_name</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start &#39;</span><span class="si">{</span><span class="n">func_name</span><span class="si">}</span><span class="s2">&#39; function&quot;</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ret</span>

        <span class="k">return</span> <span class="n">from_kwargs</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_str_to_dict</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">payload_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">payload</span>
            <span class="k">return</span> <span class="n">payload_dict</span>

        <span class="k">return</span> <span class="n">payload</span>

    <span class="k">def</span> <span class="nf">_convert_valid_url_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">url</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">append_http</span><span class="p">(</span><span class="n">append_api_v3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid url: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_convert_valid_payload_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">payload</span><span class="p">:</span>
            <span class="n">_request_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_str_to_dict</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_request_payload</span> <span class="o">=</span> <span class="n">json_rpc</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_request_payload</span>

<div class="viewcode-block" id="IconRpcHelper.rpc_call"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcHelper.rpc_call">[docs]</a>    <span class="k">def</span> <span class="nf">rpc_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">timeout</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
                 <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                 <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                 <span class="n">print_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">raise_on_failure</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">store_request_payload</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">http_method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;patch&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;post&#39;</span><span class="p">,</span>
                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">url</span><span class="p">:</span>
            <span class="n">_url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span>

        <span class="k">if</span> <span class="n">raise_on_failure</span><span class="p">:</span>
            <span class="n">_raise_on_failure</span> <span class="o">=</span> <span class="n">raise_on_failure</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_raise_on_failure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raise_on_failure</span>

        <span class="n">_url</span> <span class="o">=</span> <span class="n">append_http</span><span class="p">(</span><span class="n">append_api_v3</span><span class="p">(</span><span class="n">_url</span><span class="p">))</span>
        <span class="n">_request_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_valid_payload_format</span><span class="p">(</span><span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">store_request_payload</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">request_payload</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">_request_payload</span><span class="p">)</span>

        <span class="c1"># self.response = jequest(</span>
        <span class="c1">#     url=_url,</span>
        <span class="c1">#     payload=_request_payload,</span>
        <span class="c1">#     method=&quot;post&quot;</span>
        <span class="c1"># )</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="n">CallHttp</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">_url</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">http_method</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
            <span class="n">payload</span><span class="o">=</span><span class="n">_request_payload</span><span class="p">,</span>
            <span class="n">raise_on_failure</span><span class="o">=</span><span class="n">_raise_on_failure</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
        <span class="c1"># pawn.console.log(self.response)</span>
        <span class="c1"># self.response = CallHttp(</span>
        <span class="c1">#     url=_url,</span>
        <span class="c1">#     method=&quot;post&quot;,</span>
        <span class="c1">#     timeout=1000,</span>
        <span class="c1">#     payload=_request_payload,</span>
        <span class="c1">#     raise_on_failure=_raise_on_failure,</span>
        <span class="c1"># ).run()</span>

        <span class="c1"># pawn.console.log(self.response.response)</span>
        <span class="c1"># pawn.console.log(self.response.response.as_dict())</span>
        <span class="c1"># exit()</span>

        <span class="k">if</span> <span class="n">print_error</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status_code&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">):</span>
                <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red][ERROR] status_code=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, error=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">][</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red][ERROR][/red] payload=</span><span class="si">{</span><span class="n">_request_payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status_code&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">999</span><span class="p">:</span>
                <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red][ERROR][/red] </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># self.exit_on_failure(f&quot;[red][ERROR][/red] {self.response.get(&#39;error&#39;)}&quot;)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red][ERROR][/red] status_code=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status_code&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">, text=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="IconRpcHelper.print_response"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcHelper.print_response">[docs]</a>    <span class="k">def</span> <span class="nf">print_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hex_to_int</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status_code&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">style</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">style</span> <span class="o">=</span> <span class="s2">&quot;rule.line&quot;</span>
        <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">rule</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;Response </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status_code&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&gt;&quot;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span> <span class="n">characters</span><span class="o">=</span><span class="s2">&quot;═&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">):</span>
            <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">),</span> <span class="n">hex_to_int</span><span class="o">=</span><span class="n">hex_to_int</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">syntax_highlight</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;html&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="IconRpcHelper.print_request"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcHelper.print_request">[docs]</a>    <span class="k">def</span> <span class="nf">print_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">rule</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;Request&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">syntax_highlight</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_payload</span><span class="p">,</span> <span class="n">line_indent</span><span class="o">=</span><span class="s1">&#39;   &#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="IconRpcHelper.make_params"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcHelper.make_params">[docs]</a>    <span class="k">def</span> <span class="nf">make_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{}):</span>
        <span class="n">json_rpc</span><span class="p">(</span>
            <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_is_signable_governance_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_info</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;havah&quot;</span> <span class="ow">and</span> <span class="n">method</span><span class="p">:</span>
            <span class="n">required_sign_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="s1">&#39;register&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">required_sign_method</span> <span class="ow">in</span> <span class="n">required_sign_methods</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">required_sign_method</span><span class="p">):</span>
                    <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">, It will be signed with the following. required_sign_methods=</span><span class="si">{</span><span class="n">required_sign_methods</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_make_governance_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_can_be_signed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_can_be_signed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_signable_governance_method</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
            <span class="c1"># pawn.console.log(f&quot;[red] can_be_signed = {self._can_be_signed}&quot;)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_can_be_signed</span><span class="p">:</span>
            <span class="n">parent_method</span> <span class="o">=</span> <span class="s2">&quot;icx_sendTransaction&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parent_method</span> <span class="o">=</span> <span class="s2">&quot;icx_call&quot;</span>
        <span class="n">_request_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_valid_payload_format</span><span class="p">(</span>
            <span class="n">method</span><span class="o">=</span><span class="n">parent_method</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">governance_address</span><span class="p">,</span>
                <span class="s2">&quot;dataType&quot;</span><span class="p">:</span> <span class="s2">&quot;call&quot;</span><span class="p">,</span>
                <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
                    <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">params</span>
                <span class="p">}</span>
            <span class="p">},</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">_request_payload</span>

<div class="viewcode-block" id="IconRpcHelper.governance_call"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcHelper.governance_call">[docs]</a>    <span class="k">def</span> <span class="nf">governance_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{},</span> <span class="n">governance_address</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">store_request_payload</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">is_wait</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">governance_address</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">governance_address</span> <span class="o">=</span> <span class="n">governance_address</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_governance_address</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_can_be_signed</span> <span class="o">=</span> <span class="n">sign</span>
        <span class="n">_request_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_governance_payload</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_can_be_signed</span><span class="p">:</span>
            <span class="c1"># if _request_payload[&#39;params&#39;].get(&#39;value&#39;, None):</span>
            <span class="n">_request_payload</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0x0&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sign_tx</span><span class="p">(</span><span class="n">payload</span><span class="o">=</span><span class="n">_request_payload</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sign_send</span><span class="p">(</span><span class="n">is_wait</span><span class="o">=</span><span class="n">is_wait</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_call</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="n">_request_payload</span><span class="p">,</span>
                <span class="n">print_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">store_request_payload</span><span class="o">=</span><span class="n">store_request_payload</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="p">{})</span></div>

<div class="viewcode-block" id="IconRpcHelper.get_step_price"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcHelper.get_step_price">[docs]</a>    <span class="k">def</span> <span class="nf">get_step_price</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">governance_call</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;getStepPrice&quot;</span><span class="p">,</span> <span class="n">governance_address</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">CHAIN_SCORE_ADDRESS</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">store_request_payload</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span></div>

    <span class="k">def</span> <span class="nf">_get_step_costs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">governance_call</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;getStepCosts&quot;</span><span class="p">,</span> <span class="n">governance_address</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">CHAIN_SCORE_ADDRESS</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">store_request_payload</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>

<div class="viewcode-block" id="IconRpcHelper.get_step_cost"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcHelper.get_step_cost">[docs]</a>    <span class="k">def</span> <span class="nf">get_step_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step_kind</span><span class="o">=</span><span class="s2">&quot;apiCall&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_step_costs</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">step_kind</span><span class="p">)</span></div>

<div class="viewcode-block" id="IconRpcHelper.get_estimate_step"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcHelper.get_estimate_step">[docs]</a>    <span class="k">def</span> <span class="nf">get_estimate_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">url</span><span class="p">:</span>
            <span class="n">_url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_url</span>

        <span class="n">_tx</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
        <span class="n">_tx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_fill_parameter</span><span class="p">(</span><span class="n">_tx</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_tx</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">_tx</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;debug_estimateStep&quot;</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_call</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="n">_url</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="n">_tx</span><span class="p">,</span>
                <span class="n">store_request_payload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">print_error</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="n">res_json</span> <span class="o">=</span> <span class="n">res</span>
            <span class="k">if</span> <span class="n">res_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">):</span>
                <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red] An error occurred while running debug_estimateStep, </span><span class="si">{</span><span class="n">res_json</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TX is not dict. tx =&gt; </span><span class="si">{</span><span class="n">_tx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="IconRpcHelper.get_step_limit"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcHelper.get_step_limit">[docs]</a>    <span class="k">def</span> <span class="nf">get_step_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step_kind</span><span class="o">=</span><span class="s2">&quot;apiCall&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tx</span><span class="p">:</span>
            <span class="n">_tx</span> <span class="o">=</span> <span class="n">tx</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_tx</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_payload</span><span class="p">)</span>
        <span class="n">unnecessary_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;stepLimit&quot;</span><span class="p">,</span> <span class="s2">&quot;signature&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">unnecessary_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_tx</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s1">&#39;__NOT_DEFINED__&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;__NOT_DEFINED__&quot;</span><span class="p">:</span>
                <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Remove the unnecessary &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; in payload&quot;</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">_tx</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>

        <span class="n">estimate_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_estimate_step</span><span class="p">(</span><span class="n">tx</span><span class="o">=</span><span class="n">_tx</span><span class="p">)</span>
        <span class="n">_guess_step_kind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_guess_step_kind</span><span class="p">(</span><span class="n">tx</span><span class="o">=</span><span class="n">_tx</span><span class="p">)</span>
        <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;guess step_kind = </span><span class="si">{</span><span class="n">_guess_step_kind</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">step_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_step_cost</span><span class="p">(</span><span class="n">_guess_step_kind</span><span class="p">)</span>
        <span class="n">step_price</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_step_price</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">estimate_step</span> <span class="ow">and</span> <span class="n">step_cost</span><span class="p">:</span>
            <span class="n">step_limit</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">hex_to_number</span><span class="p">(</span><span class="n">estimate_step</span><span class="p">)</span> <span class="o">+</span> <span class="n">hex_to_number</span><span class="p">(</span><span class="n">step_cost</span><span class="p">))</span>
            <span class="n">icx_fee</span> <span class="o">=</span> <span class="n">hex_to_number</span><span class="p">(</span><span class="n">estimate_step</span><span class="p">)</span> <span class="o">*</span> <span class="n">hex_to_number</span><span class="p">(</span><span class="n">step_price</span><span class="p">)</span> <span class="o">/</span> <span class="n">const</span><span class="o">.</span><span class="n">TINT</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fee = </span><span class="si">{</span><span class="n">icx_fee</span><span class="si">}</span><span class="s2"> =&gt; estimate[i](</span><span class="si">{</span><span class="n">hex_to_number</span><span class="p">(</span><span class="n">estimate_step</span><span class="p">,</span><span class="w"> </span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="si">}</span><span class="s2">)[/i] * &quot;</span>
                               <span class="sa">f</span><span class="s2">&quot;step_price[i](</span><span class="si">{</span><span class="n">hex_to_number</span><span class="p">(</span><span class="n">step_price</span><span class="p">,</span><span class="w"> </span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="si">}</span><span class="s2">)[/i]&quot;</span><span class="p">)</span>

            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;step_limit =&gt; </span><span class="si">{</span><span class="n">hex_to_number</span><span class="p">(</span><span class="n">step_limit</span><span class="p">,</span><span class="w"> </span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">step_limit</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;[red]An error occurred while running get_step_limit&quot;</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_guess_step_kind</span><span class="p">(</span><span class="n">tx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">step_kind_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;dataType&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;deploy&quot;</span><span class="p">:</span> <span class="s2">&quot;contractCreate&quot;</span><span class="p">,</span>
                <span class="s2">&quot;call&quot;</span><span class="p">:</span> <span class="s2">&quot;apiCall&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">_default_step_kind</span> <span class="o">=</span> <span class="s2">&quot;get&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_default_step_kind</span>

        <span class="k">for</span> <span class="n">payload_key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">step_kind_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">keys_exists</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">,</span> <span class="n">payload_key</span><span class="p">):</span>
                <span class="n">_data_type</span> <span class="o">=</span> <span class="n">tx</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="n">payload_key</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">step_kind_dict</span><span class="p">[</span><span class="n">payload_key</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_data_type</span><span class="p">,</span> <span class="n">_default_step_kind</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_default_step_kind</span>

<div class="viewcode-block" id="IconRpcHelper.get_fee"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcHelper.get_fee">[docs]</a>    <span class="k">def</span> <span class="nf">get_fee</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">_tx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_tx_var</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">keys_exists</span><span class="p">(</span><span class="n">_tx</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">,</span> <span class="s2">&quot;stepLimit&quot;</span><span class="p">):</span>
            <span class="k">del</span> <span class="n">_tx</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;stepLimit&#39;</span><span class="p">]</span>
        <span class="n">estimate_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_estimate_step</span><span class="p">(</span><span class="n">tx</span><span class="o">=</span><span class="n">_tx</span><span class="p">)</span>
        <span class="n">step_kind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_guess_step_kind</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
        <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_guess_step_kind = </span><span class="si">{</span><span class="n">step_kind</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">step_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_step_cost</span><span class="p">(</span><span class="n">step_kind</span><span class="p">)</span>
        <span class="n">step_price</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_step_price</span><span class="p">()</span>
        <span class="n">step_limit</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">hex_to_number</span><span class="p">(</span><span class="n">estimate_step</span><span class="p">)</span> <span class="o">+</span> <span class="n">hex_to_number</span><span class="p">(</span><span class="n">step_cost</span><span class="p">))</span>

        <span class="n">fee</span> <span class="o">=</span> <span class="n">hex_to_number</span><span class="p">(</span><span class="n">estimate_step</span><span class="p">)</span> <span class="o">*</span> <span class="n">hex_to_number</span><span class="p">(</span><span class="n">step_price</span><span class="p">)</span> <span class="o">/</span> <span class="n">const</span><span class="o">.</span><span class="n">TINT</span>
        <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red] fee = (estimate_step + step_cost) * step_price = </span><span class="si">{</span><span class="n">fee</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red] fee = (</span><span class="si">{</span><span class="n">estimate_step</span><span class="si">}</span><span class="s2"> + </span><span class="si">{</span><span class="n">step_cost</span><span class="si">}</span><span class="s2">) * </span><span class="si">{</span><span class="n">step_price</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">fee</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">symbol</span><span class="p">:</span>
            <span class="n">fee</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fee</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">network_info</span><span class="o">.</span><span class="n">symbol</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="n">fee</span></div>

<div class="viewcode-block" id="IconRpcHelper.get_balance"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcHelper.get_balance">[docs]</a>    <span class="k">def</span> <span class="nf">get_balance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_comma</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">address</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">wallet</span><span class="p">:</span>
            <span class="n">address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wallet</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;address&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_valid_token_address</span><span class="p">(</span><span class="n">address</span><span class="p">):</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_call</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;icx_getBalance&quot;</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="n">address</span><span class="p">},</span>
                <span class="n">store_request_payload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">_balance</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">hex_to_number</span><span class="p">(</span><span class="n">_balance</span><span class="p">,</span> <span class="n">is_comma</span><span class="o">=</span><span class="n">is_comma</span><span class="p">,</span> <span class="n">is_tint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_on_failure</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid token address - </span><span class="si">{</span><span class="n">address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="IconRpcHelper.get_tx"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcHelper.get_tx">[docs]</a>    <span class="k">def</span> <span class="nf">get_tx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tx_hash</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_call</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;icx_getTransactionResult&quot;</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;txHash&quot;</span><span class="p">:</span> <span class="n">tx_hash</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">return_key</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">return_key</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="IconRpcHelper.get_tx_wait"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcHelper.get_tx_wait">[docs]</a>    <span class="k">def</span> <span class="nf">get_tx_wait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tx_hash</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_compact</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tx_hash</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">keys_exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="s1">&#39;txHash&#39;</span><span class="p">):</span>
                <span class="n">tx_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">][</span><span class="s1">&#39;result&#39;</span><span class="p">][</span><span class="s1">&#39;txHash&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">keys_exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="s1">&#39;result&#39;</span><span class="p">):</span>
                <span class="n">tx_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">][</span><span class="s1">&#39;result&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">tx_hash</span><span class="p">:</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red] Not found tx_hash=&#39;</span><span class="si">{</span><span class="n">tx_hash</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">tx_status_result</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Check a transaction by </span><span class="si">{</span><span class="n">tx_hash</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="s2">&quot;[magenta] Wait for transaction to be generated.&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">status</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tx</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">tx_hash</span><span class="o">=</span><span class="n">tx_hash</span><span class="p">)</span>
                <span class="n">exit_loop</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">prefix_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[bold cyan][Wait TX][</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">][/bold cyan] &quot;</span>
                <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">):</span>
                    <span class="n">exit_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">if</span> <span class="s2">&quot;InvalidParams&quot;</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">):</span>
                        <span class="n">exit_loop</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">exit_msg</span> <span class="o">=</span> <span class="s2">&quot;[red][FAIL][/red]&quot;</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix_text</span><span class="si">}{</span><span class="n">exit_msg</span><span class="si">}</span><span class="s2">[white] </span><span class="si">{</span><span class="n">resp</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

                <span class="k">elif</span> <span class="n">resp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;logsBloom&#39;</span><span class="p">):</span>
                        <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">][</span><span class="s1">&#39;logsBloom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">resp</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">][</span><span class="s1">&#39;logsBloom&#39;</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;failure&#39;</span><span class="p">):</span>
                        <span class="n">_resp_status</span> <span class="o">=</span> <span class="s2">&quot;[FAIL]&quot;</span>
                        <span class="n">tx_status_result</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">_resp_status</span> <span class="o">=</span> <span class="s2">&quot;[OK]&quot;</span>

                    <span class="n">exit_loop</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix_text</span><span class="si">}</span><span class="s2">[red]</span><span class="si">{</span><span class="n">_resp_status</span><span class="si">}</span><span class="s2">[/red] </span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">resp</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">resp</span>
                <span class="n">status</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="n">status</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;[bold red]</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">spinner_style</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">exit_loop</span><span class="p">:</span>
                    <span class="n">final_result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[bold green][white] </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="k">if</span> <span class="n">is_compact</span><span class="p">:</span>
                        <span class="n">final_result</span> <span class="o">=</span> <span class="n">shorten_text</span><span class="p">(</span><span class="n">final_result</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>

                    <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">final_result</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">tx_status_result</span> <span class="ow">and</span> <span class="n">tx_hash</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_debug_trace</span><span class="p">(</span><span class="n">tx_hash</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span></div>

<div class="viewcode-block" id="IconRpcHelper.get_debug_trace"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcHelper.get_debug_trace">[docs]</a>    <span class="k">def</span> <span class="nf">get_debug_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tx_hash</span><span class="p">,</span> <span class="n">print_table</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_call</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug_url</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;debug_getTrace&quot;</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;txHash&quot;</span><span class="p">:</span> <span class="n">tx_hash</span><span class="p">},</span>
            <span class="n">store_request_payload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">keys_exists</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">print_table</span><span class="p">:</span>
            <span class="n">PrintRichTable</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;debug_getTrace=</span><span class="si">{</span><span class="n">tx_hash</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">][</span><span class="s1">&#39;logs&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span></div>

<div class="viewcode-block" id="IconRpcHelper.parse_tx_var"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcHelper.parse_tx_var">[docs]</a>    <span class="k">def</span> <span class="nf">parse_tx_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tx</span><span class="p">:</span>
            <span class="n">_tx</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_use_global_reqeust_payload</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_tx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_payload</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_use_global_reqeust_payload</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red]_use_global_reqeust_payload=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_use_global_reqeust_payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_tx</span></div>

    <span class="k">def</span> <span class="nf">_force_fill_from_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">_tx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_tx_var</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_tx</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;tx is not dict, tx=</span><span class="si">{</span><span class="n">tx</span><span class="si">}</span><span class="s2">, _tx=</span><span class="si">{</span><span class="n">_tx</span><span class="si">}</span><span class="s2">, request_payload = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">request_payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wallet</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">wallet</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;address&#39;</span><span class="p">):</span>
            <span class="n">_tx</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;from&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wallet</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;address&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exit_on_failure</span><span class="p">(</span><span class="n">exception</span><span class="o">=</span><span class="s2">&quot;Not found &#39;from address&#39;. Not defined wallet&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_tx</span>

<div class="viewcode-block" id="IconRpcHelper.auto_fill_parameter"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcHelper.auto_fill_parameter">[docs]</a>    <span class="k">def</span> <span class="nf">auto_fill_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_force_from_addr</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">_tx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_tx_var</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_tx</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_tx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;params&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_tx</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_force_from_addr</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_force_fill_from_address</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_tx</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nonce&#39;</span><span class="p">):</span>
                <span class="n">_tx</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;nonce&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0x1&quot;</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">_tx</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;version&#39;</span><span class="p">):</span>
                <span class="n">_tx</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0x3&quot;</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">_tx</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">):</span>
                <span class="n">_tx</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">icx_signer</span><span class="o">.</span><span class="n">get_timestamp_us</span><span class="p">())</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">_tx</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nid&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_info</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_info</span><span class="o">.</span><span class="n">nid</span><span class="p">:</span>
                <span class="n">_tx</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;nid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_info</span><span class="o">.</span><span class="n">nid</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exit_on_failure</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid payload =&gt; </span><span class="si">{</span><span class="n">_tx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_global_reqeust_payload</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">request_payload</span> <span class="o">=</span> <span class="n">_tx</span>
        <span class="k">return</span> <span class="n">_tx</span></div>

<div class="viewcode-block" id="IconRpcHelper.auto_fill_step_limit"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcHelper.auto_fill_step_limit">[docs]</a>    <span class="k">def</span> <span class="nf">auto_fill_step_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">_tx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_tx_var</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_tx</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_tx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;params&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_tx</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stepLimit&#39;</span><span class="p">):</span>
                <span class="n">_tx</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;stepLimit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_step_limit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exit_on_failure</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid payload =&gt; </span><span class="si">{</span><span class="n">_tx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="IconRpcHelper.sign_tx"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcHelper.sign_tx">[docs]</a>    <span class="k">def</span> <span class="nf">sign_tx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wallet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_balance</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_payload</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signed_tx</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">wallet</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wallet</span> <span class="o">=</span> <span class="n">wallet</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">wallet</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wallet</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exit_on_failure</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red] Not defined wallet =&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wallet</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">request_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_valid_payload_format</span><span class="p">(</span><span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="n">private_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wallet</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;private_key&#39;</span><span class="p">)</span>
        <span class="n">address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wallet</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;address&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_balance</span><span class="p">:</span>
            <span class="n">_balance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_balance</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_info</span><span class="p">:</span>
                <span class="n">symbol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_info</span><span class="o">.</span><span class="n">symbol</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">symbol</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="n">address</span><span class="si">}</span><span class="s2">&gt;&#39;s Balance = </span><span class="si">{</span><span class="n">_balance</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">_balance</span> <span class="ow">or</span> <span class="n">_balance</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_on_failure</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Insufficient Balance = </span><span class="si">{</span><span class="n">_balance</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_fill_parameter</span><span class="p">(</span><span class="n">is_force_from_addr</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_fill_step_limit</span><span class="p">()</span>

        <span class="n">singer</span> <span class="o">=</span> <span class="n">icx_signer</span><span class="o">.</span><span class="n">IcxSigner</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">private_key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signed_tx</span> <span class="o">=</span> <span class="n">singer</span><span class="o">.</span><span class="n">sign_tx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_payload</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">address</span> <span class="o">!=</span> <span class="n">singer</span><span class="o">.</span><span class="n">get_hx_address</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invalid address </span><span class="si">{</span><span class="n">address</span><span class="si">}</span><span class="s1"> != </span><span class="si">{</span><span class="n">singer</span><span class="o">.</span><span class="n">get_hx_address</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">signed_tx</span></div>

<div class="viewcode-block" id="IconRpcHelper.exit_on_failure"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcHelper.exit_on_failure">[docs]</a>    <span class="k">def</span> <span class="nf">exit_on_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_error</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raise_on_failure</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoTraceBackException</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red][FAIL][/red] Stopped </span><span class="si">{</span><span class="n">get_debug_here_info</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;function_name&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">(), </span><span class="si">{</span><span class="n">exception</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">exception</span></div>

<div class="viewcode-block" id="IconRpcHelper.sign_send"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.IconRpcHelper.sign_send">[docs]</a>    <span class="k">def</span> <span class="nf">sign_send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_wait</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">is_compact</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signed_tx</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_call</span><span class="p">(</span><span class="n">payload</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signed_tx</span><span class="p">,</span> <span class="n">print_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_wait</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">response</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">):</span>
                <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tx_wait</span><span class="p">(</span><span class="n">tx_hash</span><span class="o">=</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">],</span> <span class="n">is_compact</span><span class="o">=</span><span class="n">is_compact</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">resp</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exit_on_failure</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required signed transaction&quot;</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_tx_result</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="c1"># print(result)</span>
            <span class="n">response_json</span> <span class="o">=</span> <span class="n">result</span>
            <span class="k">if</span> <span class="n">response_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">response_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="n">response_json</span></div>


<div class="viewcode-block" id="JsonRequest"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.JsonRequest">[docs]</a><span class="k">class</span> <span class="nc">JsonRequest</span><span class="p">:</span>
<div class="viewcode-block" id="JsonRequest.__init__"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.JsonRequest.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO: It will be generated the JSON or JSON-RPC request</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="disable_ssl_warnings"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.disable_ssl_warnings">[docs]</a><span class="k">def</span> <span class="nf">disable_ssl_warnings</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">urllib3.exceptions</span> <span class="kn">import</span> <span class="n">InsecureRequestWarning</span>
    <span class="n">requests</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">urllib3</span><span class="o">.</span><span class="n">disable_warnings</span><span class="p">(</span><span class="n">InsecureRequestWarning</span><span class="p">)</span></div>


<div class="viewcode-block" id="append_http"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.append_http">[docs]</a><span class="k">def</span> <span class="nf">append_http</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Add http:// if it doesn&#39;t exist in the URL</span>

<span class="sd">    :param url:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="s2">&quot;http://&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">url</span> <span class="ow">and</span> <span class="s2">&quot;https://&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;http://</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">url</span></div>


<div class="viewcode-block" id="append_ws"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.append_ws">[docs]</a><span class="k">def</span> <span class="nf">append_ws</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Add ws:// if it doesn&#39;t exist in the URL</span>

<span class="sd">    :param url:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;https://&quot;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;https://&quot;</span><span class="p">,</span> <span class="s2">&quot;wss://&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;http://&quot;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;http://&quot;</span><span class="p">,</span> <span class="s2">&quot;ws://&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;ws://&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">url</span> <span class="ow">and</span> <span class="s2">&quot;wss://&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ws://</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">url</span></div>


<div class="viewcode-block" id="append_api_v3"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.append_api_v3">[docs]</a><span class="k">def</span> <span class="nf">append_api_v3</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">if</span> <span class="s2">&quot;/api/v3&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">/api/v3&quot;</span>
    <span class="k">return</span> <span class="n">append_http</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></div>


<div class="viewcode-block" id="remove_http"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.remove_http">[docs]</a><span class="k">def</span> <span class="nf">remove_http</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove the r&#39;https?://&#39; string</span>

<span class="sd">    :param url:</span>
<span class="sd">    :return:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;https?://&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_operator_truth"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.get_operator_truth">[docs]</a><span class="k">def</span> <span class="nf">get_operator_truth</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">relate</span><span class="p">,</span> <span class="n">cut</span><span class="p">):</span>
    <span class="n">ops</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span> <span class="n">_operator</span><span class="o">.</span><span class="n">gt</span><span class="p">,</span>
        <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span> <span class="n">_operator</span><span class="o">.</span><span class="n">lt</span><span class="p">,</span>
        <span class="s1">&#39;&gt;=&#39;</span><span class="p">:</span> <span class="n">_operator</span><span class="o">.</span><span class="n">ge</span><span class="p">,</span>
        <span class="s1">&#39;&lt;=&#39;</span><span class="p">:</span> <span class="n">_operator</span><span class="o">.</span><span class="n">le</span><span class="p">,</span>
        <span class="s1">&#39;==&#39;</span><span class="p">:</span> <span class="n">_operator</span><span class="o">.</span><span class="n">eq</span><span class="p">,</span>
        <span class="s1">&#39;!=&#39;</span><span class="p">:</span> <span class="n">_operator</span><span class="o">.</span><span class="n">ne</span><span class="p">,</span>
        <span class="s1">&#39;include&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">y</span><span class="p">,</span>
        <span class="s1">&#39;exclude&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">y</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ops</span><span class="p">[</span><span class="n">relate</span><span class="p">](</span><span class="n">inp</span><span class="p">,</span> <span class="n">cut</span><span class="p">)</span></div>


<div class="viewcode-block" id="guess_key"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.guess_key">[docs]</a><span class="k">def</span> <span class="nf">guess_key</span><span class="p">(</span><span class="n">find_key</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">guessed_result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">find_key</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
                <span class="n">guessed_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">find_key</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
                <span class="n">guessed_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">guessed_result</span></div>


<div class="viewcode-block" id="SuccessCriteria"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.SuccessCriteria">[docs]</a><span class="k">class</span> <span class="nc">SuccessCriteria</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">target</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">operator</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;!=&quot;</span><span class="p">,</span> <span class="s2">&quot;==&quot;</span><span class="p">,</span> <span class="s2">&quot;&gt;=&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;=&quot;</span><span class="p">,</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="s2">&quot;include&quot;</span><span class="p">,</span> <span class="s2">&quot;exclude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">expected</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="c1"># operator: Literal[tuple(ALLOW_OPERATOR)] = &quot;&quot;</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">target</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operator</span> <span class="o">=</span> <span class="n">operator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected</span> <span class="o">=</span> <span class="n">expected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expected</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_string_valid_type</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">get_operator_truth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected</span><span class="p">)</span>
                <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;get_operator_truth(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">expected</span><span class="si">}</span><span class="s2">) = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_set_string_valid_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">):</span>
        <span class="n">_debug_message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="s2">&quot;expected&quot;</span><span class="p">]:</span>
            <span class="n">_attr_value_in_class</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">,</span> <span class="s2">&quot;__NOT_NONE__&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_attr_value_in_class</span> <span class="o">!=</span> <span class="s2">&quot;__NOT_NONE__&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_attr_value_in_class</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">is_int</span><span class="p">(</span><span class="n">_attr_value_in_class</span><span class="p">):</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">_attr_value_in_class</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">is_float</span><span class="p">(</span><span class="n">_attr_value_in_class</span><span class="p">):</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">_attr_value_in_class</span><span class="p">))</span>

                <span class="n">_modified_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">)</span>
                <span class="n">_debug_message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">_modified_value</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">_modified_value</span><span class="p">)</span><span class="si">}</span><span class="s2">) , &quot;</span>

        <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">_debug_message</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;SuccessCriteria </span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;SuccessCriteria </span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>

<div class="viewcode-block" id="SuccessCriteria.to_dict"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.SuccessCriteria.to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span></div></div>


<div class="viewcode-block" id="SuccessResponse"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.SuccessResponse">[docs]</a><span class="k">class</span> <span class="nc">SuccessResponse</span><span class="p">(</span><span class="n">SuccessCriteria</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">target_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">operator</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;!=&quot;</span><span class="p">,</span> <span class="s2">&quot;==&quot;</span><span class="p">,</span> <span class="s2">&quot;&gt;=&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;=&quot;</span><span class="p">,</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="s2">&quot;include&quot;</span><span class="p">,</span> <span class="s2">&quot;exclude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">expected</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">target</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="p">):</span>
        <span class="c1"># if not target or not operator or not expected or target_key:</span>
        <span class="c1">#     raise ValueError(f&quot;target: {target}, operator: {operator}, expected: {expected}, target_key: {target_key} &quot;)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red]&lt;Error&gt;[/red] &#39;</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">&#39; is not dict&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;target is not dict - &#39;</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">target_key</span> <span class="o">=</span> <span class="n">target_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">FlatDict</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

        <span class="n">_selected_flatten_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_key</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">_selected_flatten_target</span><span class="p">,</span> <span class="n">operator</span><span class="o">=</span><span class="n">operator</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="n">expected</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">_selected_flatten_target</span><span class="p">:</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red]&lt;Error&gt;[/red] &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_key</span><span class="si">}</span><span class="s2">&#39; is not attribute in </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;[red]&lt;Error&gt;[/red] &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_key</span><span class="si">}</span><span class="s2">&#39; not found. </span><span class="se">\n</span><span class="s2"> Did you mean </span><span class="si">{</span><span class="n">guess_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_key</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2"> ?&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="CallHttp"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.CallHttp">[docs]</a><span class="k">class</span> <span class="nc">CallHttp</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;patch&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;get&quot;</span><span class="p">,</span>
                 <span class="c1"># method: Literal[AllowsHttpMethod.get] = &quot;get&quot;,</span>
                 <span class="c1"># method: AllowsHttpMethod = AllowsHttpMethod.get,</span>
                 <span class="c1"># method: Literal[tuple(method for method in AllowsHttpMethod)],</span>
                 <span class="n">payload</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">timeout</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span>
                 <span class="n">ignore_ssl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                 <span class="n">success_criteria</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;__DEFAULT__&quot;</span><span class="p">,</span>
                 <span class="n">success_operator</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;and&quot;</span><span class="p">,</span> <span class="s2">&quot;or&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;and&quot;</span><span class="p">,</span>
                 <span class="n">success_syntax</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;operator&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;auto&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
                 <span class="n">raise_on_failure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">auto_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span>
                 <span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span> <span class="o">/</span> <span class="mi">1000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_ssl</span> <span class="o">=</span> <span class="n">ignore_ssl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

        <span class="n">_default_criteria</span> <span class="o">=</span> <span class="p">[</span><span class="n">AllowsKey</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="s2">&quot;&lt;=&quot;</span><span class="p">,</span> <span class="mi">399</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">success_criteria</span> <span class="o">==</span> <span class="s1">&#39;__DEFAULT__&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">success_criteria</span> <span class="o">=</span> <span class="n">_default_criteria</span>
        <span class="k">elif</span> <span class="n">success_criteria</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">success_criteria</span> <span class="o">=</span> <span class="n">success_criteria</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">success_criteria</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">success_operator</span> <span class="o">=</span> <span class="n">success_operator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">success_syntax</span> <span class="o">=</span> <span class="n">success_syntax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raise_on_failure</span> <span class="o">=</span> <span class="n">raise_on_failure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_UA</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;CallHttp Agent/</span><span class="si">{</span><span class="n">pawn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PAWN_VERSION&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_error</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># self.response = requests.models.Response()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flat_response</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_success_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_success_criteria</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timing</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># self.run()</span>

    <span class="k">def</span> <span class="nf">_shorten_exception_message_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
        <span class="n">_shorten_message_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Timeout Error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;params_message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;timeout=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">},</span>
            <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">:</span> <span class="s2">&quot;HTTP Error&quot;</span><span class="p">,</span>
            <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">:</span> <span class="s2">&quot;DNS lookup Error&quot;</span><span class="p">,</span>
            <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span><span class="p">:</span> <span class="s2">&quot;OOps: Something Else&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">_shorten_message</span> <span class="o">=</span> <span class="n">_shorten_message_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
        <span class="n">default_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(url=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2"> method=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># connection_pool = exception.__context__.pool</span>
        <span class="c1"># hostname = connection_pool.host</span>
        <span class="c1"># port = connection_pool.port</span>

        <span class="k">for</span> <span class="n">req_exception</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">_shorten_message_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exception</span><span class="p">,</span> <span class="n">req_exception</span><span class="p">):</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">):</span>
                    <span class="n">_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
                    <span class="n">_params_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;params_message&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="n">values</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
                    <span class="n">_params_message</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_message</span><span class="si">}{</span><span class="n">default_msg</span><span class="si">}{</span><span class="n">_params_message</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;Unknown Error&gt;</span><span class="si">{</span><span class="n">default_msg</span><span class="si">}</span><span class="s2">)&quot;</span>

<div class="viewcode-block" id="CallHttp.exit_on_failure"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.CallHttp.exit_on_failure">[docs]</a>    <span class="k">def</span> <span class="nf">exit_on_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_error</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">999</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_shorten_exception_message_handler</span><span class="p">(</span><span class="n">exception</span><span class="p">),</span> <span class="n">elapsed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timing</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raise_on_failure</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoTraceBackException</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red][FAIL][/red] </span><span class="si">{</span><span class="n">exception</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># self.response.status_code = 999</span>
            <span class="c1"># self.response.success = False</span>
            <span class="c1"># self.response.error = self._shorten_exception_message_handler(exception)</span>
            <span class="c1"># print(self.timing)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span></div>

<div class="viewcode-block" id="CallHttp.run"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.CallHttp.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prepare</span><span class="p">()</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fetch_response</span><span class="p">()</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timing</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_response</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fetch_criteria</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_success</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_success</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;reason&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="k">def</span> <span class="nf">_prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">append_http</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>

<div class="viewcode-block" id="CallHttp.get_response"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.CallHttp.get_response">[docs]</a>    <span class="k">def</span> <span class="nf">get_response</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HttpResponse</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span></div>

<div class="viewcode-block" id="CallHttp.fetch_response"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.CallHttp.fetch_response">[docs]</a>    <span class="k">def</span> <span class="nf">fetch_response</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="p">(</span><span class="n">json_response</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">http_version</span><span class="p">,</span> <span class="n">r_headers</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="o">=</span> <span class="p">({},</span> <span class="p">{},</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;patch&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">):</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unsupported method=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="si">}</span><span class="s2">&#39;, url=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">&#39; &quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span> <span class="k">else</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_on_failure</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported method=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="si">}</span><span class="s2">, url=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_payload_string</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">payload</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">_payload_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">payload</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[TRY] url=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">, method=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">, payload=</span><span class="si">{</span><span class="n">_payload_string</span><span class="si">}</span><span class="s2">, kwargs=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">requests</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;get&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">payload</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_on_failure</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_parse_response</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">timing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_elapsed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">elapsed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing</span><span class="p">:</span>
                <span class="n">_elapsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_elapsed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">=</span> <span class="n">_elapsed</span>

        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">http_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">raw</span><span class="o">.</span><span class="n">version</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">http_version</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_error</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">text</span>

<div class="viewcode-block" id="CallHttp.fetch_criteria"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.CallHttp.fetch_criteria">[docs]</a>    <span class="k">def</span> <span class="nf">fetch_criteria</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">success_criteria</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">success_operator</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;and&quot;</span><span class="p">,</span> <span class="s2">&quot;or&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;and&quot;</span><span class="p">,</span>
                       <span class="p">):</span>
        <span class="n">_response_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">success_criteria</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">success_criteria</span> <span class="o">=</span> <span class="n">success_criteria</span>
        <span class="k">if</span> <span class="n">success_operator</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">success_operator</span> <span class="o">=</span> <span class="n">success_operator</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_criteria</span><span class="p">:</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;passing success_criteria&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_syntax</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_syntax</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
                <span class="n">_check_syntax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_criteria_syntax</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">_check_syntax</span><span class="p">:</span>
                    <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[blue]Try to convert[/blue] </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">success_criteria</span><span class="p">)</span><span class="si">}</span><span class="s2">, _check_criteria_syntax=</span><span class="si">{</span><span class="n">_check_syntax</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_recursive_convert_criteria</span><span class="p">()</span>

            <span class="n">depth</span> <span class="o">=</span> <span class="n">list_depth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">success_criteria</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">success_criteria</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">success_criteria</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">criteria</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_criteria</span><span class="p">:</span>
                <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Compare Criteria =&gt; </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">criteria</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">criteria</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">_criteria</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span>
                    <span class="n">_criteria</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_response_dict</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_success_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SuccessResponse</span><span class="p">(</span><span class="o">*</span><span class="n">_criteria</span><span class="p">))</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">criteria</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">criteria</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_response_dict</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_success_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SuccessResponse</span><span class="p">(</span><span class="o">**</span><span class="n">criteria</span><span class="p">))</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_success_results</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_find_operator</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">operator</span> <span class="ow">in</span> <span class="n">ALLOW_OPERATOR</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">operator</span> <span class="ow">in</span> <span class="n">string</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_check_criteria_syntax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">criteria</span><span class="p">:</span>
            <span class="n">criteria</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_criteria</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">criteria</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_operator</span><span class="p">(</span><span class="n">criteria</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">criteria</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="n">criteria</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_criteria_syntax</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_recursive_convert_criteria</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string_criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">string_criteria</span><span class="p">:</span>
            <span class="n">string_criteria</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_criteria</span>

        <span class="k">if</span> <span class="n">string_criteria</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string_criteria</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">success_criteria</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_criteria</span><span class="p">(</span><span class="n">string_criteria</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_criteria</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">success_criteria</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">string_criteria_in_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">string_criteria</span> <span class="ow">in</span> <span class="n">string_criteria</span><span class="p">:</span>
                <span class="n">converted_criteria</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recursive_convert_criteria</span><span class="p">(</span><span class="n">string_criteria</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">converted_criteria</span><span class="p">:</span>
                    <span class="n">string_criteria_in_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">converted_criteria</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">string_criteria_in_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">success_criteria</span> <span class="o">=</span> <span class="n">string_criteria_in_list</span>

    <span class="k">def</span> <span class="nf">_convert_criteria</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">operator</span> <span class="ow">in</span> <span class="n">ALLOW_OPERATOR</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">operator</span> <span class="ow">in</span> <span class="n">argument</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">argument</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">operator</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">ALLOW_OPERATOR</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;=&#39;</span><span class="p">]):</span>
                    <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red]Invalid operator - &#39;</span><span class="si">{</span><span class="n">argument</span><span class="si">}</span><span class="s2">&#39;, </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid operator - &#39;</span><span class="si">{</span><span class="n">argument</span><span class="si">}</span><span class="s2">&#39;, </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">operator</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">result</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_convert_list_criteria</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">argument</span> <span class="ow">in</span> <span class="n">arguments</span><span class="p">:</span>
            <span class="n">criteria</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_criteria</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">criteria</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="CallHttp.is_success"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.CallHttp.is_success">[docs]</a>    <span class="k">def</span> <span class="nf">is_success</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">expected_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_success_results</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_success_results</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">_result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_success_results</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_result</span><span class="o">.</span><span class="n">result</span><span class="p">:</span>
                    <span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_operator</span> <span class="o">==</span> <span class="s2">&quot;and&quot;</span> <span class="ow">and</span> <span class="n">success_count</span> <span class="o">==</span> <span class="n">expected_count</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_operator</span> <span class="o">==</span> <span class="s2">&quot;or&quot;</span> <span class="ow">and</span> <span class="n">success_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div></div>


<div class="viewcode-block" id="CheckSSL"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.CheckSSL">[docs]</a><span class="k">class</span> <span class="nc">CheckSSL</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">443</span><span class="p">,</span> <span class="n">raw_data</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssl_info</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="n">raw_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssl_dateformat</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;%b </span><span class="si">%d</span><span class="s1"> %H:%M:%S %Y %Z&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_ssl</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssl_result</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="CheckSSL.get_ssl"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.CheckSSL.get_ssl">[docs]</a>    <span class="k">def</span> <span class="nf">get_ssl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">()</span>
        <span class="n">context</span><span class="o">.</span><span class="n">check_hostname</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">conn</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">wrap_socket</span><span class="p">(</span>
            <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">),</span>
            <span class="n">server_hostname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_host</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span><span class="p">)</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_port</span><span class="p">))</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">do_handshake</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssl_info</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">getpeercert</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_ssl_info</span><span class="p">()</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssl_info</span></div>

    <span class="k">def</span> <span class="nf">_parse_ssl_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">expire_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssl_expiry_datetime</span><span class="p">()</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">expire_date</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calculated_date</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;expire_date&quot;</span><span class="p">:</span> <span class="n">expire_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span>
            <span class="s2">&quot;left_days&quot;</span><span class="p">:</span> <span class="n">diff</span><span class="o">.</span><span class="n">days</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssl_info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_calculated_date</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">:</span>
            <span class="n">_tmp_ssl_info</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">_to_dict_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">,</span> <span class="s2">&quot;issuer&quot;</span><span class="p">]</span>
            <span class="n">_to_list_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;subjectAltName&quot;</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssl_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">_to_dict_keys</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ssl_info</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tuple_to_dict</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">_to_list_keys</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;key=</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">, value=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ssl_info</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tuple_to_list</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_tuple_to_dict</span><span class="p">(</span><span class="n">_tuple</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">_tmp_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_tuple</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">_data</span> <span class="ow">in</span> <span class="n">_tuple</span><span class="p">:</span>
                <span class="n">_tmp_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_tmp_dict</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_tuple_to_list</span><span class="p">(</span><span class="n">_tuple</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">_tmp_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_tuple</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">_data</span> <span class="ow">in</span> <span class="n">_tuple</span><span class="p">:</span>
                <span class="n">_key</span> <span class="o">=</span> <span class="n">_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">_domain</span> <span class="o">=</span> <span class="n">_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red] _tuple_to_list =</span><span class="si">{</span><span class="n">_key</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">_domain</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">_tmp_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_key</span><span class="p">):</span>
                    <span class="n">_tmp_dict</span><span class="p">[</span><span class="n">_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">_tmp_dict</span><span class="p">[</span><span class="n">_key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_domain</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_tmp_dict</span>

<div class="viewcode-block" id="CheckSSL.ssl_expiry_datetime"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.CheckSSL.ssl_expiry_datetime">[docs]</a>    <span class="k">def</span> <span class="nf">ssl_expiry_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ssl_info</span><span class="p">[</span><span class="s1">&#39;notAfter&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssl_dateformat</span><span class="p">)</span></div>

<div class="viewcode-block" id="CheckSSL.analyze_ssl"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.CheckSSL.analyze_ssl">[docs]</a>    <span class="k">def</span> <span class="nf">analyze_ssl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">api_url</span> <span class="o">=</span> <span class="s1">&#39;https://api.ssllabs.com/api/v3/&#39;</span>
        <span class="n">_do_function</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">jequest</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_url</span><span class="si">}</span><span class="s2">/analyze?host=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_host</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">WaitStateLoop</span><span class="p">(</span>
            <span class="n">loop_function</span><span class="o">=</span><span class="n">_do_function</span><span class="p">,</span>
            <span class="n">exit_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_check_ssl_result</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_check_ssl_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;READY&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ssl_result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">]</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ssl_result</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="CallWebsocket"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.CallWebsocket">[docs]</a><span class="k">class</span> <span class="nc">CallWebsocket</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">connect_url</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">send_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">recv_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">use_status_console</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_url</span> <span class="o">=</span> <span class="n">connect_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_callback</span> <span class="o">=</span> <span class="n">send_callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recv_callback</span> <span class="o">=</span> <span class="n">recv_callback</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ws_url</span> <span class="o">=</span> <span class="n">append_ws</span><span class="p">(</span><span class="n">connect_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">http_url</span> <span class="o">=</span> <span class="n">append_http</span><span class="p">(</span><span class="n">connect_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_console</span> <span class="o">=</span> <span class="n">Null</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_status_console</span> <span class="o">=</span> <span class="n">use_status_console</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ws</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">enableTrace</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<div class="viewcode-block" id="CallWebsocket.connect_websocket"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.CallWebsocket.connect_websocket">[docs]</a>    <span class="k">def</span> <span class="nf">connect_websocket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_url</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ws</span> <span class="o">=</span> <span class="n">create_connection</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ws_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">api_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span> <span class="n">sslopt</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cert_reqs&quot;</span><span class="p">:</span> <span class="n">ssl</span><span class="o">.</span><span class="n">CERT_NONE</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ws</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CallWebsocket.run"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.CallWebsocket.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_url</span><span class="o">=</span><span class="s2">&quot;api/v3/icon_dex/block&quot;</span><span class="p">,</span> <span class="n">status_console</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_websocket</span><span class="p">(</span><span class="n">api_url</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_status_console</span> <span class="ow">or</span> <span class="n">status_console</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="s2">&quot;Call WebSocket&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_console</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_recv_callback</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_recv_callback</span><span class="p">()</span></div>

<div class="viewcode-block" id="CallWebsocket.send_recv_callback"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.CallWebsocket.send_recv_callback">[docs]</a>    <span class="k">def</span> <span class="nf">send_recv_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">send_callback</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">send_callback</span><span class="p">())</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ws</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recv_callback</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">recv_callback</span><span class="p">(</span><span class="n">response</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="GoloopWebsocket"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.GoloopWebsocket">[docs]</a><span class="k">class</span> <span class="nc">GoloopWebsocket</span><span class="p">(</span><span class="n">CallWebsocket</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">connect_url</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                 <span class="n">blockheight</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">sec_thresholds</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                 <span class="n">monitoring_target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">ignore_ssl</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect_url</span> <span class="o">=</span> <span class="n">connect_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blockheight</span> <span class="o">=</span> <span class="n">blockheight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sec_thresholds</span> <span class="o">=</span> <span class="n">sec_thresholds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_target</span> <span class="o">=</span> <span class="n">monitoring_target</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_target</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;block&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">compare_diff_time</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delay_cnt</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">block_timestamp_prev</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block_timestamp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tx_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tx_timestamp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tx_timestamp_dt</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">blockheight_now</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">ignore_ssl</span><span class="p">:</span>
            <span class="n">disable_ssl_warnings</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">use_status_console</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">use_status_console</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">connect_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">connect_url</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span>
            <span class="n">send_callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_blockheight_callback</span><span class="p">,</span>
            <span class="n">recv_callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_blockheight</span><span class="p">,</span>
            <span class="n">use_status_console</span><span class="o">=</span><span class="n">use_status_console</span>
        <span class="p">)</span>

<div class="viewcode-block" id="GoloopWebsocket.request_blockheight_callback"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.GoloopWebsocket.request_blockheight_callback">[docs]</a>    <span class="k">def</span> <span class="nf">request_blockheight_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">blockheight</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blockheight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_last_blockheight</span><span class="p">()</span>
        <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Call request_blockheight_callback - blockheight: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">blockheight</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">send_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blockheight</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">send_data</span><span class="p">)</span></div>

<div class="viewcode-block" id="GoloopWebsocket.parse_blockheight"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.GoloopWebsocket.parse_blockheight">[docs]</a>    <span class="k">def</span> <span class="nf">parse_blockheight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">response_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compare_diff_time</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">response_json</span> <span class="ow">and</span> <span class="n">response_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hash&#39;</span><span class="p">):</span>
            <span class="n">hash_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_block_hash</span><span class="p">(</span><span class="n">response_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hash&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blockheight_now</span> <span class="o">=</span> <span class="n">hash_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">)</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">LAST_EXECUTE_POINT</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">blockheight_now</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block_timestamp</span> <span class="o">=</span> <span class="n">hash_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;time_stamp&quot;</span><span class="p">)</span>

            <span class="n">_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[bold][📦 </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">blockheight_now</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">][/bold] 📅 </span><span class="si">{</span><span class="n">date_utils</span><span class="o">.</span><span class="n">timestamp_to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_timestamp</span><span class="p">)</span><span class="si">}</span><span class="s2">, tx_hash: </span><span class="si">{</span><span class="n">hash_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;block_hash&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">_message</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_console</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_message</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_timestamp_prev</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">compare_diff_time</span><span class="p">[</span><span class="s1">&#39;block&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_timestamp_prev</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_timestamp</span><span class="p">)</span>

            <span class="n">tx_list</span> <span class="o">=</span> <span class="n">hash_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;confirmed_transaction_list&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tx_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tx_list</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">tx</span> <span class="ow">in</span> <span class="n">tx_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tx_timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="s2">&quot;0x0&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># 16진수, timestamp가 string이여야한다.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx_timestamp</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">compare_diff_time</span><span class="p">[</span><span class="s1">&#39;tx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_timestamp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx_timestamp</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_target</span><span class="p">:</span>
                    <span class="n">diff_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare_diff_time</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1_000_000</span>
                    <span class="k">if</span> <span class="n">diff_time</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">diff_time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sec_thresholds</span><span class="p">:</span>
                        <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">target</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">:</span><span class="s2">^5</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_format</span><span class="p">(</span><span class="n">key_string</span><span class="o">=</span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="n">diff_time</span><span class="o">=</span><span class="n">diff_time</span><span class="p">,</span><span class="w"> </span><span class="n">is_string</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">dump</span><span class="p">(</span><span class="n">hash_result</span><span class="p">[</span><span class="s1">&#39;confirmed_transaction_list&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block_timestamp_prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_timestamp</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">response_json</span><span class="p">)</span></div>

<div class="viewcode-block" id="GoloopWebsocket.output_format"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.GoloopWebsocket.output_format">[docs]</a>    <span class="k">def</span> <span class="nf">output_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_string</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">diff_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">is_string</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delay_cnt</span><span class="p">[</span><span class="n">key_string</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay_cnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key_string</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">blockheight_date</span> <span class="o">=</span> <span class="n">date_utils</span><span class="o">.</span><span class="n">timestamp_to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_timestamp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key_string</span> <span class="o">==</span> <span class="s2">&quot;block&quot;</span><span class="p">:</span>
            <span class="n">diff_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;BH_time(now): </span><span class="si">{</span><span class="n">blockheight_date</span><span class="si">}</span><span class="s2">, &quot;</span> \
                           <span class="sa">f</span><span class="s2">&quot;BH_time(prev): </span><span class="si">{</span><span class="n">date_utils</span><span class="o">.</span><span class="n">timestamp_to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_timestamp_prev</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">diff_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;BH_time: </span><span class="si">{</span><span class="n">blockheight_date</span><span class="si">}</span><span class="s2">, TX_time: </span><span class="si">{</span><span class="n">date_utils</span><span class="o">.</span><span class="n">timestamp_to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tx_timestamp</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">delay_cnt</span><span class="p">[</span><span class="n">key_string</span><span class="p">]</span><span class="si">}</span><span class="s2">&gt; [</span><span class="si">{</span><span class="n">key_string</span><span class="si">}</span><span class="s2"> Delay][</span><span class="si">{</span><span class="n">date_utils</span><span class="o">.</span><span class="n">second_to_dayhhmm</span><span class="p">(</span><span class="n">diff_time</span><span class="p">)</span><span class="si">}</span><span class="s2">] &quot;</span><span class="p">,</span>
                  <span class="sa">f</span><span class="s2">&quot;BH: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">blockheight_now</span><span class="si">}</span><span class="s2">, &quot;</span>
                  <span class="c1"># f&quot;diff: {date_utils.second_to_dayhhmm(diff_time)}, &quot;</span>
                  <span class="sa">f</span><span class="s2">&quot;TX_CNT:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tx_count</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">diff_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_string</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="GoloopWebsocket.get_last_blockheight"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.GoloopWebsocket.get_last_blockheight">[docs]</a>    <span class="k">def</span> <span class="nf">get_last_blockheight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">jequest</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">http_url</span><span class="si">}</span><span class="s2">/api/v3&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">generate_json_rpc</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;icx_getLastBlock&quot;</span><span class="p">))</span>
        <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">][</span><span class="s1">&#39;result&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="GoloopWebsocket.get_block_hash"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.GoloopWebsocket.get_block_hash">[docs]</a>    <span class="k">def</span> <span class="nf">get_block_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">hash</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">jequest</span><span class="p">(</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">http_url</span><span class="si">}</span><span class="s2">/api/v3&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">generate_json_rpc</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;icx_getBlockByHash&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;hash&quot;</span><span class="p">:</span> <span class="nb">hash</span><span class="p">})</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red] </span><span class="si">{</span><span class="n">res</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="gen_rpc_params"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.gen_rpc_params">[docs]</a><span class="k">def</span> <span class="nf">gen_rpc_params</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">default_rpc</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1234</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">default_rpc</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span>
    <span class="k">return</span> <span class="n">default_rpc</span></div>


<div class="viewcode-block" id="getBlockByHash"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.getBlockByHash">[docs]</a><span class="k">def</span> <span class="nf">getBlockByHash</span><span class="p">(</span><span class="n">nodeHost</span><span class="p">,</span> <span class="nb">hash</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">append_http</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nodeHost</span><span class="si">}</span><span class="s2">/api/v3&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">gen_rpc_params</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;icx_getBlockByHash&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;hash&quot;</span><span class="p">:</span> <span class="nb">hash</span><span class="p">})</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span></div>


<div class="viewcode-block" id="getTransactionByHash"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.getTransactionByHash">[docs]</a><span class="k">def</span> <span class="nf">getTransactionByHash</span><span class="p">(</span><span class="n">nodeHost</span><span class="p">,</span> <span class="nb">hash</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">append_http</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nodeHost</span><span class="si">}</span><span class="s2">/api/v3&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">gen_rpc_params</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;icx_getTransactionByHash&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;txHash&quot;</span><span class="p">:</span> <span class="nb">hash</span><span class="p">})</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span></div>


<div class="viewcode-block" id="getLastBlock"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.getLastBlock">[docs]</a><span class="k">def</span> <span class="nf">getLastBlock</span><span class="p">(</span><span class="n">nodeHost</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">append_http</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nodeHost</span><span class="si">}</span><span class="s2">/api/v3&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">gen_rpc_params</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;icx_getLastBlock&quot;</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">json_res</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">json_res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">json_res</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="jequest"><a class="viewcode-back" href="../../../module/pawnlib.utils.html#pawnlib.utils.http.jequest">[docs]</a><span class="k">def</span> <span class="nf">jequest</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{},</span> <span class="n">elapsed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">print_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ipaddr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This functions will be called the http requests.</span>

<span class="sd">    :param url:</span>
<span class="sd">    :param method:</span>
<span class="sd">    :param payload:</span>
<span class="sd">    :param elapsed:</span>
<span class="sd">    :param print_error:</span>
<span class="sd">    :param timeout: Timeout seconds</span>
<span class="sd">    :param ipaddr: Change the request IP address in http request</span>
<span class="sd">    :param \*\*kwargs: Optional arguments that ``request`` takes.</span>

<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ipaddr</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;http://&#39;</span><span class="p">):</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;https?://&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
            <span class="c1"># net.override_dns(domain, ipaddr)</span>
            <span class="c1"># net.override_dns(domain=domain, ipaddr=ipaddr)</span>
            <span class="n">net</span><span class="o">.</span><span class="n">OverrideDNS</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span> <span class="n">ipaddr</span><span class="o">=</span><span class="n">ipaddr</span><span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">net</span><span class="o">.</span><span class="n">OverrideDNS</span><span class="p">()</span><span class="o">.</span><span class="n">unset</span><span class="p">()</span>

    <span class="n">pawnlib_timeout</span> <span class="o">=</span> <span class="n">pawn</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PAWN_TIMEOUT&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pawnlib_timeout</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">pawnlib_timeout</span> <span class="o">=</span> <span class="n">pawnlib_timeout</span> <span class="o">/</span> <span class="mi">1000</span>

    <span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span> <span class="ow">or</span> <span class="n">pawnlib_timeout</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">append_http</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="p">(</span><span class="n">json_response</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">http_version</span><span class="p">,</span> <span class="n">r_headers</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="o">=</span> <span class="p">({},</span> <span class="p">{},</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;patch&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">):</span>
        <span class="c1"># cprint(f&quot;[ERROR] unsupported method={method}, url={url} &quot;, color=&quot;red&quot;)</span>
        <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unsupported method=</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">, url=</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;unsupported method&quot;</span><span class="p">}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">requests</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;get&quot;</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">http_version</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">raw</span><span class="o">.</span><span class="n">version</span>
        <span class="n">r_headers</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">errh</span><span class="p">:</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">errh</span>
        <span class="k">if</span> <span class="n">global_verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">kvPrint</span><span class="p">(</span><span class="s2">&quot;Http Error:&quot;</span><span class="p">,</span> <span class="n">errh</span><span class="p">)</span>
        <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Http Error:</span><span class="si">{</span><span class="n">errh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">errc</span><span class="p">:</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">errc</span>
        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;[Errno 11001] getaddrinfo failed&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">errc</span><span class="p">)</span> <span class="ow">or</span>  <span class="c1"># Windows</span>
                <span class="s2">&quot;[Errno -2] Name or service not known&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">errc</span><span class="p">)</span> <span class="ow">or</span>  <span class="c1"># Linux</span>
                <span class="s2">&quot;[Errno 8] nodename nor servname &quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">errc</span><span class="p">)):</span>  <span class="c1"># OS X</span>
            <span class="n">errc</span> <span class="o">=</span> <span class="s2">&quot;DNSLookupError&quot;</span>
        <span class="k">if</span> <span class="n">global_verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">kvPrint</span><span class="p">(</span><span class="s2">&quot;Error Connecting:&quot;</span><span class="p">,</span> <span class="n">errc</span><span class="p">,</span> <span class="s2">&quot;FAIL&quot;</span><span class="p">)</span>
        <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error Connecting:</span><span class="si">{</span><span class="n">errc</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span> <span class="k">as</span> <span class="n">errt</span><span class="p">:</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">errt</span>
        <span class="k">if</span> <span class="n">global_verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">kvPrint</span><span class="p">(</span><span class="s2">&quot;Timeout Error:&quot;</span><span class="p">,</span> <span class="n">errt</span><span class="p">,</span> <span class="s2">&quot;FAIL&quot;</span><span class="p">)</span>
        <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeout Connecting:</span><span class="si">{</span><span class="n">errt</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">err</span>
        <span class="k">if</span> <span class="n">global_verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">kvPrint</span><span class="p">(</span><span class="s2">&quot;OOps: Something Else&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="s2">&quot;FAIL&quot;</span><span class="p">)</span>
        <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OOps: Something Else:</span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="c1"># cprint(f&quot;----&gt; {url}, {method}, {payload} , {response.status_code}&quot;, &quot;green&quot;)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response_code</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">response_code</span> <span class="o">=</span> <span class="mi">999</span>

    <span class="n">json_payload</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">global_verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">debug_logging</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">json_payload</span><span class="si">}</span><span class="s2"> , </span><span class="si">{</span><span class="n">response_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">response_code</span> <span class="o">!=</span> <span class="mi">999</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">json_response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">json_response</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
            <span class="c1"># debug_logging(f&quot;{url} , response is not json -&gt; &#39;{response.text}&#39;&quot;)</span>

        <span class="k">if</span> <span class="n">elapsed</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;elapsed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">elapsed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">json_response</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">json_response</span><span class="p">[</span><span class="s2">&quot;elapsed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;elapsed&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">response_code</span> <span class="o">&gt;</span> <span class="mi">200</span> <span class="ow">and</span> <span class="n">response_code</span> <span class="o">!=</span> <span class="mi">999</span> <span class="ow">and</span> <span class="n">print_error</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
        <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;status_code: </span><span class="si">{</span><span class="n">response_code</span><span class="si">}</span><span class="s2"> , url: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> , payload: </span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">, response: </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;status_code&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response_code</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;http_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">http_version</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;r_headers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_headers</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;json&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json_response</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">error</span>
    <span class="k">if</span> <span class="n">print_error</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">pawn</span><span class="o">.</span><span class="n">error_logger</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

    <span class="n">pawn</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;url=</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">, method=</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">, payload=</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">, kwargs=</span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">, error=</span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="n">icon_rpc_call</span> <span class="o">=</span> <span class="n">IconRpcHelper</span><span class="p">()</span><span class="o">.</span><span class="n">rpc_call</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, jinwoo.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>